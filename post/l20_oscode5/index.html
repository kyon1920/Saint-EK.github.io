<!DOCTYPE html>
<html lang="zh-cn" >
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  
  <meta name="author"
        content="Bruce Cheung"/>

  
  <meta name="description" content=""/>
  

  
  
  <meta name="keywords" content="blog, simple, dream"/>
  

  
  <link rel="canonical" href="https://oubc.github.io/post/l20_oscode5/"/>

  

  <title>Linuxç³»ç»Ÿç¼–ç¨‹ (çº¿ç¨‹æ¦‚å¿µä¸åˆ›å»º) &middot; Love, or death</title>

  <link rel="shortcut icon" href="https://oubc.github.io/images/favicon.ico"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/animate.min.css"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/remixicon.css"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/zozo.css"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/highlight.css"/>

  
  
</head>

<body>
<div class="main animated">
  <div class="nav_container animated fadeInDown">
  <div class="site_nav" id="site_nav">
    <ul>
      
      <li>
        <a href="/">é¦–é¡µ</a>
      </li>
      
      <li>
        <a href="/post/">å½’æ¡£</a>
      </li>
      
      <li>
        <a href="/tags/">æ ‡ç­¾</a>
      </li>
      
      <li>
        <a href="/about/">å…³äº</a>
      </li>
      
    </ul>
  </div>
  <div class="menu_icon">
    <a id="menu_icon"><i class="remixicon-links-line"></i></a>
  </div>
</div>

  <div class="header animated fadeInDown">
  <div class="site_title_container">
    <div class="site_title">
      <h1>
        <a href="https://oubc.github.io/">
          <span>Love, or death</span>
          <img src="https://oubc.github.io/images/logo.svg"/>
        </a>
      </h1>
    </div>
    <div class="description">
      <p class="sub_title">For you, a thousand times over.</p>
      <div class="my_socials">
        
        
        <a href="https://github.com/oubc" title="github" target="_blank"><i class="remixicon-github-fill"></i></a>
        
        
        
        <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=uYGOjo6OiIuLivnIyJfa1tQ" title="mail" target="_blank"><i class="remixicon-mail-fill"></i></a>
        
        
        
        <a href="http://sighttp.qq.com/msgrd?v=1&amp;uin=877771223" title="qq" target="_blank"><i class="remixicon-qq-fill"></i></a>
        
        
        
        <a href="https://github.com/oubc/oubc.github.io/blob/master/images/wx.jpg?raw=true" title="wechat" target="_blank"><i class="remixicon-wechat-fill"></i></a>
        
        
        
        <a href="https://weibo.com/u/6993631995?topnav=1&amp;wvr=6&amp;topsug=1" title="weibo" target="_blank"><i class="remixicon-weibo-fill"></i></a>
        
        
        <a href="https://oubc.github.io/index.xml" type="application/rss+xml" title="rss" target="_blank"><i class="remixicon-rss-fill"></i></a>
      </div>
    </div>
  </div>
</div>

  <div class="content">
    <div class="post_page">
      <div class="post animated fadeInDown">
        <div class="post_title post_detail_title">
          <h2><a href='/post/l20_oscode5/'>Linuxç³»ç»Ÿç¼–ç¨‹ (çº¿ç¨‹æ¦‚å¿µä¸åˆ›å»º)</a></h2>
          <span class="date">2019.10.04</span>
        </div>
        <div class="post_content markdown"><p><br>
<br>
<font color = gray size = 2>åˆ—è¡¨ï¼Œå±•å¼€ç‚¹å‡»è·³è½¬</font>
<br>
<details class="menu" close>
      <summary><font color=blue size = 4>çº¿ç¨‹æ¦‚å¿µ</font></summary>
      <ul>
          <li><a href="#bc0">ä»€ä¹ˆæ˜¯çº¿ç¨‹</a></li>
          <li><a href="#bc1">Linuxå†…æ ¸çº¿ç¨‹å®ç°åŸç†</a></li>
          <li><a href="#bc2">ä¸‰çº§æ˜ å°„å†æ¢ç©¶</a></li>
          <li><a href="#bc3">çº¿ç¨‹å…±äº«èµ„æº</a></li>
          <li><a href="#bc4">çº¿ç¨‹éå…±äº«èµ„æº</a></li>
          <li><a href="#bc5">çº¿ç¨‹ä¼˜ç¼ºç‚¹</a></li>
      </ul>
</details>
<details class="menu" close>
      <summary><font color=blue size = 4>çº¿ç¨‹æ§åˆ¶åŸè¯­</font></summary>
      <ul>
          <li><a href="#bc6">pthread_self() å‡½æ•°/a&gt;</li>
          <li><a href="#bc7">pthread_create() å‡½æ•°</a></li>
          <li><a href="#bc8">çº¿ç¨‹é—´å…±äº«å…¨å±€å˜é‡</a></li>
          <li><a href="#bc9">pthread_exit() å‡½æ•°/a&gt;</li>
          <li><a href="#bc10">pthread_join() å‡½æ•°</a></li>
          <li><a href="#bc11">pthread_detach() å‡½æ•°</a></li>
          <li><a href="#bc12">pthread_cancel() å‡½æ•°</a></li>
          <li><a href="#bc13">pthread_equal() å‡½æ•°</a></li>
          <li><a href="#bc14">è¿›ç¨‹&amp;çº¿ç¨‹ æ§åˆ¶åŸè¯­å¯¹æ¯”</a></li>
      </ul>
</details>
<details class="menu" close>
      <summary><font color=blue size = 4>çº¿ç¨‹å±æ€§</font></summary>
      <ul>
          <li><a href="#bc15">çº¿ç¨‹å±æ€§ç®€ä»‹</a></li>
          <li><a href="#bc16">çº¿ç¨‹å±æ€§åˆå§‹åŒ–</a></li>
          <li><a href="#bc17">çº¿ç¨‹çš„åˆ†ç¦»çŠ¶æ€</a></li>
          <li><a href="#bc18">çº¿ç¨‹åˆ†ç¦»çŠ¶æ€çš„å‡½æ•°</a></li>
          <li><a href="#bc19">çº¿ç¨‹çš„æ ˆåœ°å€</a></li>
          <li><a href="#bc20">çº¿ç¨‹çš„æ ˆå¤§å°</a></li>
          <li><a href="#bc21">çº¿ç¨‹å±æ€§æ§åˆ¶ç¤ºä¾‹</a></li>
      </ul>
</details>
<details class="menu" close>
      <summary><font color=blue size = 4>çº¿ç¨‹ä½¿ç”¨æ³¨æ„äº‹é¡¹</font></summary>
      <ul>
          <li><a href="#bc22">NPTL(çº¿ç¨‹åº“ç‰ˆæœ¬å·)</a></li>
          <li><a href="#bc23">ä½¿ç”¨æ—¶æ³¨æ„äº‹é¡¹</a></li>
      </ul>
</details>
<br>
<br>
<br>
<br>
<br><font color=black size = 5><a name="bc0">ä»€ä¹ˆæ˜¯çº¿ç¨‹</a></font>
<br> â— LWPï¼šlight weight process è½»é‡çº§çš„è¿›ç¨‹ï¼Œæœ¬è´¨ä»æ˜¯è¿›ç¨‹ (åœ¨Linuxç¯å¢ƒä¸‹)
<br> â— è¿›ç¨‹ï¼šç‹¬ç«‹åœ°å€ç©ºé—´ï¼Œæ‹¥æœ‰PCB
<br> â— çº¿ç¨‹ï¼šä¹Ÿæœ‰PCBï¼Œä½†æ²¡æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´(å…±äº«)
<br> ğŸ¤­ åŒºåˆ«ï¼šåœ¨äºæ˜¯å¦å…±äº«åœ°å€ç©ºé—´ï¼Œç‹¬å±…(è¿›ç¨‹)ï¼Œåˆç§Ÿ(çº¿ç¨‹)
<br> ğŸ¤­ Linuxä¸‹ï¼šçº¿ç¨‹æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ã€è¿›ç¨‹æ˜¯æœ€å°åˆ†é…èµ„æºçš„å•ä½(ä¸ç®¡æœ‰å¤šå°‘çº¿ç¨‹ï¼Œéƒ½åªæœ‰è¿›ç¨‹çš„ä¸€ä¸ª0-3Gåœ°å€ç©ºé—´)ï¼Œå¯çœ‹æˆæ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„è¿›ç¨‹
<br>
<br><font color=black size = 5><a name="bc1">Linuxå†…æ ¸çº¿ç¨‹å®ç°åŸç†</a></font>
<br> ğŸ¤­ åœ¨ç±»Unixç³»ç»Ÿä¸­ï¼Œæ—©æœŸæ˜¯æ²¡æœ‰â€œçº¿ç¨‹â€æ¦‚å¿µçš„ï¼Œ80å¹´ä»£æ‰å¼•å…¥ï¼Œå€ŸåŠ©è¿›ç¨‹æœºåˆ¶å®ç°å‡ºäº†çº¿ç¨‹çš„æ¦‚å¿µï¼Œå› æ­¤åœ¨è¿™ç±»ç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹å…³ç³»å¯†åˆ‡
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0ã€è½»é‡çº§è¿›ç¨‹ï¼Œä¹Ÿæœ‰PCBï¼Œåˆ›å»ºçº¿ç¨‹ä½¿ç”¨çš„åº•å±‚å‡½æ•°å’Œè¿›ç¨‹ä¸€æ ·ï¼Œéƒ½æ˜¯clone
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1ã€ä»å†…æ ¸æ¥çœ‹è¿›ç¨‹å’Œçº¿ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æœ‰å„è‡ªä¸åŒçš„PCBï¼Œä½†æ˜¯çº¿ç¨‹PCBæ‰€æŒ‡å‘å†…å­˜èµ„æºçš„ä¸‰çº§é¡µè¡¨æ˜¯ç›¸åŒçš„
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2ã€è¿›ç¨‹å¯ä»¥èœ•å˜æˆä¸ºçº¿ç¨‹
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3ã€çº¿ç¨‹å¯çœ‹åšå¯„å­˜å™¨å’Œæ ˆçš„é›†åˆ
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4ã€åœ¨Linuxä¸‹ï¼Œçº¿ç¨‹æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œè¿›ç¨‹æ˜¯æœ€å°çš„åˆ†é…èµ„æºå•ä½
<br> â— æŸ¥çœ‹LWPå·ï¼šps -Lf pid    æŸ¥çœ‹æŒ‡å®šçº¿ç¨‹çš„ lwpå· (çº¿ç¨‹å·ï¼Œå¹¶ä¸æ˜¯çº¿ç¨‹ID)
<br> â— LWPå·ï¼šæ˜¯CPUåˆ†é…æ—¶é—´è½®ç‰‡çš„ä¾æ®
<br> â— çº¿ç¨‹IDï¼šè¿›ç¨‹å†…éƒ¨åŒºåˆ†çº¿ç¨‹çš„
<br><img src="https://github.com/oubc/oubc.github.io/blob/master/images/L20_OScode0.png?raw=true" width="800" height="600" />
<br>
<br><font color=black size = 5><a name="bc2">ä¸‰çº§æ˜ å°„å†æ¢ç©¶</a></font>
<br> â— ä¸‰çº§æ˜ å°„ï¼šè¿›ç¨‹PCB â†’ é¡µç›®å½•(é¦–åœ°å€åœ¨PCBä¸­ï¼Œå¯çœ‹ä¸ºæ•°ç»„) â†’ é¡µè¡¨ â†’ ç‰©ç†é¡µé¢ â†’ å†…å­˜å•å…ƒ
<br> ğŸ¤­ å¯¹äºè¿›ç¨‹æ¥è¯´ï¼Œç›¸åŒçš„åœ°å€(åŒä¸€ä¸ªè™šæ‹Ÿåœ°å€)åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­ï¼Œåå¤ä½¿ç”¨è€Œä¸å†²çªï¼ŒåŸå› æ˜¯å®ƒä»¬è™½è™šæ‹Ÿåœ°å€ä¸€æ ·ï¼Œä½†æ˜¯é¡µç›®å½•ã€é¡µè¡¨ã€ç‰©ç†é¡µé¢å„ä¸ç›¸åŒï¼Œç›¸åŒçš„è™šæ‹Ÿåœ°å€ï¼Œæ˜ å°„åˆ°äº†ä¸åŒçš„ç‰©ç†é¡µå†…å­˜å•å…ƒï¼Œæœ€ç»ˆè®¿é—®åˆ°äº†ä¸åŒçš„ç‰©ç†é¡µé¢ã€‚ä½†æ˜¯ï¼Œçº¿ç¨‹ä¸åŒï¼Œä¸¤ä¸ªçº¿ç¨‹å…·æœ‰å„è‡ªç‹¬ç«‹çš„PCBï¼Œä½†å…±äº«åŒä¸€ä¸ªé¡µç›®å½•ï¼Œä¹Ÿå°±å…±äº«åŒä¸€ä¸ªä¸ªé¡µè¡¨å’Œç‰©ç†é¡µé¢ï¼Œæ‰€ä»¥ï¼Œä¸¤ä¸ªPCBå…±äº«ä¸€ä¸ªåœ°å€ç©ºé—´ã€‚å®é™…ä¸Šï¼Œæ— è®ºæ˜¯åˆ›å»ºè¿›ç¨‹çš„forkï¼Œè¿˜æ˜¯åˆ›å»ºçº¿ç¨‹çš„pthread_createï¼Œåº•å±‚éƒ½æ˜¯è°ƒç”¨åŒä¸€ä¸ªå†…æ ¸å‡½æ•°cloneã€‚
<br>  å¦‚æœå¤åˆ¶å¯¹æ–¹çš„åœ°å€ç©ºé—´ï¼Œé‚£ä¹ˆå°±äº§ç”Ÿä¸€ä¸ªâ€œè¿›ç¨‹â€ï¼›å¦‚æœå…±äº«å¯¹æ–¹çš„åœ°å€ç©ºé—´ï¼Œå°±äº§ç”Ÿäº†ä¸€ä¸ªâ€œçº¿ç¨‹â€ã€‚
<br>  å› æ­¤ï¼ŒLinuxå†…æ ¸æ˜¯ä¸åŒºåˆ†è¿›ç¨‹å’Œçº¿ç¨‹çš„ï¼Œåªæœ‰åœ¨ç”¨æˆ·å±‚é¢ä¸Šè¿›è¡ŒåŒºåˆ†ï¼Œæ‰€ä»¥ï¼Œçº¿ç¨‹æ‰€æœ‰æ“ä½œå‡½æ•° pthread_* æ˜¯åº“å‡½æ•°ï¼Œè€Œéç³»ç»Ÿè°ƒç”¨ã€‚
<br><img src="https://github.com/oubc/oubc.github.io/blob/master/images/L20_OScode1.png?raw=true" width="800" height="450" />
<br>
<br><font color=black size = 5><a name="bc3">çº¿ç¨‹å…±äº«èµ„æº</a></font>
<br>&nbsp;&nbsp;&nbsp;&nbsp; 0ã€æ–‡ä»¶æè¿°ç¬¦è¡¨
<br>&nbsp;&nbsp;&nbsp;&nbsp; 1ã€æ¯ç§ä¿¡å·çš„å¤„ç†æ–¹å¼
<br>&nbsp;&nbsp;&nbsp;&nbsp; 2ã€å½“å‰å·¥ä½œç›®å½•
<br>&nbsp;&nbsp;&nbsp;&nbsp; 3ã€ç”¨æˆ·IDå’Œç»„ID
<br>&nbsp;&nbsp;&nbsp;&nbsp; 4ã€å†…å­˜åœ°å€ç©ºé—´ (.text/.data/.heap/å…±äº«åº“) [0-3Gå…±äº«å†…å­˜åœ°å€ç©ºé—´é™¤äº†æ ˆç©ºé—´]
<br>
<br><font color=black size = 5><a name="bc4">çº¿ç¨‹éå…±äº«èµ„æº</a></font>
<br>&nbsp;&nbsp;&nbsp;&nbsp; 0ã€çº¿ç¨‹ID
<br>&nbsp;&nbsp;&nbsp;&nbsp; 1ã€å¤„ç†ç°åœºå’Œæ ˆæŒ‡é’ˆ (å†…æ ¸æ ˆ)
<br>&nbsp;&nbsp;&nbsp;&nbsp; 2ã€ç‹¬ç«‹çš„æ ˆç©ºé—´ (ç”¨æˆ·ç©ºé—´æ ˆ)
<br>&nbsp;&nbsp;&nbsp;&nbsp; 3ã€errnoå˜é‡
<br>&nbsp;&nbsp;&nbsp;&nbsp; 4ã€ä¿¡å·å±è”½å­—
<br>&nbsp;&nbsp;&nbsp;&nbsp; 5ã€è°ƒåº¦ä¼˜å…ˆçº§
<br> ğŸ¤­ è¡¥å……ï¼šçº¿ç¨‹å’Œä¿¡å·å°½é‡ä¸è¦ä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºä¸€èµ·ä½¿ç”¨ä¼šå˜å¾—ååˆ†å¤æ‚å’Œéº»çƒ¦ï¼Œè¿˜å¯èƒ½å‡ºç°ä¸€äº›æ„æƒ³ä¸åˆ°çš„é”™è¯¯ï¼Œä½†æ˜¯åœ¨ä¸å¾—ä¸ä½¿ç”¨çš„æ—¶å€™ä¹Ÿå¯ä»¥ä½¿ç”¨
<br>
<br><font color=black size = 5><a name="bc5">çº¿ç¨‹ä¼˜ç¼ºç‚¹</a></font>
<br> â— ä¼˜ç‚¹ï¼šæé«˜äº†ç¨‹åºçš„å¹¶å‘æ€§ã€å¼€é”€å°ã€æ•°æ®é€šä¿¡ï¼Œå…±äº«æ•°æ®æ–¹ä¾¿
<br> â— ç¼ºç‚¹ï¼šåº“å‡½æ•°ä¸ç¨³å®šã€è°ƒè¯•ï¼Œç¼–å†™å›°éš¾ã€gdbä¸æ”¯æŒã€å¯¹ä¿¡å·æ”¯æŒä¸å¥½
<br> ğŸ¤­ ä¼˜ç‚¹ç›¸å¯¹çªå‡ºï¼Œç¡®å®šå‡ä¸æ˜¯ç¡¬ä¼¤ï¼ŒLinuxä¸‹ç”±äºå®ç°æ–¹æ³•å¯¼è‡´è¿›ç¨‹ã€çº¿ç¨‹å·®åˆ«ä¸æ˜¯å¾ˆå¤§
<br>
<br><font color=black size = 5><a name="bc6">pthread_self() å‡½æ•°</a></font>
<br> â— è·å–çº¿ç¨‹IDï¼Œå…¶ä½œç”¨å¯¹åº”è¿›ç¨‹ä¸­ getpid() å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pthread_t pthread_self(void);        æˆåŠŸè¿”å›çº¿ç¨‹IDï¼Œå¤±è´¥æ— è¿”å›å€¼
<br> â— çº¿ç¨‹IDï¼špthread_t ç±»å‹ï¼Œæœ¬è´¨ï¼šåœ¨Linuxä¸‹ä¸ºæ— ç¬¦å·æ•´æ•°(%lu)ï¼Œå…¶å®ƒç³»ç»Ÿä¸­å¯èƒ½æ˜¯ç»“æ„ä½“å®ç°
<br> â— çº¿ç¨‹IDæ˜¯è¿›ç¨‹å†…éƒ¨è¯†åˆ«æ ‡å¿—(ä¸¤ä¸ªè¿›ç¨‹é—´ï¼Œå…è®¸çº¿ç¨‹IDç›¸åŒ)
<br> ğŸ¤­ æ³¨ï¼šä¸åº”ä½¿ç”¨å…¨å±€å˜é‡ pthread_t å’Œåœ¨å­çº¿ç¨‹ä¸­é€šè¿‡ pthread_create ä¼ å‡ºå‚æ•°æ¥è·å–çº¿ç¨‹IDï¼Œè€Œåº”ä½¿ç”¨pthread_selfã€‚
<br>
<br><font color=black size = 5><a name="bc7">pthread_create() å‡½æ•°</a></font>
<br> â— åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå…¶ä½œç”¨å¯¹åº”äºè¿›ç¨‹ä¸­fork() å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_create(pthread_t *thread, const pthread_attr_t *attr, void *(*start_routine) (void *), void *arg);  æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é”™è¯¯å·
<br> ğŸ¤­ è¡¥ï¼šåœ¨Linuxç¯å¢ƒä¸‹ï¼Œæ‰€æœ‰çº¿ç¨‹ç‰¹ç‚¹ï¼Œå¤±è´¥å‡ä¹‹é—´è¿”å›é”™è¯¯å·
<br> â— å‚æ•°ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pthread_t ï¼šå½“å‰Linuxä¸­å¯ç†è§£ä¸º typedef unsigned long int pthread_t ;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; å‚æ•°1ï¼šä¼ å‡ºå‚æ•°ï¼Œä¿å­˜ç³»ç»Ÿä¸ºæˆ‘ä»¬åˆ†é…å¥½çš„çº¿ç¨‹ID
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; å‚æ•°2ï¼šé€šå¸¸ä¼ NULLï¼Œè¡¨ç¤ºä½¿ç”¨çº¿ç¨‹é»˜è®¤å±æ€§ï¼Œè‹¥æƒ³è¦ä½¿ç”¨å…·ä½“å±æ€§ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹è¯¥å‚æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; å‚æ•°3ï¼šå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘çº¿ç¨‹ä¸»å‡½æ•°(å‡½æ•°ä½“)ï¼Œè¯¥å‡½æ•°è¿è¡Œç»“æŸï¼Œåˆ™çº¿ç¨‹ç»“æŸ
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; å‚æ•°4ï¼šçº¿ç¨‹ä¸»å‡½æ•°æ‰§è¡ŒæœŸé—´æ‰€è°ƒç”¨çš„å‚æ•°
<br> ğŸ¤­ åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨pthread_create()åˆ›å»ºæ–°çš„çº¿ç¨‹åï¼Œå½“å‰çº¿ç¨‹ä»pthread_create()è¿”å›ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè€Œæ–°çš„çº¿ç¨‹æ‰€æ‰§è¡Œçš„ä»£ç ç”±æˆ‘ä»¬ä¼ ç»™pthread_createçš„å‡½æ•°æŒ‡é’ˆstart_routineå†³å®šã€‚start_routineå‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯é€šè¿‡pthread_createçš„argå‚æ•°ä¼ é€’ç»™å®ƒçš„ï¼Œè¯¥å‚æ•°çš„ç±»å‹ä¸ºvoid *ï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‰ä»€ä¹ˆç±»å‹è§£é‡Šç”±è°ƒç”¨è€…è‡ªå·±å®šä¹‰ã€‚start_routineçš„è¿”å›å€¼ç±»å‹ä¹Ÿæ˜¯void *ï¼Œè¿™ä¸ªæŒ‡é’ˆçš„å«ä¹‰åŒæ ·ç”±è°ƒç”¨è€…è‡ªå·±å®šä¹‰ã€‚start_routineè¿”å›æ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹å°±é€€å‡ºäº†ï¼Œå…¶å®ƒçº¿ç¨‹å¯ä»¥è°ƒç”¨pthread_joinå¾—åˆ°start_routineçš„è¿”å›å€¼ï¼Œç±»ä¼¼äºçˆ¶è¿›ç¨‹è°ƒç”¨wait(2)å¾—åˆ°å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ã€‚
<br> ğŸ¤­ pthread_createæˆåŠŸè¿”å›åï¼Œæ–°åˆ›å»ºçš„çº¿ç¨‹çš„idè¢«å¡«å†™åˆ°threadå‚æ•°æ‰€æŒ‡å‘çš„å†…å­˜å•å…ƒã€‚æˆ‘ä»¬çŸ¥é“è¿›ç¨‹idçš„ç±»å‹æ˜¯pid_tï¼Œæ¯ä¸ªè¿›ç¨‹çš„idåœ¨æ•´ä¸ªç³»ç»Ÿä¸­æ˜¯å”¯ä¸€çš„ï¼Œè°ƒç”¨getpid(2)å¯ä»¥è·å¾—å½“å‰è¿›ç¨‹çš„idï¼Œæ˜¯ä¸€ä¸ªæ­£æ•´æ•°å€¼ã€‚çº¿ç¨‹idçš„ç±»å‹æ˜¯thread_tï¼Œå®ƒåªåœ¨å½“å‰è¿›ç¨‹ä¸­ä¿è¯æ˜¯å”¯ä¸€çš„ï¼Œåœ¨ä¸åŒçš„ç³»ç»Ÿä¸­thread_tè¿™ä¸ªç±»å‹æœ‰ä¸åŒçš„å®ç°ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªæ•´æ•°å€¼ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªåœ°å€ï¼Œæ‰€ä»¥ä¸èƒ½ç®€å•åœ°å½“æˆæ•´æ•°ç”¨printfæ‰“å°ï¼Œè°ƒç”¨pthread_self(3)å¯ä»¥è·å¾—å½“å‰çº¿ç¨‹çš„idã€‚
<br> ğŸ¤­ attrå‚æ•° è¡¨ç¤ºçº¿ç¨‹å±æ€§ï¼Œæœ¬èŠ‚ä¸æ·±å…¥è®¨è®ºçº¿ç¨‹å±æ€§ï¼Œæ‰€æœ‰ä»£ç ä¾‹å­éƒ½ä¼ NULLç»™attrå‚æ•°ï¼Œè¡¨ç¤ºçº¿ç¨‹å±æ€§å–ç¼ºçœå€¼ã€‚
<br> ğŸ¤­ ç¼–ç¨‹å®æˆ˜ï¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œæ‰“å°çº¿ç¨‹IDã€‚æ³¨æ„ï¼šé“¾æ¥çº¿ç¨‹åº“ -lpthread/-pthread
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;unistd.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;pthread.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;stdlib.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;string.h&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*thrd_fun(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*arg)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;thread:&nbsp;process&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;getpid()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;thread:&nbsp;thread&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;pthread_self()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">;<BR>
}<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_t&nbsp;tid;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main1:&nbsp;process&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;getpid()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main1:&nbsp;thread&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;pthread_self()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;ret&nbsp;=&nbsp;pthread_create(&amp;tid,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">,&nbsp;thrd_fun,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(ret&nbsp;!=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;pthread_create&nbsp;error!&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;and&nbsp;the&nbsp;error&nbsp;number&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;strerror(ret)&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main2:&nbsp;process&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;getpid()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main2:&nbsp;thread&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;pthread_self()&nbsp;&lt;&lt;&nbsp;endl;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br> ğŸ¤­ ç”±äºpthread_createçš„é”™è¯¯ç ä¸ä¿å­˜åœ¨errnoä¸­ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨perror(3)æ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥å…ˆç”¨strerror(3)æŠŠé”™è¯¯ç è½¬æ¢æˆé”™è¯¯ä¿¡æ¯å†æ‰“å°ã€‚å¦‚æœä»»æ„ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†exitæˆ–_exitï¼Œåˆ™æ•´ä¸ªè¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹éƒ½ç»ˆæ­¢ï¼Œç”±äºä»mainå‡½æ•°returnä¹Ÿç›¸å½“äºè°ƒç”¨exitï¼Œä¸ºäº†é˜²æ­¢æ–°åˆ›å»ºçš„çº¿ç¨‹è¿˜æ²¡æœ‰å¾—åˆ°æ‰§è¡Œå°±ç»ˆæ­¢ï¼Œæˆ‘ä»¬åœ¨mainå‡½æ•°returnä¹‹å‰å»¶æ—¶1ç§’ï¼Œè¿™åªæ˜¯ä¸€ç§æƒå®œä¹‹è®¡ï¼Œå³ä½¿ä¸»çº¿ç¨‹ç­‰å¾…1ç§’ï¼Œå†…æ ¸ä¹Ÿä¸ä¸€å®šä¼šè°ƒåº¦æ–°åˆ›å»ºçš„çº¿ç¨‹æ‰§è¡Œ
<br> ğŸ¤­ è¡¥ï¼šæŸ¥çœ‹çº¿ç¨‹LWPå·ï¼Œä½¿ç”¨å‘½ä»¤ps aux + ps -Lf PID
<br> ğŸ¤­ ç¼–ç¨‹å®æˆ˜ï¼šå¾ªç¯åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰“å°è‡ªå·±æ˜¯ç¬¬å‡ ä¸ªè¢«åˆ›å»ºçš„çº¿ç¨‹ã€‚(ç±»ä¼¼äºè¿›ç¨‹å¾ªç¯åˆ›å»ºå­è¿›ç¨‹)
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;unistd.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;pthread.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;stdlib.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;string.h&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*thrd_fun(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*arg)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">)arg;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;thread:&nbsp;the&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;i&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;th&nbsp;thread&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;pthread_self()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">;<BR>
}<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;ret,&nbsp;i;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_t&nbsp;tid;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main1:&nbsp;process&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;getpid()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main1:&nbsp;thread&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;pthread_self()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">5</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;pthread_create(&amp;tid,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">,&nbsp;thrd_fun,&nbsp;(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*)i);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(ret&nbsp;!=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;pthread_create&nbsp;error!&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;and&nbsp;the&nbsp;error&nbsp;number&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;strerror(ret)&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(i);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main2:&nbsp;process&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;getpid()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main2:&nbsp;thread&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;pthread_self()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br> ğŸ¤­ æ€è€ƒï¼šå°†pthread_createå‡½æ•°å‚4ä¿®æ”¹ä¸º(void *)&amp;i, å°†çº¿ç¨‹ä¸»å‡½æ•°å†…æ”¹ä¸º i=*((int *)arg) æ˜¯å¦å¯ä»¥ï¼Ÿ
<br> â— è¯¥æ–¹æ³•å¹¶ä¸å¯å–
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;unistd.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;pthread.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;stdlib.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;string.h&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*thrd_fun(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*arg)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;*th&nbsp;=&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;*)arg;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;thread:&nbsp;the&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;*(th)&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;th&nbsp;thread&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;pthread_self()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">;<BR>
}<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;ret,&nbsp;i;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_t&nbsp;tid;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main1:&nbsp;process&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;getpid()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main1:&nbsp;thread&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;pthread_self()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">5</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;pthread_create(&amp;tid,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">,&nbsp;thrd_fun,&nbsp;(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*)&amp;i);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(ret&nbsp;!=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;pthread_create&nbsp;error!&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;and&nbsp;the&nbsp;error&nbsp;number&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;strerror(ret)&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main2:&nbsp;process&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;getpid()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main2:&nbsp;thread&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;pthread_self()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br>
<br><font color=black size = 5><a name="bc8">çº¿ç¨‹é—´å…±äº«å…¨å±€å˜é‡</a></font>
<br> â— çº¿ç¨‹é»˜è®¤å…±äº«æ•°æ®æ®µã€ä»£ç æ®µç­‰åœ°å€ç©ºé—´ï¼Œå¸¸ç”¨çš„æ˜¯å…¨å±€å˜é‡ï¼Œè€Œè¿›ç¨‹ä¸å…±äº«å…¨å±€å˜é‡ï¼Œåªèƒ½å€ŸåŠ© mmapã€‚
<br> ğŸ¤­ ç¼–ç¨‹å®æˆ˜ï¼šè®¾è®¡ç¨‹åºï¼ŒéªŒè¯çº¿ç¨‹ä¹‹é—´å…±äº«å…¨å±€å˜é‡
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;pthread.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;stdlib.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;unistd.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;string.h&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;var&nbsp;=&nbsp;</span><span style="color:#ff0000;">100</span><span style="color:#000000;">;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*thrd_fun(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*arg)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;=&nbsp;</span><span style="color:#ff0000;">200</span><span style="color:#000000;">;<BR>
}<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_t&nbsp;tid;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Before,&nbsp;the&nbsp;var&nbsp;equal&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;var&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;ret&nbsp;=&nbsp;pthread_create(&amp;tid,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">,&nbsp;thrd_fun,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(ret&nbsp;!=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;pthread_create&nbsp;error!&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;and&nbsp;the&nbsp;error&nbsp;number&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;strerror(ret)&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Then,&nbsp;the&nbsp;var&nbsp;equal&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;var&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br>
<br><font color=black size = 5><a name="bc9">pthread_exit() å‡½æ•°</a></font>
<br>&nbsp;&nbsp;&nbsp;&nbsp; å°†å•ä¸ªçº¿ç¨‹é€€å‡º
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void pthread_exit(void *retval); æ— è¿”å›å€¼
<br>&nbsp;&nbsp;&nbsp;&nbsp; å‚æ•°ï¼šretval è¡¨ç¤ºçº¿ç¨‹é€€å‡ºçŠ¶æ€ï¼Œé€šå¸¸ä¼ NULL
<br> ğŸ¤­ æ€è€ƒï¼šä½¿ç”¨exitå°†æŒ‡å®šçº¿ç¨‹é€€å‡ºï¼Œå¯ä»¥å—ï¼Ÿ
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; çº¿ç¨‹ä¸­ï¼Œç¦æ­¢ä½¿ç”¨exit() å‡½æ•°ï¼Œä¼šå¯¼è‡´è¿›ç¨‹å†…æ‰€æœ‰çº¿ç¨‹å…¨éƒ¨é€€å‡º
<br> â— åœ¨ä¸æ·»åŠ  sleep æ§åˆ¶è¾“å‡ºé¡ºåºçš„æƒ…å†µä¸‹ï¼Œpthread_create åœ¨å¾ªç¯ä¸­ï¼Œå‡ ä¹ç¬é—´åˆ›å»ºäº†5ä¸ªçº¿ç¨‹ï¼Œä½†åªæœ‰ä¸€ä¸ªçº¿ç¨‹æœ‰æœºä¼šè¾“å‡º (æˆ–è€…ç¬¬2ä¸ªä¹Ÿæœ‰æœºä¼šï¼Œä½†ä¹Ÿæœ‰å¯èƒ½æ²¡æœ‰ï¼Œå–å†³äºå†…æ ¸è°ƒåº¦)ï¼Œå¦‚æœç¬¬ä¸‰ä¸ªçº¿ç¨‹æ‰§è¡Œäº† exit() å‡½æ•°ï¼Œå°†æ•´ä¸ªè¿›ç¨‹é€€å‡ºäº†ï¼Œæ‰€ä»¥å…¨éƒ¨çº¿ç¨‹éƒ½é€€å‡ºäº†
<br> â— æ‰€ä»¥ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œåº”å°½é‡å°‘ç”¨æˆ–è€…ä¸ç”¨ exit() å‡½æ•°ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯pthread_exit() å‡½æ•°ï¼Œå°†å•ä¸ªçº¿ç¨‹é€€å‡ºï¼Œä»»ä½•çº¿ç¨‹é‡Œexitå¯¼è‡´è¿›ç¨‹é€€å‡ºï¼Œå…¶å®ƒçº¿ç¨‹å·¥ä½œæœªç»“æŸï¼Œä¸»æ§çº¿ç¨‹é€€å‡ºæ—¶ä¸èƒ½ return æˆ– exitã€‚
<br> ğŸ¤­ æ³¨ï¼špthread_exitæˆ–è€…returnè¿”å›çš„æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜å•å…ƒå¿…é¡»æ˜¯å…¨å±€çš„æˆ–è€…æ˜¯ç”¨mallocåˆ†é…çš„ï¼Œä¸èƒ½åœ¨çº¿ç¨‹å‡½æ•°çš„æ ˆä¸Šåˆ†é…ï¼Œå› ä¸ºå½“å…¶å®ƒçº¿ç¨‹å¾—åˆ°è¿™ä¸ªè¿”å›æŒ‡é’ˆæ—¶çº¿ç¨‹å‡½æ•°å·²ç»é€€å‡ºäº†ã€‚
<br> â— åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œexitã€returnã€pthread_exitå„è‡ªé€€å‡ºæ•ˆæœï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; returnï¼šè¿”å›åˆ°è°ƒç”¨è€…é‚£é‡Œå»ã€‚
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pthread_exit()ï¼šå°†è°ƒç”¨è¯¥å‡½æ•°çš„çº¿ç¨‹<br />
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit: å°†è¿›ç¨‹é€€å‡ºã€‚
<br>
<br><font color=black size = 5><a name="bc10">pthread_join() å‡½æ•°</a></font>
<br> â— é˜»å¡ç­‰å¾…çº¿ç¨‹é€€å‡ºï¼Œè·å–çº¿ç¨‹é€€å‡ºçŠ¶æ€ï¼Œå…¶ä½œç”¨å¯¹åº”äºè¿›ç¨‹ä¸­ waitpid() å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_join(pthread_t thread, void **retval);     æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é”™è¯¯å·
<br> â— å‚æ•°ï¼šthreadä¸ºçº¿ç¨‹ID (æ³¨ï¼šä¸æ˜¯æŒ‡é’ˆ)ã€retvalå­˜å‚¨çº¿ç¨‹ç»“æŸçŠ¶æ€
<br>&nbsp;&nbsp;&nbsp;&nbsp; å¯¹æ¯”è®°å¿†ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; è¿›ç¨‹ä¸­ï¼Œmainè¿”å›å€¼ã€exitå‚æ•° â†’ intï¼›ç­‰å¾…å­è¿›ç¨‹ç»“æŸ wait å‡½æ•°å‚æ•° â†’ int*
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; çº¿ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¸»å‡½æ•°è¿”å›å€¼ã€pthread_exit â†’ void* ï¼›ç­‰å¾…çº¿ç¨‹ç»“æŸ pthread_join å‡½æ•°å‚æ•° â†’ void**
<br> ğŸ¤­ ç¼–ç¨‹å®æˆ˜ï¼šå‚æ•°retvaléç©ºä½¿ç”¨
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;stdlib.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;pthread.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;unistd.h&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#0000ff;">typedef</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">struct</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;a;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;b;<BR>
}exit_t;<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*thrd_fun(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*arg)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit_t&nbsp;*rval&nbsp;=&nbsp;(exit_t&nbsp;*)arg;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rval&nbsp;-&gt;&nbsp;a&nbsp;=&nbsp;</span><span style="color:#ff0000;">100</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rval&nbsp;-&gt;&nbsp;b&nbsp;=&nbsp;</span><span style="color:#ff0000;">200</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_exit((</span><span style="color:#8000ff;">void</span><span style="color:#000000;">*)rval);<BR>
}<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit_t&nbsp;*retval&nbsp;=&nbsp;</span><span style="color:#0000ff;">new</span><span style="color:#000000;">&nbsp;exit_t;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_t&nbsp;tid;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;ret&nbsp;=&nbsp;pthread_create(&amp;tid,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">,&nbsp;thrd_fun,&nbsp;(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*)retval);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(ret&nbsp;!=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;create&nbsp;failed!&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_join(tid,&nbsp;(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;**)&amp;retval);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;return&nbsp;value:&nbsp;a&nbsp;=&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;retval&nbsp;-&gt;&nbsp;a&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;&nbsp;b&nbsp;=&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;retval&nbsp;-&gt;&nbsp;b&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">delete</span><span style="color:#000000;">&nbsp;retval;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br> â— è°ƒç”¨è¯¥å‡½æ•°çš„çº¿ç¨‹å°†æŒ‚èµ·ç­‰å¾…ï¼Œç›´åˆ°idä¸ºthreadçš„çº¿ç¨‹ç»ˆæ­¢ï¼Œthreadçº¿ç¨‹ä»¥ä¸åŒçš„æ–¹æ³•ç»ˆæ­¢ï¼Œé€šè¿‡pthread_joinå¾—åˆ°çš„ç»ˆæ­¢çŠ¶æ€æ˜¯ä¸åŒçš„ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0ã€å¦‚æœthreadçº¿ç¨‹é€šè¿‡ return è¿”å›ï¼Œretvalæ‰€æŒ‡å‘çš„å•å…ƒé‡Œå­˜æ”¾çš„æ˜¯threadçº¿ç¨‹å‡½æ•°çš„è¿”å›å€¼
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1ã€å¦‚æœthreadçº¿ç¨‹è¢«åˆ«çš„çº¿ç¨‹è°ƒç”¨ pthread_cancel å¼‚å¸¸ç»ˆæ­¢æ—¶ï¼Œretvalæ‰€æŒ‡å‘çš„å•å…ƒé‡Œå­˜æ”¾çš„æ˜¯å¸¸æ•° PTHREAD_CANCELED
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2ã€å¦‚æœthreadçº¿ç¨‹æ˜¯è‡ªå·±è°ƒç”¨ pthread_exit ç»ˆæ­¢çš„ï¼Œretval æ‰€æŒ‡å‘çš„å•å…ƒå­˜æ”¾çš„æ˜¯ä¼ ç»™ pthread_exit çš„å‚æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3ã€å¦‚æœå¯¹threadçº¿ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ä¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥ä¼ NULLç»™retvalå‚æ•°
<br> ğŸ¤­ ç¼–ç¨‹å®æˆ˜ï¼šä½¿ç”¨ pthread_join å‡½æ•°å°†å¾ªç¯åˆ›å»ºçš„å¤šä¸ªå­çº¿ç¨‹å›æ”¶
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;unistd.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;pthread.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;stdlib.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;string.h&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;var&nbsp;=&nbsp;</span><span style="color:#ff0000;">100</span><span style="color:#000000;">;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*thrd_fun(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*arg)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">long</span><span style="color:#000000;">&nbsp;th&nbsp;=&nbsp;(</span><span style="color:#8000ff;">long</span><span style="color:#000000;">)arg;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(th);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;thread:&nbsp;the&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;th&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;th&nbsp;thread&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;pthread_self()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(th&nbsp;==&nbsp;</span><span style="color:#ff0000;">3</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;=&nbsp;</span><span style="color:#ff0000;">300</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_exit((</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*)var);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">else</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">(th&nbsp;==&nbsp;</span><span style="color:#ff0000;">4</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;=&nbsp;</span><span style="color:#ff0000;">400</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_exit((</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*)var);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">else</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_exit((</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*)var);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
}<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;ret,&nbsp;i;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_t&nbsp;tid[</span><span style="color:#ff0000;">5</span><span style="color:#000000;">];<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;*retval[</span><span style="color:#ff0000;">5</span><span style="color:#000000;">];<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main1:&nbsp;process&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;getpid()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main1:&nbsp;thread&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;pthread_self()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">5</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;pthread_create(&amp;tid[i],&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">,&nbsp;thrd_fun,&nbsp;(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*)i);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(ret&nbsp;!=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;pthread_create&nbsp;error!&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;and&nbsp;the&nbsp;error&nbsp;number&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;strerror(ret)&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;j&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;j&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">5</span><span style="color:#000000;">;&nbsp;++j)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_join(tid[j],&nbsp;(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;**)&amp;retval[j]);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Termination,&nbsp;return&nbsp;value:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;(</span><span style="color:#8000ff;">long</span><span style="color:#000000;">)retval[j]&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(i);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main2:&nbsp;process&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;getpid()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;In&nbsp;main2:&nbsp;thread&nbsp;id&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;pthread_self()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br>
<br><font color=black size = 5><a name="bc11">pthread_detach() å‡½æ•°</a></font>
<br> â— å®ç°çº¿ç¨‹åˆ†ç¦»ï¼šåˆ†ç¦»åçš„çº¿ç¨‹é€€å‡ºåæ— ç³»ç»Ÿæ®‹ç•™èµ„æº
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_detach(pthread_t thread);    æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é”™è¯¯å·
<br> â— çº¿ç¨‹åˆ†ç¦»çŠ¶æ€ï¼ŒæŒ‡å®šè¯¥çŠ¶æ€ï¼Œçº¿ç¨‹ä¸»åŠ¨ä¸ä¸»çº¿ç¨‹æ–­å¼€è”ç³»ï¼Œçº¿ç¨‹ç»“æŸåï¼Œå…¶é€€å‡ºçŠ¶æ€ä¸ç”±å…¶å®ƒçº¿ç¨‹è·å–ï¼Œè€Œç›´æ¥è‡ªå·±ä¸»åŠ¨é‡Šæ”¾ï¼Œåœ¨ç½‘ç»œå’Œå¤šçº¿ç¨‹æœåŠ¡å™¨ä¸­å¸¸ç”¨ã€‚
<br> â— è¿›ç¨‹è‹¥æœ‰è¯¥æœºåˆ¶ï¼Œå°†ä¸ä¼šäº§ç”Ÿåƒµå°¸è¿›ç¨‹ï¼Œåƒµå°¸è¿›ç¨‹çš„äº§ç”Ÿä¸»è¦æ˜¯ç”±äºè¿›ç¨‹æ­»åï¼Œå¤§éƒ¨åˆ†èµ„æºè¢«é‡Šæ”¾ï¼Œä¸€ç‚¹æ®‹ç•™èµ„æºä»å­˜åœ¨äºç³»ç»Ÿä¸­ï¼Œå¯¼è‡´å†…æ ¸è®¤ä¸ºè¯¥è¿›ç¨‹ä»ç„¶å­˜åœ¨ã€‚
<br> â— ä¹Ÿå¯ä»¥ä½¿ç”¨ pthread_create() å‡½æ•° çš„å‚æ•°2(çº¿ç¨‹å±æ€§) æ¥è®¾ç½®çº¿ç¨‹åˆ†ç¦»ã€‚
<br> â— ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œçº¿ç¨‹ç»ˆæ­¢åï¼Œå…¶ç»ˆæ­¢çŠ¶æ€ä¸€ç›´ä¿ç•™åˆ°å…¶å®ƒçº¿ç¨‹è°ƒç”¨pthread_joinè·å–å®ƒçš„çŠ¶æ€ä¸ºæ­¢ã€‚ä½†æ˜¯çº¿ç¨‹ä¹Ÿå¯ä»¥è¢«ç½®ä¸ºdetachçŠ¶æ€ï¼Œè¿™æ ·çš„çº¿ç¨‹ä¸€æ—¦ç»ˆæ­¢å°±ç«‹åˆ»å›æ”¶å®ƒå ç”¨çš„æ‰€æœ‰èµ„æºï¼Œè€Œä¸ä¿ç•™ç»ˆæ­¢çŠ¶æ€ã€‚
<br> â— ä¸èƒ½å¯¹ä¸€ä¸ªå·²ç»å¤„äºdetachçŠ¶æ€çš„çº¿ç¨‹è°ƒç”¨pthread_joinï¼Œè¿™æ ·çš„è°ƒç”¨å°†è¿”å›EINVALé”™è¯¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå·²ç»å¯¹ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†pthread_detachå°±ä¸èƒ½å†è°ƒç”¨pthread_joinäº†ã€‚
<br>
<br><font color=black size = 5><a name="bc12">pthread_cancel() å‡½æ•°</a></font>
<br> â— æ€æ­»(å–æ¶ˆ)çº¿ç¨‹ï¼Œå…¶ä½œç”¨å¯¹åº”äºè¿›ç¨‹ä¸­çš„ kill() å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_cancel(pthread_t thread);    æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é”™è¯¯å·ã€‚
<br> ğŸ¤­ æ³¨ï¼šçº¿ç¨‹çš„å–æ¶ˆå¹¶ä¸æ˜¯å®æ—¶çš„ï¼Œè€Œæœ‰ä¸€å®šçš„å»¶æ—¶ï¼Œéœ€è¦ç­‰å¾…çº¿ç¨‹åˆ°è¾¾æŸä¸ªå–æ¶ˆç‚¹(æ£€æŸ¥ç‚¹)ã€‚
<br> â— ç±»ä¼¼äºæ¸¸æˆå­˜æ¡£ï¼Œå¿…é¡»åˆ°è¾¾æŒ‡å®šçš„åœºæ‰€(å­˜æ¡£ç‚¹ï¼Œå¦‚ï¼šå®¢æ ˆã€ä»“åº“ç­‰)æ‰èƒ½å­˜å‚¨è¿›åº¦ï¼Œæ€æ­»çº¿ç¨‹ä¹Ÿä¸æ˜¯ç«‹åˆ»å°±èƒ½å®Œæˆï¼Œå¿…é¡»å…ˆåˆ°è¾¾æŸä¸ªå–æ¶ˆç‚¹(æ£€æŸ¥ç‚¹)ã€‚
<br> â— å–æ¶ˆç‚¹(æ£€æŸ¥ç‚¹)ï¼šæ˜¯çº¿ç¨‹æ£€æŸ¥æ˜¯å¦å–æ¶ˆï¼Œå¹¶æŒ‰è¯·æ±‚è¿›è¡ŒåŠ¨ä½œçš„ä¸€ä¸ªä½ç½®ï¼Œé€šå¸¸æ˜¯ä¸€äº›ç³»ç»Ÿè°ƒç”¨creatã€openã€pauseã€closeã€readã€writeç­‰ï¼Œæ‰§è¡Œå‘½ä»¤ man 7 pthreads å¯ä»¥æŸ¥çœ‹å…·å¤‡è¿™äº›å–æ¶ˆç‚¹çš„ç³»ç»Ÿè°ƒç”¨åˆ—è¡¨ã€‚
<br> â— å¯ç²—ç•¥è®¤ä¸ºä¸€ä¸ªç³»ç»Ÿè°ƒç”¨(è¿›å…¥å†…æ ¸)å³ä¸ºä¸€ä¸ªå–æ¶ˆç‚¹ï¼Œå¦‚çº¿ç¨‹ä¸­æ²¡æœ‰å–æ¶ˆç‚¹ï¼Œå¯ä»¥é€šè¿‡ pthread_testcancel() å‡½æ•° è‡ªè¡Œè®¾ç½®ä¸€ä¸ªå–æ¶ˆç‚¹ã€‚
<br> â— è¢«å–æ¶ˆçš„çº¿ç¨‹ï¼Œé€€å‡ºå€¼å®šä¹‰åœ¨Linuxçš„pthreadåº“ä¸­ï¼Œå¸¸æ•° PTHREAD_CANCELED çš„å€¼ä¸º-1ï¼Œå¯åœ¨å¤´æ–‡ä»¶pthread.hä¸­æ‰¾åˆ°å®ƒçš„å®šä¹‰ï¼š#define PTHREAD_CANCELED ((void *) -1)ã€‚å› æ­¤å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªå·²ç»è¢«å–æ¶ˆçš„çº¿ç¨‹ä½¿ç”¨pthread_joinå›æ”¶æ—¶ï¼Œå¾—åˆ°çš„è¿”å›å€¼ä¸º-1ã€‚
<br> ğŸ¤­ ç¼–ç¨‹å®æˆ˜ï¼šç»ˆæ­¢çº¿ç¨‹çš„ä¸‰ç§æ–¹æ³•ï¼Œæ³¨æ„â€œå–æ¶ˆç‚¹â€çš„æ¦‚å¿µ
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;pthread.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;stdlib.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;unistd.h&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*cancelfun1(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*arg)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;1th&nbsp;thread&nbsp;returning\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;((</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*)</span><span style="color:#ff0000;">111</span><span style="color:#000000;">);<BR>
}<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*cancelfun2(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*arg)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;2th&nbsp;thread&nbsp;exiting\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_exit((</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*)</span><span style="color:#ff0000;">222</span><span style="color:#000000;">);<BR>
}<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*cancelfun3(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*arg)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;die&nbsp;=&nbsp;</span><span style="color:#ff0000;">3</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;3th&nbsp;thread:&nbsp;I'm&nbsp;going&nbsp;die&nbsp;in&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;die&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;seconds&nbsp;...\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die--;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//pthread_testcancel();&nbsp;//&nbsp;ä¸ºè‡ªå·±æ·»åŠ å–æ¶ˆç‚¹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_t&nbsp;tid;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*ret&nbsp;=&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_create(&amp;tid,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">,&nbsp;cancelfun1,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_join(tid,&nbsp;&amp;ret);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;The&nbsp;first&nbsp;thread&nbsp;exit&nbsp;code&nbsp;return&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;(</span><span style="color:#8000ff;">long</span><span style="color:#000000;">)ret&nbsp;&lt;&lt;&nbsp;endl;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_create(&amp;tid,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">,&nbsp;cancelfun2,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_join(tid,&nbsp;&amp;ret);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;The&nbsp;second&nbsp;thread&nbsp;exit&nbsp;code&nbsp;return&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;(</span><span style="color:#8000ff;">long</span><span style="color:#000000;">)ret&nbsp;&lt;&lt;&nbsp;endl;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_create(&amp;tid,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">,&nbsp;cancelfun3,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(</span><span style="color:#ff0000;">3</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_cancel(tid);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_join(tid,&nbsp;&amp;ret);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;The&nbsp;third&nbsp;thread&nbsp;exit&nbsp;code&nbsp;return&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;(</span><span style="color:#8000ff;">long</span><span style="color:#000000;">)ret&nbsp;&lt;&lt;&nbsp;endl;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br> â— ç»ˆæ­¢çº¿ç¨‹æ–¹å¼æ€»ç»“ï¼šç»ˆæ­¢æŸä¸ªçº¿ç¨‹è€Œä¸ç»ˆæ­¢æ•´ä¸ªè¿›ç¨‹ï¼Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0ã€ä»çº¿ç¨‹ä¸»å‡½æ•°returnã€‚è¿™ç§æ–¹æ³•å¯¹ä¸»æ§çº¿ç¨‹ä¸é€‚ç”¨ï¼Œä»mainå‡½æ•°returnç›¸å½“äºè°ƒç”¨exitã€‚
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1ã€ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è°ƒç”¨pthread_cancelç»ˆæ­¢åŒä¸€è¿›ç¨‹ä¸­çš„å¦ä¸€ä¸ªçº¿ç¨‹ã€‚
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2ã€çº¿ç¨‹å¯ä»¥è°ƒç”¨pthread_exitç»ˆæ­¢è‡ªå·±ã€‚
<br>
<br><font color=black size = 5><a name="bc13">pthread_equal() å‡½æ•°</a></font>
<br> â— æ¯”è¾ƒä¸¤ä¸ªçº¿ç¨‹IDå·æ˜¯å¦ç›¸ç­‰
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_equal(pthread_t t1, pthread_t t2);
<br> â— æœ‰å¯èƒ½Linuxåœ¨æœªæ¥çº¿ç¨‹ID pthread_t ç±»å‹è¢«ä¿®æ”¹ä¸ºç»“æ„ä½“å®ç°
<br>
<br><font color=black size = 5><a name="bc14">è¿›ç¨‹&amp;çº¿ç¨‹ æ§åˆ¶åŸè¯­å¯¹æ¯”</a></font>
<hr>
<br><table border="20">
  <tr align="center">
    <th>è¿›ç¨‹</th>
    <th>çº¿ç¨‹</th>
    <th>å¤‡æ³¨</th>
  </tr>
  <tr align="center">
    <td>fork</td>
    <td>pthread_create</td>
  </tr>
  <tr align="center">
    <td>getpid</td>
    <td>pthread_self</td>
  </tr>
  <tr align="center">
    <td>exit(1)</td>
    <td>pthread_exit(vod *)</td>
    <td>éƒ½ä¸ºé˜»å¡ç­‰å¾…</td>
  </tr>
  <tr align="center">
    <td>kill</td>
    <td>pthread_cancel</td>
    <td>å–æ¶ˆç‚¹(æ£€æŸ¥ç‚¹)ï¼Œç³»ç»Ÿè°ƒç”¨</td>
  </tr>
</table>
<hr>
å‘½ä»¤ man 7 pthreadsæŸ¥çœ‹å–æ¶ˆç‚¹
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; å–æ¶ˆç‚¹è®¾ç½®ï¼špthread_testcancel();
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pthread_detach()  åˆ†ç¦»ï¼Œè‡ªåŠ¨æ¸…ç†PCBï¼Œç»“æŸä¸ç”¨è°ƒç”¨pthread_joinè¿›è¡Œå›æ”¶
<br>
<br><font color=black size = 5><a name="bc15">çº¿ç¨‹å±æ€§ç®€ä»‹</a></font>
<br> â— Linuxä¸‹çº¿ç¨‹çš„å±æ€§æ˜¯å¯ä»¥æ ¹æ®å®é™…é¡¹ç›®éœ€æ±‚è¿›è¡Œè®¾ç½®çš„ï¼Œä¹‹å‰æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯çº¿ç¨‹çš„é»˜è®¤å±æ€§ï¼Œé»˜è®¤å±æ€§å·²ç»å¯ä»¥è§£å†³ç»å¤§å¤šæ•°å¼€å‘æ—¶é‡åˆ°çš„é—®é¢˜ï¼Œå¦‚æˆ‘ä»¬å¯¹ç¨‹åºçš„æ€§èƒ½æå‡ºæ›´é«˜çš„è¦æ±‚ï¼Œé‚£ä¹ˆå°±éœ€è¦è®¾ç½®çº¿ç¨‹å±æ€§ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡è®¾ç½®çº¿ç¨‹æ ˆçš„å¤§å°æ¥é™ä½å†…å­˜çš„ä½¿ç”¨ï¼Œå¢åŠ æœ€å¤§çº¿ç¨‹ä¸ªæ•°ã€‚
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">typedef</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">struct</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;etachstate;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//çº¿ç¨‹çš„åˆ†ç¦»çŠ¶æ€<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;schedpolicy;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//çº¿ç¨‹è°ƒåº¦ç­–ç•¥<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">struct</span><span style="color:#000000;">&nbsp;sched_param&nbsp;&nbsp;schedparam;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//çº¿ç¨‹çš„è°ƒåº¦å‚æ•°<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;inheritsched;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//çº¿ç¨‹çš„ç»§æ‰¿æ€§<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;scope;&nbsp;&nbsp;</span><span style="color:#008000;">//çº¿ç¨‹çš„ä½œç”¨åŸŸ<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;guardsize;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//çº¿ç¨‹æ ˆæœ«å°¾çš„è­¦æˆ’ç¼“å†²åŒºå¤§å°<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;stackaddr_set;&nbsp;&nbsp;</span><span style="color:#008000;">//çº¿ç¨‹çš„æ ˆè®¾ç½®<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">*&nbsp;stackaddr;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//çº¿ç¨‹æ ˆçš„ä½ç½®<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;stacksize;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//çº¿ç¨‹æ ˆçš„å¤§å°<BR>
</span><span style="color:#000000;">}&nbsp;pthread_attr_t;</span></div></td></tr></table></div>
<br> â— ä¸»è¦ç»“æ„ä½“æˆå‘˜ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0ã€çº¿ç¨‹åˆ†ç¦»çŠ¶æ€
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1ã€çº¿ç¨‹æ ˆçš„å¤§å° (é»˜è®¤å¹³å‡åˆ†é…è¿›ç¨‹ç©ºé—´(ä¸€èˆ¬ä¸º8M))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2ã€çº¿ç¨‹æ ˆè­¦æˆ’ç¼“å†²åŒºå¤§å° (ä½äºæ ˆæœ«å°¾ï¼Œé˜²æ­¢æº¢å‡º)
<br> â— å±æ€§å€¼ä¸èƒ½ç›´æ¥è®¾ç½®ï¼Œå¿…é¡»ä½¿ç”¨ç›¸å…³å‡½æ•°è¿›è¡Œæ“ä½œï¼Œåˆå§‹åŒ–çš„å‡½æ•°ä¸º pthread_attr_init() å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¿…é¡»åœ¨ pthread_create() å‡½æ•°ä¹‹å‰è°ƒç”¨ï¼Œä¹‹åå¿…é¡»ä½¿ç”¨ pthread_attr_destroy() å‡½æ•°æ¥é‡Šæ”¾èµ„æºã€‚
<br> â— çº¿ç¨‹å±æ€§ä¸»è¦åŒ…æ‹¬ï¼šä½œç”¨åŸŸ(scope)ã€æ ˆå°ºå¯¸(stack size)ã€æ ˆåœ°å€(stack address)ã€ä¼˜å…ˆçº§(priority)ã€åˆ†ç±»çš„çŠ¶æ€(detached status)ã€è°ƒåº¦ç­–ç•¥å’Œå‚æ•°(scheduling policy and parameters)ï¼Œé»˜è®¤çš„å±æ€§ä¸ºéç»‘å®šã€éåˆ†ç¦»ã€ç¼ºçœçš„å †æ ˆã€ä¸çˆ¶è¿›ç¨‹åŒæ ·çº§åˆ«çš„ä¼˜å…ˆçº§ã€‚
<br>
<br><font color=black size = 5><a name="bc16">çº¿ç¨‹å±æ€§åˆå§‹åŒ–</a></font>
<br> ğŸ¤­ æ³¨æ„ï¼šåº”å…ˆåˆå§‹åŒ–çº¿ç¨‹å±æ€§ï¼Œå†pthread_createåˆ›å»ºçº¿ç¨‹
<br> â— åˆå§‹åŒ–çº¿ç¨‹å±æ€§
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_attr_init(pthread_attr_t *attr);  æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é”™è¯¯å·
<br> â— é”€æ¯çº¿ç¨‹å±æ€§æ‰€å ç”¨çš„èµ„æº
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_attr_destroy(pthread_attr_t *attr);   æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é”™è¯¯å·
<br>
<br><font color=black size = 5><a name="bc17">çº¿ç¨‹çš„åˆ†ç¦»çŠ¶æ€</a></font>
<br> â— çº¿ç¨‹çš„åˆ†ç¦»çŠ¶æ€å†³å®šä¸€ä¸ªçº¿ç¨‹ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼æ¥ç»ˆæ­¢è‡ªå·±ã€‚
<br> â— éåˆ†ç¦»çŠ¶æ€ï¼šçº¿ç¨‹çš„é»˜è®¤å±æ€§æ˜¯éåˆ†ç¦»çŠ¶æ€ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒåŸæœ‰çš„çº¿ç¨‹ç­‰å¾…åˆ›å»ºçš„çº¿ç¨‹ç»“æŸã€‚åªæœ‰å½“pthread_join()å‡½æ•°è¿”å›æ—¶ï¼Œåˆ›å»ºçš„çº¿ç¨‹æ‰ç®—ç»ˆæ­¢ï¼Œæ‰èƒ½é‡Šæ”¾è‡ªå·±å ç”¨çš„ç³»ç»Ÿèµ„æºã€‚
<br> â— åˆ†ç¦»çŠ¶æ€ï¼šåˆ†ç¦»çº¿ç¨‹æ²¡æœ‰è¢«å…¶ä»–çš„çº¿ç¨‹æ‰€ç­‰å¾…ï¼Œè‡ªå·±è¿è¡Œç»“æŸäº†ï¼Œçº¿ç¨‹ä¹Ÿå°±ç»ˆæ­¢äº†ï¼Œé©¬ä¸Šé‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚åº”è¯¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œé€‰æ‹©é€‚å½“çš„åˆ†ç¦»çŠ¶æ€ã€‚
<br>
<br><font color=black size = 5><a name="bc18">çº¿ç¨‹åˆ†ç¦»çŠ¶æ€çš„å‡½æ•°</a></font>
<br> â— è®¾ç½®çº¿ç¨‹å±æ€§ï¼Œåˆ†ç¦»oréåˆ†ç¦»
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_attr_setdetachstate(pthread_attr_t *attr, int detachstate);
<br> â— è·å–ç¨‹å±æ€§ï¼Œåˆ†ç¦»oréåˆ†ç¦»
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_attr_getdetachstate(pthread_attr_t *attr, int *detachstate);
<br> â— å‚æ•°ï¼š  attrï¼šå·²åˆå§‹åŒ–çš„çº¿ç¨‹å±æ€§
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; detachstateï¼šPTHREAD_CREATE_DETACHED (åˆ†ç¦»çº¿ç¨‹)ã€PTHREAD _CREATE_JOINABLE (éåˆ†ç¦»çº¿ç¨‹)
<br> â— è¿™é‡Œè¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœè®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºåˆ†ç¦»çº¿ç¨‹ï¼Œè€Œè¿™ä¸ªçº¿ç¨‹è¿è¡Œåˆéå¸¸å¿«ï¼Œå®ƒå¾ˆå¯èƒ½åœ¨pthread_createå‡½æ•°è¿”å›ä¹‹å‰å°±ç»ˆæ­¢äº†ï¼Œå®ƒç»ˆæ­¢ä»¥åå°±å¯èƒ½å°†çº¿ç¨‹å·å’Œç³»ç»Ÿèµ„æºç§»äº¤ç»™å…¶ä»–çš„çº¿ç¨‹ä½¿ç”¨ï¼Œè¿™æ ·è°ƒç”¨pthread_createçš„çº¿ç¨‹å°±å¾—åˆ°äº†é”™è¯¯çš„çº¿ç¨‹å·ã€‚è¦é¿å…è¿™ç§æƒ…å†µå¯ä»¥é‡‡å–ä¸€å®šçš„åŒæ­¥æªæ–½ï¼Œæœ€ç®€å•çš„æ–¹æ³•ä¹‹ä¸€æ˜¯å¯ä»¥åœ¨è¢«åˆ›å»ºçš„çº¿ç¨‹é‡Œè°ƒç”¨pthread_cond_timedwaitå‡½æ•°ï¼Œè®©è¿™ä¸ªçº¿ç¨‹ç­‰å¾…ä¸€ä¼šå„¿ï¼Œç•™å‡ºè¶³å¤Ÿçš„æ—¶é—´è®©å‡½æ•°pthread_createè¿”å›ã€‚è®¾ç½®ä¸€æ®µç­‰å¾…æ—¶é—´ï¼Œæ˜¯åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹é‡Œå¸¸ç”¨çš„æ–¹æ³•ã€‚ä½†æ˜¯æ³¨æ„ä¸è¦ä½¿ç”¨è¯¸å¦‚wait()ä¹‹ç±»çš„å‡½æ•°ï¼Œå®ƒä»¬æ˜¯ä½¿æ•´ä¸ªè¿›ç¨‹ç¡çœ ï¼Œå¹¶ä¸èƒ½è§£å†³çº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚
<br>
<br><font color=black size = 5><a name="bc19">è¿›çº¿ç¨‹çš„æ ˆåœ°å€</a></font>
<br> â— POSIX.1å®šä¹‰äº†ä¸¤ä¸ªå¸¸é‡_POSIX_THREAD_ATTR_STACKADDR å’Œ_POSIX_THREAD_ATTR_STACKSIZEæ£€æµ‹ç³»ç»Ÿæ˜¯å¦æ”¯æŒæ ˆå±æ€§ã€‚ä¹Ÿå¯ä»¥ç»™ sysconf() å‡½æ•°ä¼ é€’_SC_THREAD_ATTR_STACKADDRæˆ– _SC_THREAD_ATTR_STACKSIZEæ¥è¿›è¡Œæ£€æµ‹ã€‚
<br> â— å½“è¿›ç¨‹æ ˆåœ°å€ç©ºé—´ä¸å¤Ÿç”¨æ—¶ï¼ŒæŒ‡å®šæ–°å»ºçº¿ç¨‹ä½¿ç”¨ç”±mallocåˆ†é…çš„ç©ºé—´ä½œä¸ºè‡ªå·±çš„æ ˆç©ºé—´ã€‚é€šè¿‡pthread_attr_setstackå’Œpthread_attr_getstackä¸¤ä¸ªå‡½æ•°åˆ†åˆ«è®¾ç½®å’Œè·å–çº¿ç¨‹çš„æ ˆåœ°å€ã€‚
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_attr_setstack(pthread_attr_t *attr, void *stackaddr, size_t stacksize);     æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é”™è¯¯å·
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_attr_getstack(pthread_attr_t *attr, void **stackaddr, size_t *stacksize);     æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é”™è¯¯å·
<br> â— å‚æ•°ï¼šattrï¼šæŒ‡å‘ä¸€ä¸ªçº¿ç¨‹å±æ€§çš„æŒ‡é’ˆ
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stackaddrï¼šè¿”å›è·å–çš„æ ˆåœ°å€
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stacksizeï¼šè¿”å›è·å–çš„æ ˆå¤§å°
<br>
<br><font color=black size = 5><a name="bc20">çº¿ç¨‹çš„æ ˆå¤§å°</a></font>
<br> â— å½“ç³»ç»Ÿä¸­æœ‰å¾ˆå¤šçº¿ç¨‹æ—¶ï¼Œå¯èƒ½éœ€è¦å‡å°æ¯ä¸ªçº¿ç¨‹æ ˆçš„é»˜è®¤å¤§å°ï¼Œé˜²æ­¢è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸å¤Ÿç”¨ï¼Œå½“çº¿ç¨‹è°ƒç”¨çš„å‡½æ•°ä¼šåˆ†é…å¾ˆå¤§çš„å±€éƒ¨å˜é‡æˆ–è€…å‡½æ•°è°ƒç”¨å±‚æ¬¡å¾ˆæ·±æ—¶ï¼Œå¯èƒ½éœ€è¦å¢å¤§çº¿ç¨‹æ ˆçš„é»˜è®¤å¤§å°ã€‚
<br> â— å‡½æ•°pthread_attr_getstacksizeå’Œ pthread_attr_setstacksizeæä¾›è®¾ç½®ã€‚
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_attr_setstacksize(pthread_attr_t *attr, size_t stacksize);   æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é”™è¯¯å·
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pthread_attr_getstacksize(pthread_attr_t *attr, size_t *stacksize);     æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é”™è¯¯å·
<br> â— å‚æ•°ï¼š attrï¼šæŒ‡å‘ä¸€ä¸ªçº¿ç¨‹å±æ€§çš„æŒ‡é’ˆ
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stacksizeï¼šè¿”å›çº¿ç¨‹çš„å †æ ˆå¤§å°
<br>
<br><font color=black size = 5><a name="bc21">çº¿ç¨‹å±æ€§æ§åˆ¶ç¤ºä¾‹</a></font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;pthread.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;stdio.h&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;stdlib.h&gt;<BR>
<BR>
</span><span style="color:#0000ff;">#define</span><span style="color:#000000;">&nbsp;SIZE&nbsp;0x100000&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;æ¯ä¸ªçº¿ç¨‹å¤§å°<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*th_fun(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*arg)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
}<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main(</span><span style="color:#8000ff;">void</span><span style="color:#000000;">)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;pthread_t&nbsp;tid;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;err,&nbsp;detachstate,&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">1</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;pthread_attr_t&nbsp;attr;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;stacksize;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;*stackaddr;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;pthread_attr_init(&amp;attr);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;pthread_attr_getstack(&amp;attr,&nbsp;&amp;stackaddr,&nbsp;&amp;stacksize);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;pthread_attr_getdetachstate(&amp;attr,&nbsp;&amp;detachstate);<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(detachstate&nbsp;==&nbsp;PTHREAD_CREATE_DETACHED)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(</span><span style="color:#800000;">&quot;thread&nbsp;detached\n&quot;</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">else</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(detachstate&nbsp;==&nbsp;PTHREAD_CREATE_JOINABLE)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(</span><span style="color:#800000;">&quot;thread&nbsp;join\n&quot;</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">else</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(</span><span style="color:#800000;">&quot;thread&nbsp;unknown\n&quot;</span><span style="color:#000000;">);<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;pthread_attr_setdetachstate(&amp;attr,&nbsp;PTHREAD_CREATE_DETACHED);<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stackaddr&nbsp;=&nbsp;malloc(SIZE);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(stackaddr&nbsp;==&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">)&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(</span><span style="color:#800000;">&quot;malloc&quot;</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stacksize&nbsp;=&nbsp;SIZE;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pthread_attr_setstack(&amp;attr,&nbsp;stackaddr,&nbsp;stacksize);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;pthread_create(&amp;tid,&nbsp;&amp;attr,&nbsp;th_fun,&nbsp;</span><span style="color:#0000ff;">NULL</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(err&nbsp;!=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">)&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(</span><span style="color:#800000;">&quot;%s\n&quot;</span><span style="color:#000000;">,&nbsp;strerror(err));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(</span><span style="color:#800000;">&quot;%d\n&quot;</span><span style="color:#000000;">,&nbsp;i++);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;pthread_attr_destroy(&amp;attr);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br>
<br><font color=black size = 5><a name="bc22">NPTL (åœ¨ä½¿ç”¨æ—¶æ³¨æ„çº¿ç¨‹åº“çš„ç‰ˆæœ¬)</a></font>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0ã€å¯Ÿçœ‹å½“å‰pthreadåº“ç‰ˆæœ¬getconf GNU_LIBPTHREAD_VERSION
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1ã€NPTL(çº¿ç¨‹åº“ç‰ˆæœ¬å·)å®ç°æœºåˆ¶(POSIX)ï¼ŒNative POSIX Thread Library
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2ã€ä½¿ç”¨çº¿ç¨‹åº“æ—¶gccæŒ‡å®š â€“lpthread
<br>
<br><font color=black size = 5><a name="bc23">çº¿ç¨‹ä½¿ç”¨æ³¨æ„äº‹é¡¹</a></font>
<br>&nbsp;&nbsp;&nbsp;&nbsp; 0ã€ä¸»çº¿ç¨‹é€€å‡ºå…¶ä»–çº¿ç¨‹ä¸é€€å‡ºï¼Œä¸»çº¿ç¨‹åº”è°ƒç”¨pthread_exit
<br>&nbsp;&nbsp;&nbsp;&nbsp; 1ã€é¿å…åƒµå°¸çº¿ç¨‹
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pthread_join()
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pthread_detach()
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pthread_create() æŒ‡å®šåˆ†ç¦»å±æ€§
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; è¢«joinçº¿ç¨‹å¯èƒ½åœ¨joinå‡½æ•°è¿”å›å‰å°±é‡Šæ”¾å®Œè‡ªå·±çš„æ‰€æœ‰å†…å­˜èµ„æºï¼Œæ‰€ä»¥ä¸åº”å½“è¿”å›è¢«å›æ”¶çº¿ç¨‹æ ˆä¸­çš„å€¼;
<br>&nbsp;&nbsp;&nbsp;&nbsp; 2ã€mallocå’Œmmapç”³è¯·çš„å†…å­˜å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é‡Šæ”¾
<br>&nbsp;&nbsp;&nbsp;&nbsp; 3ã€åº”é¿å…åœ¨å¤šçº¿ç¨‹æ¨¡å‹ä¸­è°ƒç”¨forkï¼Œé™¤éé©¬ä¸Šexecï¼Œå­è¿›ç¨‹ä¸­åªæœ‰è°ƒç”¨forkçš„çº¿ç¨‹å­˜åœ¨ï¼Œå…¶ä»–çº¿ç¨‹åœ¨å­è¿›ç¨‹ä¸­å‡è¢«pthread_exit
<br>&nbsp;&nbsp;&nbsp;&nbsp; 4ã€ä¿¡å·çš„å¤æ‚è¯­ä¹‰å¾ˆéš¾å’Œå¤šçº¿ç¨‹å…±å­˜ï¼Œåº”é¿å…åœ¨å¤šçº¿ç¨‹å¼•å…¥ä¿¡å·æœºåˆ¶</p>

<p><br><br><br>
<font color = gray size = 3>å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼</font></p></div>
        <div class="post_footer">
          
          <div class="meta">
            <div class="info">
              <span class="field tags">
                <i class="remixicon-stack-line"></i>
                
                <a href="https://oubc.github.io/tags/linux/">Linux</a>
                
              </span>
            </div>
          </div>
          
        </div>
      </div>
      
      
    </div>
  </div>
  <a id="back_to_top" href="#" class="back_to_top"><span>â–³</span></a>
</div>
<footer class="footer">
  <div class="powered_by">
    <a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4l9lmg4aog3074074gnf.gif?tags=%5B%5D">I </a>
	<a href="">love</a>
    <a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4l9lmfm2eg306o06o74u.gif?tags=%5B%5D"> you </a>
    <a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4njrx4tpcj30fn0bq3zg.jpg?tags=%5B%5D">three </a>
	<a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4njrx64ctg307s07swfy.gif?tags=%5B%5D">thousand</a>
    <a href="https://www.kugou.com/song/#hash=96426C78381DE98DC31A5846FC274CBF&album_id=646623"> times.</a>
  </div>

  <div class="footer_slogan">
    <span>å®¶åº­ã€æ¢¦æƒ³ã€å†…å¿ƒçš„å¹³é™</span>
  </div>
</footer>



<script src="https://oubc.github.io/js/jquery-3.3.1.min.js"></script>
<script src="https://oubc.github.io/js/zozo.js"></script>
<script src="https://oubc.github.io/js/highlight.pack.js"></script>
<link  href="https://oubc.github.io/css/fancybox.min.css" rel="stylesheet">
<script src="https://oubc.github.io/js/fancybox.min.js"></script>

<script>hljs.initHighlightingOnLoad()</script>


  <script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>






</body>
</html>
