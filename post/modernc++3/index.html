<!DOCTYPE html>
<html lang="zh-cn" >
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  
  <meta name="author"
        content="Bruce Cheung"/>

  
  <meta name="description" content=""/>
  

  
  
  <meta name="keywords" content="blog, simple, dream"/>
  

  
  <link rel="canonical" href="https://oubc.github.io/post/modernc&#43;&#43;3/"/>

  

  <title>Modern C&#43;&#43; å¤šçº¿ç¨‹ condition_varible &middot; Love, or death</title>

  <link rel="shortcut icon" href="https://oubc.github.io/images/favicon.ico"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/animate.min.css"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/remixicon.css"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/zozo.css"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/highlight.css"/>

  
  
</head>

<body>
<div class="main animated">
  <div class="nav_container animated fadeInDown">
  <div class="site_nav" id="site_nav">
    <ul>
      
      <li>
        <a href="/">é¦–é¡µ</a>
      </li>
      
      <li>
        <a href="/post/">å½’æ¡£</a>
      </li>
      
      <li>
        <a href="/tags/">æ ‡ç­¾</a>
      </li>
      
      <li>
        <a href="/about/">å…³äº</a>
      </li>
      
    </ul>
  </div>
  <div class="menu_icon">
    <a id="menu_icon"><i class="remixicon-links-line"></i></a>
  </div>
</div>

  <div class="header animated fadeInDown">
  <div class="site_title_container">
    <div class="site_title">
      <h1>
        <a href="https://oubc.github.io/">
          <span>Love, or death</span>
          <img src="https://oubc.github.io/images/logo.svg"/>
        </a>
      </h1>
    </div>
    <div class="description">
      <p class="sub_title">For you, a thousand times over.</p>
      <div class="my_socials">
        
        
        <a href="https://github.com/oubc" title="github" target="_blank"><i class="remixicon-github-fill"></i></a>
        
        
        
        <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=uYGOjo6OiIuLivnIyJfa1tQ" title="mail" target="_blank"><i class="remixicon-mail-fill"></i></a>
        
        
        
        <a href="http://sighttp.qq.com/msgrd?v=1&amp;uin=877771223" title="qq" target="_blank"><i class="remixicon-qq-fill"></i></a>
        
        
        
        <a href="https://github.com/oubc/oubc.github.io/blob/master/images/wx.jpg?raw=true" title="wechat" target="_blank"><i class="remixicon-wechat-fill"></i></a>
        
        
        
        <a href="https://weibo.com/u/6993631995?topnav=1&amp;wvr=6&amp;topsug=1" title="weibo" target="_blank"><i class="remixicon-weibo-fill"></i></a>
        
        
        <a href="https://oubc.github.io/index.xml" type="application/rss+xml" title="rss" target="_blank"><i class="remixicon-rss-fill"></i></a>
      </div>
    </div>
  </div>
</div>

  <div class="content">
    <div class="post_page">
      <div class="post animated fadeInDown">
        <div class="post_title post_detail_title">
          <h2><a href='/post/modernc&#43;&#43;3/'>Modern C&#43;&#43; å¤šçº¿ç¨‹ condition_varible</a></h2>
          <span class="date">2020.02.13</span>
        </div>
        <div class="post_content markdown"><p><br>
<br><font color=green size = 5>C++æ–°æ ‡å‡†ä¹‹å¤šçº¿ç¨‹ condition_varibleæ¡ä»¶å˜é‡</font>
<br>
<br><font color = gray size = 3>ç›®å½•</font><font color = gray size = 2> (ç‚¹å‡»è·³è½¬)</font>
<br><a href="#bc0"><font color=yellow size = 4>&lt;condition_variable&gt;å¤´æ–‡ä»¶</font></a>
<br><a href="#bc1"><font color=blue size = 4>class condition_variable</font></a>
<br><a href="#bc2"><font color=pink size = 4>class condition_variable_any</font></a>
<br><a href="#bc3"><font color=purple size = 4>Enum classes</font></a>
<br><a href="#bc4"><font color=cyan size = 4>Other functions</font></a>
<br>
<br>
<br> â— äº’æ–¥é‡æ˜¯å¤šçº¿ç¨‹é—´åŒæ—¶è®¿é—®æŸä¸€å…±äº«å˜é‡æ—¶ï¼Œä¿è¯å˜é‡å¯è¢«å®‰å…¨è®¿é—®çš„æ‰‹æ®µ
<br> â— åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œè¿˜æœ‰å¦ä¸€ç§ååˆ†å¸¸è§çš„è¡Œä¸ºï¼šçº¿ç¨‹åŒæ­¥ï¼Œçº¿ç¨‹åŒæ­¥æ˜¯æŒ‡çº¿ç¨‹é—´éœ€è¦æŒ‰ç…§é¢„å®šçš„å…ˆåæ¬¡åºé¡ºåºè¿›è¡Œçš„è¡Œä¸º
<br> â— C++æ–°æ ‡å‡†å¯¹è¿™ç§è¡Œä¸ºä¹Ÿæä¾›äº†æœ‰åŠ›çš„æ”¯æŒï¼Œè¿™å°±æ˜¯æ¡ä»¶å˜é‡ï¼Œæ¡ä»¶å˜é‡ä½äºå¤´æ–‡ä»¶&lt;condition_variable&gt;ä¸­
<br>
<br><a name="bc0"><font color=green size = 5>&lt;condition_variable&gt;</font></a>
<br> â— &lt;condition_variable&gt;å¤´æ–‡ä»¶ä¸»è¦åŒ…å«äº†ä¸æ¡ä»¶å˜é‡ç›¸å…³çš„ç±»å’Œå‡½æ•°
<br> â— ä¸»è¦å«æœ‰ç±»condition_variableå’Œcondition_variable_anyï¼Œæšä¸¾cv_statusï¼Œå‡½æ•°notify_all_at_thread_exit
<br><table border="4">
<tr>
<th>Classes</th>
<th>description</th>
</tr>
<tr>
<td>condition_variable</td>
<td>æä¾›äº†std::unique_lockç›¸å…³è”çš„æ¡ä»¶å˜é‡</td>
</tr>
<tr>
<td>condition_variable_any</td>
<td>æä¾›ä¸ä»»ä½•é”ç±»å‹ç›¸å…³è”çš„æ¡ä»¶å˜é‡</td>
</tr>
</table>
<br><table border="4">
<tr>
<th>Enum classes</th>
<th>description</th>
</tr>
<tr>
<td>cv_status</td>
<td>åˆ—å‡ºåœ¨æ¡ä»¶å˜é‡ä¸Šé™æ—¶ç­‰å¾…çš„å¯èƒ½ç»“æœ (æšä¸¾)</td>
</tr>
</table>
<br><table border="4">
<tr>
<th>Functions</th>
<th>description</th>
</tr>
<tr>
<td>notify_all_at_thread_exit</td>
<td>å½“è¿™ä¸ªçº¿ç¨‹å®Œå…¨å®Œæˆ(å‡½æ•°)æ—¶ï¼Œè°ƒåº¦è°ƒç”¨notify_all</td>
</tr>
</table>
<br> â— ç»“æ„å®šä¹‰ï¼š
 <br>namespace std
 <br>{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class condition_variable;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class condition_variable_any;
 <br>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void notify_all_at_thread_exit(condition_variable&amp; cond, unique_lock<mutex> lk);
 <br>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enum class cv_status
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_timeout;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timeout;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};
 <br>}
<br>
<br><a name="bc1"><font color=green size = 5>classe condition_variable</font></a>
<br>
<br><font color=blue size = 5>std::condition_variable</font>
<br> â— æ¡ä»¶å˜é‡æä¾›äº†ä¸¤ç±»æ“ä½œï¼šwaitå’Œnotifyï¼Œè¿™ä¸¤ç±»æ“ä½œæ„æˆäº†å¤šçº¿ç¨‹åŒæ­¥çš„åŸºç¡€ï¼›
<br> â— æ¡ä»¶å˜é‡ç±»æ˜¯ä¸€ä¸ªåŒæ­¥åŸè¯­ï¼Œå®ƒå¯ä»¥é˜»å¡ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ä¸€ä¸ªå…±äº«å˜é‡(æ¡ä»¶)ï¼Œå¹¶é€šçŸ¥æ¡ä»¶å˜é‡ï¼›
<br> â— æ¡ä»¶å˜é‡èƒ½å¤Ÿé˜»å¡è°ƒç”¨çº¿ç¨‹çš„å¯¹è±¡ï¼Œç›´åˆ°é€šçŸ¥æ¢å¤ä¸ºæ­¢
<br>å®ƒä½¿ç”¨unique_lockæ¥é”å®šçº¿ç¨‹ï¼Œå½“å®ƒçš„ä¸€ä¸ªç­‰å¾…å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œçº¿ç¨‹ä»ç„¶è¢«é˜»å¡ï¼Œç›´åˆ°è¢«å¦ä¸€ä¸ªçº¿ç¨‹å”¤é†’ï¼Œè¯¥çº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªæ¡ä»¶å˜é‡å¯¹è±¡ä¸Šçš„é€šçŸ¥å‡½æ•°ï¼›
<br> â— ç±»å‹æ¡ä»¶å˜é‡çš„å¯¹è±¡æ€»æ˜¯ä½¿ç”¨unique_lock&lt;mutex&gt;ç­‰å¾…ï¼Œå¯¹äºå¯ä»¥ä½¿ç”¨ä»»ä½•ç±»å‹çš„å¯é”å®šç±»å‹çš„é€‰é¡¹ï¼Œå‚è§condition_variable_anyã€‚
<br>
<br><font color=purple size = 4>(constructor)æ„é€ å‡½æ•°</font>
<br> â— å®šä¹‰ï¼š condition_variable(); default (1)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;condition_variable (const condition_variable&amp;) = delete; copy[deleted] (2)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;operator=   [deleted]
<br> * æ„é€ ä¸€ä¸ªcondition_variableå¯¹è±¡
<br> * æ¡ä»¶å˜é‡ä¸èƒ½è¢«å¤åˆ¶/ç§»åŠ¨
<br> * å¦‚æœæ„å»ºå¤±è´¥ï¼Œå°†æŠ›å‡ºsystem_errorå¼‚å¸¸ï¼Œæ ¹æ®åº“çš„å®ç°ï¼Œä¹Ÿå¯èƒ½åœ¨å…¶å®ƒæƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸
<br><table border="2">
<tr>
<th>exception type</th>
<th>error condition</th>
<th>description</th>
</tr>
<tr>
<td>system_error</td>
<td>errc::resource_unavailable_try_again</td>
<td>èµ„æºé™åˆ¶(é™¤äº†å†…å­˜åˆ†é…)é˜²æ­¢åˆå§‹åŒ–</td>
</tr>
</table>
<br><font color=purple size = 4>(destructor)ææ„å‡½æ•°</font>
<br> â— ç ´åcondition_variableå¯¹è±¡
<br> â— åœ¨æ­¤ç ´åä¸‹è¢«é˜»å¡çš„ä»»ä½•çº¿ç¨‹åœ¨æ­¤ææ„ä¹‹å‰éƒ½å°†è¢«é€šçŸ¥
<br> â— åœ¨ææ„å‡½æ•°è¢«è°ƒç”¨ä¹‹åï¼Œæ²¡æœ‰çº¿ç¨‹å°†å¼€å§‹ç­‰å¾…
<br>æ³¨ï¼š
<br> 1.å¦‚æœæ‰€æœ‰çº¿ç¨‹è¢«é€šçŸ¥ï¼Œè°ƒç”¨ææ„å‡½æ•°æ˜¯å®‰å…¨çš„ï¼Œå®ƒä»¬ä¸éœ€è¦é€€å‡ºå„è‡ªçš„ç­‰å¾…å‡½æ•°ï¼Œä¸€äº›çº¿ç¨‹å¯èƒ½è¿˜åœ¨ç­‰å¾…é‡æ–°è·å¾—ç›¸å…³çš„é”ï¼Œæˆ–è€…ç­‰å¾…è°ƒåº¦å†é‡æ–°è·å¾—å®ƒä¹‹åè¿è¡Œï¼›
<br>2.ç¨‹åºå‘˜å¿…é¡»ç¡®ä¿åœ¨å¯åŠ¨ææ„å‡½æ•°æ—¶æ²¡æœ‰çº¿ç¨‹è¯•å›¾ç­‰å¾…*thisï¼Œç‰¹åˆ«æ˜¯ç­‰å¾…çº¿ç¨‹è°ƒç”¨å¾ªç¯ä¸­çš„ç­‰å¾…å‡½æ•°æˆ–ä½¿ç”¨æ‰§è¡Œè°“è¯çš„ç­‰å¾…å‡½æ•°çš„é‡è½½æ—¶ã€‚
<br>
<br><font color=blue size = 5>Wait functions</font>
<br>
<br><font color=purple size = 4>std::condition_variable::wait</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;wait&nbsp;(unique_lock&lt;mutex&gt;&nbsp;&amp;lck);&nbsp;unconditional&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Predicate&gt;&nbsp;predicate&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;wait&nbsp;(unique_lock&lt;mutex&gt;&nbsp;&amp;lck,&nbsp;Predicate&nbsp;pred);</span></div></td></tr></table></div>
1.å½“å‰çº¿ç¨‹çš„æ‰§è¡Œ(è¯¥çº¿ç¨‹å°†é”å®šlckçš„äº’æ–¥é”)å°†è¢«é˜»å¡ï¼Œç›´åˆ°è¢«é€šçŸ¥ï¼›
<br>2.åœ¨é˜»å¡çº¿ç¨‹çš„æ—¶åˆ»ï¼Œè¯¥å‡½æ•°å°†è‡ªåŠ¨è°ƒç”¨lck.unlock()ï¼Œå…è®¸å…¶å®ƒé”å®šçš„çº¿ç¨‹ç»§ç»­è¿è¡Œï¼›
<br>3.ä¸€æ—¦è¢«é€šçŸ¥ï¼Œå‡½æ•°å°±unlockå¹¶è°ƒç”¨lck.lock()ï¼Œåœ¨è°ƒç”¨å‡½æ•°æ—¶å°†lckç•™åœ¨ç›¸åŒçš„çŠ¶æ€ï¼Œç„¶åå‡½æ•°è¿”å›(æ³¨ï¼šæœ€åä¸€ä¸ªäº’æ–¥é”å¯èƒ½ä¼šåœ¨è¿”å›ä¹‹å‰é˜»å¡çº¿ç¨‹)ï¼›
<br>4.ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‡½æ•°ä¼šè¢«å¦ä¸€ä¸ªçº¿ç¨‹çš„è°ƒç”¨å”¤é†’ï¼Œæ— è®ºæ˜¯å¯¹æˆå‘˜notify_oneè¿˜æ˜¯notify_allï¼Œä½†æ˜¯æŸäº›å®ç°å¯èƒ½äº§ç”Ÿè™šå‡çš„å”¤é†’è°ƒç”¨ï¼Œè€Œä¸éœ€è¦è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œå› æ­¤ï¼Œè¯¥å‡½æ•°çš„ç”¨æˆ·å°†ç¡®ä¿æ»¡è¶³æ¢å¤çš„æ¡ä»¶ï¼›
<br>5.å®šä¹‰(2)å¦‚æœæŒ‡å®špredï¼Œå¦‚æœpredè¿”å›falseï¼Œåˆ™å‡½æ•°åªä¼šé˜»å¡ï¼Œå¹¶ä¸”åªæœ‰å½“å®ƒå˜ä¸ºtrueæ—¶ï¼Œé€šçŸ¥æ‰èƒ½è§£é™¤çº¿ç¨‹(è¿™å¯¹äºæ£€æŸ¥ä¼ªå”¤é†’ç‰¹åˆ«æœ‰ç”¨)ï¼›
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç±»ä¼¼è¿™æ ·çš„å®ç°ï¼šwhile(!pred()) wait(lck);
<br>
<br><font color=purple size = 4>std::condition_variable::wait_for</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;">(<span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;unconditional<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Rep,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Period&gt;<BR>
cv_status&nbsp;wait_for&nbsp;(unique_lock&lt;mutex&gt;&nbsp;&amp;lck,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;chrono::duration&lt;Rep,&nbsp;Period&gt;&nbsp;&amp;rel_time);<BR>
(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;predicate<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Rep,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Period,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Predicate&gt;<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;wait_for&nbsp;(unique_lock&lt;mutex&gt;&nbsp;&amp;lck,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;chrono::duration&lt;Rep,&nbsp;Period&gt;&nbsp;&amp;rel_time,&nbsp;Predicate&nbsp;pred);</span></div></td></tr></table></div>
1.å½“å‰æ‰§è¡Œçº¿ç¨‹åœ¨rel_timeæ—¶é—´å†…æˆ–è€…åœ¨è¢«é€šçŸ¥ä¹‹å‰(è¯¥çº¿ç¨‹é”å®šlckçš„äº’æ–¥é”)è¢«é˜»å¡(å¦‚æœåè€…å…ˆå‘ç”Ÿçš„è¯)ï¼›
<br>2.åœ¨é˜»å¡çº¿ç¨‹çš„æ—¶åˆ»ï¼Œè¯¥å‡½æ•°å°†è‡ªåŠ¨è°ƒç”¨lck.unlock()ï¼Œå…è®¸å…¶å®ƒé”å®šçš„çº¿ç¨‹ç»§ç»­è¿è¡Œï¼›
<br>3.ä¸€æ—¦è¢«é€šçŸ¥æˆ–è€…ä¸€æ¬¡rel_timeæ—¶é—´æ®µå·²ç»è¿‡å»ï¼Œå‡½æ•°å°†ä¼šunblockså¹¶è°ƒç”¨lck. lock()ï¼Œå°†lckä¸è°ƒç”¨å‡½æ•°æ—¶çš„çŠ¶æ€ä¿æŒä¸€è‡´ï¼Œç„¶åå‡½æ•°è¿”å›(æ³¨ï¼šæœ€åä¸€ä¸ªäº’æ–¥é”å¯èƒ½ä¼šåœ¨è¿”å›ä¹‹å‰é˜»å¡çº¿ç¨‹)ï¼›
<br>4.ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‡½æ•°ä¼šè¢«å¦ä¸€ä¸ªçº¿ç¨‹çš„è°ƒç”¨å”¤é†’ï¼Œæ— è®ºæ˜¯å¯¹æˆå‘˜notify_oneè¿˜æ˜¯notify_allï¼Œä½†æ˜¯æŸäº›å®ç°å¯èƒ½äº§ç”Ÿè™šå‡çš„å”¤é†’è°ƒç”¨ï¼Œè€Œä¸éœ€è¦è°ƒç”¨è¿™äº›å‡½æ•°ã€‚å› æ­¤ï¼Œè¯¥å‡½æ•°çš„ç”¨æˆ·å°†ç¡®ä¿æ»¡è¶³æ¢å¤çš„æ¡ä»¶ï¼›
<br>5.å¦‚æœæŒ‡å®špred(å®šä¹‰2)ï¼Œå¦‚æœpredè¿”å›falseï¼Œåˆ™å‡½æ•°åªä¼šé˜»å¡ï¼Œå¹¶ä¸”åªæœ‰å½“å®ƒå˜ä¸ºtrueæ—¶ï¼Œé€šçŸ¥æ‰èƒ½è§£é™¤çº¿ç¨‹(è¿™å¯¹äºæ£€æŸ¥ä¼ªå”¤é†’è°ƒç”¨ç‰¹åˆ«æœ‰ç”¨)ï¼›
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç±»ä¼¼è¿™æ ·çš„å®ç°ï¼šreturn wait_until (lck, chrono::steady_clock::now() + rel_time, std::move(pred));
<br>
<br><font color=purple size = 4>std::condition_variable::wait_until</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;">(<span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;unconditional<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Clock,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Duration&gt;<BR>
cv_status&nbsp;wait_until&nbsp;(unique_lock&lt;mutex&gt;&nbsp;&amp;lck,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;chrono::time_point&lt;Clock,&nbsp;Duration&gt;&nbsp;&amp;abs_time);<BR>
(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;predicate<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Clock,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Duration,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Predicate&gt;<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;wait_until&nbsp;(unique_lock&lt;mutex&gt;&nbsp;&amp;lck,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;chrono::time_point&lt;Clock,&nbsp;Duration&gt;&nbsp;&amp;abs_time,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Predicate&nbsp;pred);</span></div></td></tr></table></div>
1.å½“å‰çº¿ç¨‹çš„æ‰§è¡Œ(è¯¥çº¿ç¨‹å°†é”å®šlckçš„äº’æ–¥é”)ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è¢«é€šçŸ¥æˆ–åˆ°è¾¾abs_timeæ—¶é—´ç‚¹ï¼Œæ— è®ºé‚£ä¸€ä¸ªç¬¬ä¸€æ¬¡å‘ç”Ÿï¼›
<br>2.åœ¨çº¿ç¨‹è¿˜å¤„åœ¨é˜»å¡æ—¶ï¼Œè¯¥å‡½æ•°å°†è‡ªåŠ¨è°ƒç”¨lck.unlock()ï¼Œå…è®¸å…¶ä»–é”å®šçš„çº¿ç¨‹ç»§ç»­è¿è¡Œï¼›
<br>3.ä¸€æ—¦è¢«é€šçŸ¥æˆ–ä¸€æ—¦abs_timeæ—¶é—´åˆ°äº†ï¼Œå‡½æ•°å°±ä¼šæ¥è§¦é˜»å¡çŠ¶æ€å¹¶è°ƒç”¨lck. lock()ï¼Œåœ¨è°ƒç”¨å‡½æ•°æ—¶å°†lckä¸å‡½æ•°çš„çŠ¶æ€ä¿æŒåœ¨åŒä¸€çŠ¶æ€ï¼Œç„¶åå‡½æ•°è¿”å›(æ³¨æ„ï¼Œæœ€åä¸€ä¸ªäº’æ–¥é”å¯èƒ½ä¼šåœ¨è¿”å›ä¹‹å‰é˜»å¡çº¿ç¨‹)ï¼›
<br>4.ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‡½æ•°ä¼šè¢«å¦ä¸€ä¸ªçº¿ç¨‹çš„è°ƒç”¨å”¤é†’ï¼Œæ— è®ºæ˜¯å¯¹æˆå‘˜notify_oneè¿˜æ˜¯æˆå‘˜notify_allã€‚ä½†æ˜¯æŸäº›å®ç°å¯èƒ½äº§ç”Ÿè™šå‡çš„å”¤é†’è°ƒç”¨ï¼Œè€Œä¸éœ€è¦è°ƒç”¨è¿™äº›å‡½æ•°ã€‚å› æ­¤ï¼Œè¯¥å‡½æ•°çš„ä½¿ç”¨è€…å°†è¦ç¡®ä¿æ»¡è¶³æ¢å¤çš„æ¡ä»¶ï¼›
<br>5.(å®šä¹‰2)å¦‚æœæŒ‡å®špredï¼Œå¦‚æœpredè¿”å›falseï¼Œåˆ™å‡½æ•°åªä¼šé˜»å¡ï¼Œå¹¶ä¸”åªæœ‰å½“å®ƒå˜ä¸ºtrueæ—¶ï¼Œé€šçŸ¥æ‰èƒ½è§£é™¤çº¿ç¨‹(è¿™å¯¹äºæ£€æŸ¥ä¼ªå”¤é†’è°ƒç”¨ç‰¹åˆ«æœ‰ç”¨)ï¼›
<br> * ç±»ä¼¼è¿™æ ·çš„å®ç°ï¼š
<br>while (!pred())
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( wait_until(lck,abs_time) == cv_status::timeout)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return pred();
<br>return true;
<br>
<br><font color=blue size = 5>Notify functions</font>
<br> â— notify_one å”¤é†’ç­‰å¾…çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œæ³¨æ„åªå”¤é†’ä¸€ä¸ª
<br> â— notify_all å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œä½¿ç”¨è¯¥å‡½æ•°æ—¶åº”é¿å…å‡ºç°æƒŠç¾¤æ•ˆåº”
<br>
<br><font color=purple size = 4>std::condition_variable::notify_one</font>
<br>å®šä¹‰ï¼švoid notify_one() noexcept;
<br>1.æ‰“å¼€å½“å‰ç­‰å¾…è¯¥æ¡ä»¶çš„ä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœæ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ï¼Œåˆ™è¯¥å‡½æ•°ä»€ä¹ˆéƒ½ä¸åšã€‚å¦‚æœå¤šäºä¸€ä¸ªï¼Œåˆ™ä¸æŒ‡å®šå“ªä¸ªçº¿ç¨‹è¢«é€‰ä¸­ï¼Œä¹Ÿä¸éšæœºï¼Œè€Œæ˜¯ç”±ç­‰å¾…çº¿ç¨‹æŠ¢å ï¼›
<br>2.è¯¥æŒ‡ä»¤é’ˆå¯¹è¿™ä¸ªå•ç‹¬çš„æ¡ä»¶å˜é‡ï¼Œè¿™ä½¿å¾—notify_one()ä¸å¯èƒ½è¢«å»¶è¿Ÿï¼Œå¹¶ä¸”åœ¨è°ƒç”¨notify_one()ä¹‹åæ‰å¼€å§‹ç­‰å¾…ï¼›
<br>3.é€šçŸ¥çº¿ç¨‹ä¸éœ€è¦å°†é”ä¿å­˜åœ¨ä¸ç­‰å¾…çº¿ç¨‹æ‰€æŒæœ‰çš„ç›¸åŒäº’æ–¥é”ä¸Šï¼Œäº‹å®ä¸Šï¼Œè¿™æ ·åšæ˜¯ä¸€ä¸ªæ‚²è§‚çš„æ–¹æ³•ï¼Œå› ä¸ºé€šçŸ¥çš„çº¿ç¨‹ä¼šç«‹å³é˜»å¡ï¼Œç­‰å¾…é€šçŸ¥çº¿ç¨‹é‡Šæ”¾é”ã€‚ç„¶è€Œï¼Œä¸€äº›å®ç°(ç‰¹åˆ«æ˜¯è®¸å¤špthreadså®ç°)è¯†åˆ«è¿™ç§æƒ…å†µï¼Œå¹¶é¿å…è¿™ç§â€œåŒ†å¿™è€Œç­‰å¾…â€çš„åœºæ™¯ï¼Œé€šè¿‡å°†ç­‰å¾…çš„çº¿ç¨‹ä»æ¡ä»¶å˜é‡çš„é˜Ÿåˆ—ç›´æ¥ä¼ é€’åˆ°é€šçŸ¥è°ƒç”¨çš„äº’æ–¥é”çš„é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸å°†å…¶å”¤é†’
<br>
<br><font color=purple size = 4>std::condition_variable::notify_all</font>
<br>å®šä¹‰ï¼švoid notify_all() noexcept;
<br>è§£é”å½“å‰ç­‰å¾…è¯¥æ¡ä»¶çš„æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ï¼Œåˆ™è¯¥å‡½æ•°ä»€ä¹ˆéƒ½ä¸åšï¼›
<br>æ³¨ï¼š
<br>1.notify_one()/notify_all()å’Œwait()/wait_for()/wait_until() ä¸‰ä¸ªåŸå­éƒ¨åˆ†ä¸­çš„æ¯ä¸€ä¸ªå½±å“éƒ½åœ¨ä¸€ä¸ªå®Œå…¨çš„é¡ºåº(è§£é”+ç­‰å¾…, å”¤é†’, é”)ä¸­ï¼Œå¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªåŸå­å˜é‡çš„ä¿®æ”¹é¡ºåºï¼šè¯¥å‘½ä»¤æ˜¯ç‰¹å®šäºè¿™ä¸ªå•ç‹¬çš„æ¡ä»¶å˜é‡çš„ã€‚è¿™ä½¿å¾—notify_one()ä¸å¯èƒ½è¢«å»¶è¿Ÿï¼Œå¹¶ä¸”åœ¨è°ƒç”¨notify_one()ä¹‹åæ‰å¼€å§‹ç­‰å¾…ï¼›
<br>2.é€šçŸ¥çº¿ç¨‹ä¸éœ€è¦å°†é”ä¿å­˜åœ¨ä¸ç­‰å¾…çº¿ç¨‹æ‰€æŒæœ‰çš„ç›¸åŒäº’æ–¥é”ä¸Šï¼›äº‹å®ä¸Šï¼Œè¿™æ ·åšæ˜¯ä¸€ä¸ªæ‚²è§‚çš„æ–¹æ³•ï¼Œå› ä¸ºé€šçŸ¥çš„çº¿ç¨‹ä¼šç«‹å³é˜»å¡ï¼Œç­‰å¾…é€šçŸ¥çº¿ç¨‹é‡Šæ”¾é”ã€‚
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br>79<br>80<br>81<br>82<br>83<br>84<br>85<br>86<br>87<br>88<br>89<br>90<br>91<br>92<br>93<br>94<br>95<br>96<br>97<br>98<br>99<br>100<br>101<br>102<br>103<br>104<br>105<br>106<br>107<br>108<br>109<br>110<br>111<br>112<br>113<br>114<br>115<br>116<br>117<br>118<br>119<br>120<br>121<br>122<br>123<br>124<br>125<br>126<br>127<br>128<br>129<br>130<br>131<br>132<br>133<br>134<br>135<br>136<br>137<br>138<br>139<br>140<br>141<br>142<br>143<br>144<br>145<br>146<br>147<br>148<br>149<br>150<br>151<br>152<br>153<br>154<br>155<br>156<br>157<br>158<br>159<br>160<br>161<br>162<br>163<br>164<br>165<br>166<br>167<br>168<br>169<br>170<br>171<br>172<br>173<br>174<br>175<br>176<br>177<br>178<br>179<br>180<br>181<br>182<br>183<br>184<br>185<br>186<br>187<br>188<br>189<br>190<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;string&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;chrono&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;atomic&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;mutex&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;condition_variable&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
mutex&nbsp;mtx;<BR>
condition_variable&nbsp;cv;<BR>
string&nbsp;da;<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;ready&nbsp;=&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;">;<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;processed&nbsp;=&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;">;<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;cargo&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
mutex&nbsp;cv_m;<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;ve;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;print_id(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;id)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;unique_lock&lt;mutex&gt;&nbsp;lck(mtx);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(!ready)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv.wait(lck);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;thread&nbsp;#&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;id&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;go()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;unique_lock&lt;mutex&gt;&nbsp;lck(mtx);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;ready&nbsp;=&nbsp;</span><span style="color:#0000ff;">true</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cv.notify_all();<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;worker_thread()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;unique_lock&lt;mutex&gt;&nbsp;lck(mtx);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cv.wait(lck,&nbsp;[]&nbsp;{</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;ready;&nbsp;});<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Worker&nbsp;thread&nbsp;is&nbsp;processing&nbsp;data\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;da&nbsp;+=&nbsp;</span><span style="color:#800000;">&quot;&nbsp;after&nbsp;processing&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;processed&nbsp;=&nbsp;</span><span style="color:#0000ff;">true</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Worker&nbsp;thread&nbsp;signals&quot;</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#800000;">&quot;&nbsp;data&nbsp;processing&nbsp;completed\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;lck.unlock();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cv.notify_one();<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;shipment_available()&nbsp;{&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;cargo&nbsp;!=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;consume(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;n)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;n;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unique_lock&lt;mutex&gt;&nbsp;lck(mtx);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv.wait(lck,&nbsp;shipment_available);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;cargo&nbsp;=&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;cargo&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cargo&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;waits()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;unique_lock&lt;mutex&gt;&nbsp;lck(mtx);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Waitting&nbsp;...\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cv.wait(lck,&nbsp;[]&nbsp;{</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;cargo&nbsp;==&nbsp;</span><span style="color:#ff0000;">1</span><span style="color:#000000;">;&nbsp;});<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;...&nbsp;finished&nbsp;wairing.&nbsp;cargo&nbsp;==&nbsp;1\n&quot;</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;signals()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;this_thread::sleep_for(chrono::seconds(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lock_guard&lt;mutex&gt;&nbsp;lgk(cv_m);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Notifying&nbsp;...&nbsp;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cv.notify_all();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;this_thread::sleep_for(chrono::seconds(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lock_guard&lt;mutex&gt;&nbsp;lgk(cv_m);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Notifying&nbsp;...&nbsp;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cv.notify_all();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;this_thread::sleep_for(std::chrono::seconds(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lock_guard&lt;mutex&gt;&nbsp;lgk(cv_m);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cargo&nbsp;=&nbsp;</span><span style="color:#ff0000;">1</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Notifying&nbsp;again&nbsp;...&nbsp;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cv.notify_all();<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;read_value()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cin&nbsp;&gt;&gt;&nbsp;ve;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cv.notify_one();<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;waits2(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;idx)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;unique_lock&lt;mutex&gt;&nbsp;lck(cv_m);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;now&nbsp;=&nbsp;chrono::system_clock::now();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(cv.wait_until(lck,&nbsp;now&nbsp;+&nbsp;idx&nbsp;*&nbsp;chrono::milliseconds(</span><span style="color:#ff0000;">100</span><span style="color:#000000;">),<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[]()&nbsp;{</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;cargo&nbsp;==&nbsp;</span><span style="color:#ff0000;">1</span><span style="color:#000000;">;&nbsp;}))<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Thread&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;idx&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;&nbsp;finished&nbsp;waiting.&nbsp;cargo&nbsp;=&nbsp;&quot;</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;cargo&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">else</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Thread&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;idx&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;&nbsp;time&nbsp;out.&nbsp;cargo&nbsp;=&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;cargo<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;signals2()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;this_thread::sleep_for(chrono::milliseconds(</span><span style="color:#ff0000;">120</span><span style="color:#000000;">));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Notifying&nbsp;...&nbsp;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cv.notify_all();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;this_thread::sleep_for(std::chrono::milliseconds(</span><span style="color:#ff0000;">100</span><span style="color:#000000;">));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cargo&nbsp;=&nbsp;</span><span style="color:#ff0000;">1</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Notifying&nbsp;again...\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cv.notify_all();<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;å°è¯•ç‰›åˆ€<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;threads[</span><span style="color:#ff0000;">10</span><span style="color:#000000;">];<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threads[i]&nbsp;=&nbsp;thread(print_id,&nbsp;i&nbsp;+&nbsp;</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;10&nbsp;threads&nbsp;ready&nbsp;to&nbsp;race...\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;go();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&amp;&nbsp;th&nbsp;:&nbsp;threads)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;th.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;worker(worker_thread);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;da&nbsp;=&nbsp;</span><span style="color:#800000;">&quot;Example&nbsp;data&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;send&nbsp;data&nbsp;to&nbsp;the&nbsp;worker&nbsp;thread<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lock_guard&lt;mutex&gt;&nbsp;lgk(mtx);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ready&nbsp;=&nbsp;</span><span style="color:#0000ff;">true</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;main()&nbsp;signals&nbsp;data&nbsp;ready&nbsp;for&nbsp;processing\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cv.notify_one();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;wait&nbsp;for&nbsp;the&nbsp;worker<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unique_lock&lt;mutex&gt;&nbsp;lck(mtx);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv.wait(lck,&nbsp;[]&nbsp;{</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;processed;&nbsp;});<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Back&nbsp;in&nbsp;main(),&nbsp;data&nbsp;=&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;da&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;worker.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;condition_variable::wait&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;consumer_thread(consume,&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(shipment_available())<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this_thread::yield();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;yield()å¯ä»¥å°†æœ¬çº¿ç¨‹çš„CPUæ—¶é—´ç‰‡æ”¾å¼ƒï¼Œå¹¶å…è®¸å…¶ä»–çº¿ç¨‹è¿è¡Œ<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¿™é‡Œçš„å…¶å®ƒçº¿ç¨‹ä¹ŸåŒ…å«æœ¬çº¿ç¨‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unique_lock&lt;mutex&gt;&nbsp;lck(mtx);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cargo&nbsp;=&nbsp;i&nbsp;+&nbsp;</span><span style="color:#ff0000;">1</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv.notify_one();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;consumer_thread.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼šå°†ä¾æ¬¡æ‰“å°&nbsp;cargo=1~10<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;cargo&nbsp;=&nbsp;0<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;t1(waits),&nbsp;t2(waits),&nbsp;t3(waits),&nbsp;t4(signals);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;t1.join(),&nbsp;t2.join(),&nbsp;t3.join(),&nbsp;t4.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cargo&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;condition_variable::wait_for&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Please,&nbsp;enter&nbsp;an&nbsp;integer&quot;</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#800000;">&quot;&nbsp;(I'll&nbsp;be&nbsp;printing&nbsp;dots):&nbsp;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;thrd(read_value);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;mutex&nbsp;mutx;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;unique_lock&lt;mutex&gt;&nbsp;lckk(mutx);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(cv.wait_for(lckk,&nbsp;chrono::seconds(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">))&nbsp;==<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv_status::timeout)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;.\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;You&nbsp;entered:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;ve&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thrd.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;condition_variable::wait_until&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;t1_2(waits2,&nbsp;</span><span style="color:#ff0000;">1</span><span style="color:#000000;">),&nbsp;t2_2(waits2,&nbsp;</span><span style="color:#ff0000;">2</span><span style="color:#000000;">),<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t3_2(waits2,&nbsp;</span><span style="color:#ff0000;">3</span><span style="color:#000000;">),&nbsp;t4_2(signals2);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;t1_2.join(),&nbsp;t2_2.join(),&nbsp;t3_2.join(),&nbsp;t4_2.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cargo&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;ç”±äºwaits2å‡½æ•°ä¸­ç­‰å¾…ä¸º100msï¼Œæœ€ç»ˆç»“æœæœ‰ç³»ç»Ÿè°ƒåº¦ç®—æ³•å†³å®š<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br><a name="bc2"><font color=green size = 5>class condition_variable_any</font></a>
<br>
<br><font color=blue size = 5>std::condition_variable_any</font>
<br> â— std::condition_variable_anyæ˜¯std::condition_variableçš„æ³›åŒ–
<br>1.ä¸æ¡ä»¶å˜é‡ä¸€æ ·ï¼Œé™¤äº†å®ƒçš„ç­‰å¾…å‡½æ•°å¯ä»¥å°†ä»»ä½•å¯é”ç±»å‹ä½œä¸ºå‚æ•°(æ¡ä»¶å˜é‡å¯¹è±¡åªèƒ½ä½¿ç”¨unique_lock&lt;mutex&gt;)ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä»¬æ˜¯ç›¸åŒçš„ï¼›
<br>2.std::condition_variable åªèƒ½ç”¨äºstd::unique_lock&lt;mutex&gt;ï¼Œcondition_variable_anyå¯ä»¥æ“ä½œä»»ä½•æ»¡è¶³åŸºæœ¬è¦æ±‚çš„é”ï¼Œå‚è§std::condition_å˜é‡ï¼Œç”¨äºæè¿°æ¡ä»¶å˜é‡çš„è¯­ä¹‰ï¼›ç±»std::condition_variable_anyæ˜¯ä¸€ä¸ªæ ‡å‡†å¸ƒå±€ç±»ï¼Œå®ƒä¸å¯æ‹·è´æ„é€ çš„ï¼Œç§»åŠ¨å¯æ„é€ çš„ï¼Œä¸å¯æ‹·è´å¤åˆ¶å’Œç§»åŠ¨å¤åˆ¶ï¼›
<br>3.å¦‚æœé”æ˜¯std::unique_lockï¼Œstd::condition_variableå¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½ã€‚
<br>æ³¨ï¼šstd::condition_variable_anyä¸è‡ªå®šä¹‰çš„å¯é”ç±»å‹æ˜¯ç”¨æ¥æä¾›æ–¹ä¾¿çš„å¯ä¸­æ–­ç­‰å¾…ï¼šè‡ªå®šä¹‰é”æ“ä½œä¼šåƒé¢„æœŸçš„é‚£æ ·é”å®šç›¸å…³çš„äº’æ–¥å¯¹è±¡ï¼Œå¹¶ä¸”åœ¨æ¥æ”¶åˆ°ä¸­æ–­ä¿¡å·æ—¶ä¹Ÿæ‰§è¡Œå¿…è¦çš„è®¾ç½®æ¥é€šçŸ¥è¿™ä¸ªæ¡ä»¶å˜é‡ã€‚
<br>
<br><font color=purple size = 4>(constructor)æ„é€ å‡½æ•°</font>
<br>å®šä¹‰ï¼šdefault (1) condition_variable_any();
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy [deleted] (2) condition_variable_any (const condition_variable_any&amp;) = delete;
<br> â— æ„é€ std::condition_variable_anyç±»å‹çš„å¯¹è±¡. ä¸èƒ½é€šè¿‡æ‹·è´å’Œç§»åŠ¨æ„é€ (è¿™ä¸ªç±»å‹çš„æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼æ“ä½œç¬¦éƒ½è¢«åˆ é™¤)
<br>æ³¨ï¼šå¦‚æœæ„é€ å¤±è´¥ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªç³»ç»Ÿå¼‚å¸¸ï¼š
<table border="2">
<tr>
<th>å¼‚å¸¸ç±»å‹</th>
<th>é”™è¯¯æ¡ä»¶</th>
<th>æè¿°</th>
</tr>
<tr>
<td>ç³»ç»Ÿé”™è¯¯</td>
<td>ERRC::resource_unavailable_try_again</td>
<td>èµ„æºé™åˆ¶(å†…å­˜åˆ†é…é™¤å¤–)å¯é˜²æ­¢åˆå§‹åŒ–</td>
</tr>
<tr>
<td>ç³»ç»Ÿé”™è¯¯</td>
<td>ERRC::operation_not_perimtted</td>
<td>çº¿ç¨‹æ²¡æœ‰æ‰§è¡Œæ“ä½œçš„è¯ä¹¦</td>
</tr>
</table>
æ ¹æ®åº“çš„å®ç°ï¼Œä¹Ÿå¯èƒ½åœ¨å…¶å®ƒæƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚bad_allocæ— æ³•åˆ†é…å†…å­˜
<br>operator= [deleted] ä¸å…è®¸å¤åˆ¶
<br>
<br><font color=purple size = 4>(destructor)ææ„å‡½æ•°</font>
<br> â— ææ„condition_variable_anyå¯¹è±¡ã€‚åœ¨æ­¤æ¡ä»¶ä¸‹è¢«é˜»å¡çš„ä»»ä½•çº¿ç¨‹åœ¨è°ƒç”¨æ­¤ææ„å‡½æ•°ä¹‹å‰éƒ½å°†è¢«é€šçŸ¥ã€‚åœ¨è¿™ä¸ªææ„å‡½æ•°è¢«è°ƒç”¨ä¹‹åï¼Œæ²¡æœ‰çº¿ç¨‹å°†å¼€å§‹ç­‰å¾…
<br>æ³¨ï¼š
<br>1.å¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½è¢«é€šçŸ¥ï¼Œè°ƒç”¨ææ„å‡½æ•°æ˜¯å®‰å…¨çš„ã€‚å®ƒä»¬ä¸éœ€è¦é€€å‡ºå„è‡ªçš„ç­‰å¾…å‡½æ•°ï¼šä¸€äº›çº¿ç¨‹å¯èƒ½è¿˜åœ¨ç­‰å¾…é‡æ–°è·å¾—ç›¸å…³çš„é”ï¼Œæˆ–è€…ç­‰å¾…è°ƒåº¦åœ¨é‡æ–°è·å¾—å®ƒä¹‹åè¿è¡Œï¼›
<br>2.ç¨‹åºå‘˜å¿…é¡»ç¡®ä¿åœ¨å¯åŠ¨ææ„å‡½æ•°æ—¶ï¼Œæ²¡æœ‰çº¿ç¨‹è¯•å›¾ç­‰å¾…ï¼Œç‰¹åˆ«æ˜¯å½“ç­‰å¾…çº¿ç¨‹è°ƒç”¨å¾ªç¯ä¸­çš„ç­‰å¾…å‡½æ•°æˆ–ä½¿ç”¨æ‰§è¡Œè°“è¯çš„ç­‰å¾…å‡½æ•°çš„é‡è½½æ—¶ã€‚
<br>
<br><font color=blue size = 5>Wait functions</font>
<br>
<br><font color=purple size = 4>std::condition_variable_any::wait</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;">unconditional&nbsp;(<span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Lock&gt;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;wait&nbsp;(Lock&nbsp;&amp;lck);<BR>
predicate&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Lock,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Predicate&gt;<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;wait&nbsp;(Lock&nbsp;&amp;lck,&nbsp;Predicate&nbsp;pred);</span></div></td></tr></table></div>
1.å½“å‰çº¿ç¨‹ï¼ˆå½“å‰æ­£åœ¨é”å®šlckï¼‰çš„æ‰§è¡Œå°†è¢«é˜»æ­¢ï¼Œç›´åˆ°é€šçŸ¥ä¸ºæ­¢ï¼›
<br>2.é˜»æ­¢çº¿ç¨‹çš„æ—¶åˆ»ï¼Œè¯¥å‡½æ•°è‡ªåŠ¨è°ƒç”¨lck.unlock()ï¼Œå…è®¸å…¶ä»–é”å®šçº¿ç¨‹ç»§ç»­ï¼›
<br>3.ä¸€æ—¦é€šçŸ¥ï¼ˆæ˜¾å¼åœ°ï¼Œé€šè¿‡æŸä¸ªå…¶ä»–çº¿ç¨‹ï¼‰ï¼Œå‡½æ•°è§£é™¤é˜»å¡å’Œè°ƒç”¨lck.lock()ï¼Œä½¿lckå¤„äºä¸è°ƒç”¨å‡½æ•°æ—¶ç›¸åŒçš„çŠ¶æ€ã€‚ç„¶åå‡½æ•°è¿”å›ï¼ˆæ³¨æ„ï¼Œè¿™ä¸ªæœ€åçš„äº’æ–¥é”å®šå¯èƒ½åœ¨è¿”å›ä¹‹å‰å†æ¬¡é˜»æ­¢çº¿ç¨‹ï¼‰ï¼›
<br>4.é€šå¸¸ï¼Œè¯¥å‡½æ•°è¢«é€šçŸ¥é€šè¿‡å¦ä¸€ä¸ªçº¿ç¨‹çš„å‘¼å«å”¤é†’æˆå‘˜notify_one æˆ– notify_allã€‚ä½†æ˜¯æŸäº›å®ç°å¯èƒ½ä¼šäº§ç”Ÿè™šå‡çš„å”¤é†’å‘¼å«ï¼Œè€Œä¸ä¼šè°ƒç”¨è¿™äº›åŠŸèƒ½ã€‚å› æ­¤ï¼Œè¯¥åŠŸèƒ½çš„ç”¨æˆ·åº”ç¡®ä¿å…¶æ¢å¤æ¡ä»¶å¾—åˆ°æ»¡è¶³ï¼›
<br>5.å®šä¹‰(2): å¦‚æœæŒ‡å®špredï¼Œå¦‚æœpredè¿”å›falseï¼Œåˆ™å‡½æ•°åªä¼šé˜»å¡ï¼Œå¹¶ä¸”åªæœ‰å½“å®ƒå˜ä¸ºtrueæ—¶ï¼Œé€šçŸ¥æ‰èƒ½è§£é™¤çº¿ç¨‹(è¿™å¯¹äºæ£€æŸ¥ä¼ªå”¤é†’è°ƒç”¨ç‰¹åˆ«æœ‰ç”¨)ï¼›
<br> * ç±»ä¼¼è¿™æ ·çš„å®ç°ï¼š
<br>while (!pred())
<br>{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wait(lock);
<br>}
<br>
<br><font color=purple size = 4>std::condition_variable_any::wait_for</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;">unconditional&nbsp;(<span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Lock,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Rep,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Period&gt;<BR>
cv_status&nbsp;wait_for&nbsp;(Lock&nbsp;&amp;lck,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;chrono::duration&lt;Rep,&nbsp;Period&gt;&nbsp;&amp;rel_time);<BR>
predicate&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Lock,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Rep,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Period,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Predicate&gt;<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;wait_for&nbsp;(Lock&nbsp;&amp;lck,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;chrono::duration&lt;Rep,&nbsp;Period&gt;&nbsp;&amp;rel_time,&nbsp;Predicate&nbsp;pred);</span></div></td></tr></table></div>
1.å½“å‰çº¿ç¨‹ï¼ˆå½“å‰é”å®šlckï¼‰çš„æ‰§è¡Œåœ¨rel_timeæœŸé—´è¢«é˜»å¡ï¼Œæˆ–è€…ç›´åˆ°é€šçŸ¥ï¼ˆå¦‚æœåè€…é¦–å…ˆå‘ç”Ÿï¼‰ï¼›
<br>2.åœ¨é˜»æ­¢çº¿ç¨‹çš„æ—¶åˆ»ï¼Œè¯¥å‡½æ•°è‡ªåŠ¨è°ƒç”¨lck.unlock()ï¼Œå…è®¸å…¶ä»–é”å®šçº¿ç¨‹ç»§ç»­ï¼›
<br>3.ä¸€æ—¦é€šçŸ¥æˆ–ä¸€æ—¦rel_timeå·²ç»è¿‡å»ï¼Œè¯¥å‡½æ•°è§£é™¤é˜»å¡å’Œè°ƒç”¨lck.lock()ï¼Œä½¿lckå¤„äºä¸è°ƒç”¨å‡½æ•°æ—¶ç›¸åŒçš„çŠ¶æ€ã€‚ç„¶åå‡½æ•°è¿”å›ï¼ˆæ³¨æ„ï¼Œè¿™ä¸ªæœ€åçš„äº’æ–¥é”å®šå¯èƒ½åœ¨è¿”å›ä¹‹å‰å†æ¬¡é˜»æ­¢çº¿ç¨‹ï¼‰ï¼›
<br>4.é€šå¸¸ï¼Œè¯¥å‡½æ•°è¢«é€šçŸ¥é€šè¿‡å¦ä¸€ä¸ªçº¿ç¨‹çš„å‘¼å«å”¤é†’æˆå‘˜notify_one æˆ– notify_oneã€‚ä½†æ˜¯æŸäº›å®ç°å¯èƒ½ä¼šäº§ç”Ÿè™šå‡çš„å”¤é†’å‘¼å«ï¼Œè€Œä¸ä¼šè°ƒç”¨è¿™äº›åŠŸèƒ½ã€‚å› æ­¤ï¼Œè¯¥åŠŸèƒ½çš„ç”¨æˆ·åº”ç¡®ä¿å…¶æ¢å¤æ¡ä»¶å¾—åˆ°æ»¡è¶³ï¼›
<br>5.ç‰ˆæœ¬(2):å¦‚æœæŒ‡å®špredï¼Œå¦‚æœpredè¿”å›falseï¼Œåˆ™å‡½æ•°åªä¼šé˜»å¡ï¼Œå¹¶ä¸”åªæœ‰å½“å®ƒå˜ä¸ºtrueæ—¶ï¼Œé€šçŸ¥æ‰èƒ½è§£é™¤çº¿ç¨‹(è¿™å¯¹äºæ£€æŸ¥ä¼ªå”¤é†’è°ƒç”¨ç‰¹åˆ«æœ‰ç”¨)ã€‚å¯ä»¥ç†è§£ä¸ºï¼š
<br> return wait_until (lck, chrono::steady_clock::now() + rel_time, std::move(pred));
<br>
<br><font color=purple size = 4>std::condition_variable_any::wait_until</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;">unconditional&nbsp;(<span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Lock,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Clock,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Duration&gt;<BR>
cv_status&nbsp;wait_until&nbsp;(Lock&nbsp;&amp;lck,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;chrono::time_point&lt;Clock,&nbsp;Duration&gt;&nbsp;&amp;abs_time);<BR>
predicate&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Lock,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Clock,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Duration,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Predicate&gt;<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;wait_until&nbsp;(Lock&nbsp;&amp;lck,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;chrono::time_point&lt;Clock,&nbsp;Duration&gt;&nbsp;&amp;abs_time,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Predicate&nbsp;pred);</span></div></td></tr></table></div>
1.å½“å‰çº¿ç¨‹çš„æ‰§è¡Œï¼ˆå½“å‰é”å®šlckï¼‰å°†è¢«é˜»å¡ï¼Œç›´åˆ°é€šçŸ¥æˆ–ç›´åˆ°abs_timeï¼Œä»¥å…ˆå‘ç”Ÿè€…ä¸ºå‡†ï¼›
<br>2.åœ¨é˜»æ­¢çº¿ç¨‹çš„æ—¶åˆ»ï¼Œè¯¥å‡½æ•°è‡ªåŠ¨è°ƒç”¨lck.unlock()ï¼Œå…è®¸å…¶ä»–é”å®šçº¿ç¨‹ç»§ç»­ï¼›
<br>3.ä¸€æ—¦é€šçŸ¥æˆ–ä¸€æ—¦ä¸ºabs_timeï¼Œå‡½æ•°è§£é™¤é˜»å¡å’Œè°ƒç”¨lck.lock()ï¼Œä½¿lckå¤„äºä¸è°ƒç”¨å‡½æ•°æ—¶ç›¸åŒçš„çŠ¶æ€ã€‚ç„¶åå‡½æ•°è¿”å›ï¼ˆæ³¨æ„ï¼Œè¿™ä¸ªæœ€åçš„äº’æ–¥é”å®šå¯èƒ½åœ¨è¿”å›ä¹‹å‰å†æ¬¡é˜»æ­¢çº¿ç¨‹ï¼‰ï¼›
<br>4.é€šå¸¸ï¼Œè¯¥å‡½æ•°è¢«é€šçŸ¥é€šè¿‡å¦ä¸€ä¸ªçº¿ç¨‹çš„å‘¼å«å”¤é†’æˆå‘˜notify_one æˆ–ä¼šå‘˜ notify_oneã€‚ä½†æ˜¯æŸäº›å®ç°å¯èƒ½ä¼šäº§ç”Ÿè™šå‡çš„å”¤é†’å‘¼å«ï¼Œè€Œä¸ä¼šè°ƒç”¨è¿™äº›åŠŸèƒ½ã€‚å› æ­¤ï¼Œè¯¥åŠŸèƒ½çš„ç”¨æˆ·åº”ç¡®ä¿å…¶æ¢å¤æ¡ä»¶å¾—åˆ°æ»¡è¶³ï¼›
<br>5.ç‰ˆæœ¬2ï¼šå¦‚æœæŒ‡å®špredï¼Œå¦‚æœpredè¿”å›falseï¼Œåˆ™å‡½æ•°åªä¼šé˜»å¡ï¼Œå¹¶ä¸”åªæœ‰å½“å®ƒå˜ä¸ºtrueæ—¶ï¼Œé€šçŸ¥æ‰èƒ½è§£é™¤çº¿ç¨‹(è¿™å¯¹äºæ£€æŸ¥ä¼ªå”¤é†’è°ƒç”¨ç‰¹åˆ«æœ‰ç”¨)ã€‚è¡¨ç°ä¸ºï¼š
<br>while (!pred())
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( wait_until(lck,abs_time) == cv_status::timeout)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return pred();
<br>return true;
<br>
<br><font color=blue size = 5>Notify functions</font>
<br>
<br><font color=purple size = 4>std::condition_variable_any::notify_one</font>
<br>åŒä¸Šé¢std::condition_variableçš„å‡½æ•°
<br>unblockå½“å‰ç­‰å¾…è¯¥æ¡ä»¶çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœæ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ï¼Œåˆ™è¯¥å‡½æ•°ä»€ä¹ˆéƒ½ä¸åšï¼Œå¦‚æœå¤šäºä¸€ä¸ªï¼Œåˆ™ä¸æŒ‡å®šå“ªä¸ªçº¿ç¨‹è¢«é€‰ä¸­ã€‚
<br>
<br><font color=purple size = 4>std::condition_variable_any::notify_all</font>
<br>åŒä¸Šé¢std::condition_variableçš„å‡½æ•°ã€‚æ‰“å¼€å½“å‰ç­‰å¾…è¯¥æ¡ä»¶çš„æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœæ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ï¼Œåˆ™è¯¥å‡½æ•°ä»€ä¹ˆéƒ½ä¸åšã€‚
<br>
<br><a name="bc3"><font color=green size = 5>Enum classes</font></a>
<br>
<br><font color=purple size = 4>std::cv_status</font>
<br>å®šä¹‰ï¼šenum class cv_status;
<br> â— æ¡ä»¶å˜é‡çŠ¶æ€ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¡¨ç¤ºæ˜¯å¦ç”±äºè¶…æ—¶è€Œè¿”å›çš„å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™ç§ç±»å‹çš„å€¼ç”±condition_variableå’Œcondition_variable_anyçš„æˆå‘˜wait_forå’Œwait_untilè¿”å›
<br> â— å®šä¹‰ç±»ä¼¼ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enum class cv_status { no_timeout, timeout };
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv_status::no_timeout :  è¯¥å‡½æ•°è¿”å›æ²¡æœ‰è¶…æ—¶
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv_status::timeout : è¯¥å‡½æ•°ç”±äºè¾¾åˆ°å…¶æ—¶é—´é™åˆ¶ï¼ˆtimeoutï¼‰è€Œè¿”å›
<br>
<br><a name="bc4"><font color=green size = 5>Functions</font></a>
<br>
<br><font color=purple size = 4>std::notify_all_at_thread_exit</font>
<br>å®šä¹‰ï¼švoid notify_all_at_thread_exit (condition_variable&amp; cond,unique_lock<mutex> lck);
<br> â— å½“è°ƒç”¨çº¿ç¨‹é€€å‡ºæ—¶ï¼Œç­‰å¾…åœ¨condä¸Šçš„æ‰€æœ‰çº¿ç¨‹éƒ½è¢«é€šçŸ¥æ¢å¤æ‰§è¡Œ
<br> â— è¯¥å‡½æ•°è¿˜è·å¾—ç”±lckç®¡ç†çš„mutexå¯¹è±¡ä¸Šçš„é”çš„æ‰€æœ‰æƒï¼Œè¯¥å¯¹è±¡åœ¨å†…éƒ¨ç”±å‡½æ•°å­˜å‚¨ï¼Œå¹¶åœ¨çº¿ç¨‹é€€å‡ºæ—¶è§£é”(ä»…åœ¨é€šçŸ¥æ‰€æœ‰çº¿ç¨‹ä¹‹å‰)ï¼Œè¡Œä¸ºå¦‚ä¸‹ï¼Œä¸€æ—¦æ‰€æœ‰å…·æœ‰çº¿ç¨‹å­˜å‚¨æ—¶é—´çš„å¯¹è±¡éƒ½è¢«é”€æ¯ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lck.unlock();
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond.notify_all();
<br>æ³¨ï¼š
<br>1.å¦‚æœlock. mutex()æ²¡æœ‰è¢«å½“å‰çº¿ç¨‹é”å®šï¼Œåˆ™è°ƒç”¨æ­¤å‡½æ•°æ˜¯æœªå®šä¹‰çš„è¡Œä¸ºï¼›
<br>2.å¦‚æœlock.mutex()ä¸å½“å‰åœ¨åŒä¸€æ¡ä»¶å˜é‡ä¸­ç­‰å¾…çš„æ‰€æœ‰å…¶ä»–çº¿ç¨‹ä½¿ç”¨çš„äº’æ–¥å¯¹è±¡ä¸ç›¸åŒï¼Œåˆ™è°ƒç”¨æ­¤å‡½æ•°æ‰€æä¾›çš„é”ä¸€ç›´ä¿æŒåˆ°çº¿ç¨‹é€€å‡ºã€‚ä¸€æ—¦è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå°±ä¸ä¼šæœ‰æ›´å¤šçš„çº¿ç¨‹å¯èƒ½è·å¾—ç›¸åŒçš„é”ä»¥ç­‰å¾…condã€‚å¦‚æœæŸä¸ªçº¿ç¨‹åœ¨è¿™ä¸ªæ¡ä»¶å˜é‡ä¸Šç­‰å¾…ï¼Œå®ƒä¸åº”è¯¥å°è¯•é‡Šæ”¾å¹¶é‡æ–°è·å–é”ï¼Œå½“å®ƒè¢«é”™è¯¯åœ°å”¤é†’æ—¶ï¼›
<br>3.åœ¨å…¸å‹çš„ç”¨ä¾‹ä¸­ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ç”±ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹è°ƒç”¨çš„æœ€åä¸€ä¸ªå‡½æ•°ã€‚
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;mutex&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;condition_variable&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
mutex&nbsp;mtx;<BR>
condition_variable&nbsp;cv;<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;ready&nbsp;=&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;">;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;print_id(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;id)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;unique_lock&lt;mutex&gt;&nbsp;lck(mtx);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(!ready)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cv.wait(lck);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;thread&nbsp;#&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;id&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;go()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;unique_lock&lt;mutex&gt;&nbsp;lck(mtx);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;notify_all_at_thread_exit(cv,&nbsp;move(lck));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;ready&nbsp;=&nbsp;</span><span style="color:#0000ff;">true</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;threads[</span><span style="color:#ff0000;">10</span><span style="color:#000000;">];<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threads[i]&nbsp;=&nbsp;thread(print_id,&nbsp;i&nbsp;+&nbsp;</span><span style="color:#ff0000;">1</span><span style="color:#000000;">);<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;10&nbsp;threads&nbsp;ready&nbsp;to&nbsp;race&nbsp;...\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread(go).detach();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&amp;&nbsp;th&nbsp;:&nbsp;threads)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;th.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
ç¨‹åºè¾“å‡ºï¼šæç¤ºè¯­... thread#10 ~ 1
<br><br><br>
<font color = gray size = 3>å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼</font></p></div>
        <div class="post_footer">
          
          <div class="meta">
            <div class="info">
              <span class="field tags">
                <i class="remixicon-stack-line"></i>
                
                <a href="https://oubc.github.io/tags/c/c&#43;&#43;/">C/C&#43;&#43;</a>
                
              </span>
            </div>
          </div>
          
        </div>
      </div>
      
      
    </div>
  </div>
  <a id="back_to_top" href="#" class="back_to_top"><span>â–³</span></a>
</div>
<footer class="footer">
  <div class="powered_by">
    <a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4l9lmg4aog3074074gnf.gif?tags=%5B%5D">I </a>
	<a href="">love</a>
    <a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4l9lmfm2eg306o06o74u.gif?tags=%5B%5D"> you </a>
    <a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4njrx4tpcj30fn0bq3zg.jpg?tags=%5B%5D">three </a>
	<a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4njrx64ctg307s07swfy.gif?tags=%5B%5D">thousand</a>
    <a href="https://www.kugou.com/song/#hash=96426C78381DE98DC31A5846FC274CBF&album_id=646623"> times.</a>
  </div>

  <div class="footer_slogan">
    <span>å®¶åº­ã€æ¢¦æƒ³ã€å†…å¿ƒçš„å¹³é™</span>
  </div>
</footer>



<script src="https://oubc.github.io/js/jquery-3.3.1.min.js"></script>
<script src="https://oubc.github.io/js/zozo.js"></script>
<script src="https://oubc.github.io/js/highlight.pack.js"></script>
<link  href="https://oubc.github.io/css/fancybox.min.css" rel="stylesheet">
<script src="https://oubc.github.io/js/fancybox.min.js"></script>

<script>hljs.initHighlightingOnLoad()</script>


  <script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>






</body>
</html>
