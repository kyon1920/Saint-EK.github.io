<!DOCTYPE html>
<html lang="zh-cn" >
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  
  <meta name="author"
        content="Bruce Cheung"/>

  
  <meta name="description" content=""/>
  

  
  
  <meta name="keywords" content="blog, simple, dream"/>
  

  
  <link rel="canonical" href="https://oubc.github.io/post/modernc&#43;&#43;5/"/>

  

  <title>Modern C&#43;&#43; å¤šçº¿ç¨‹ atomic &middot; Love, or death</title>

  <link rel="shortcut icon" href="https://oubc.github.io/images/favicon.ico"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/animate.min.css"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/remixicon.css"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/zozo.css"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/highlight.css"/>

  
  
</head>

<body>
<div class="main animated">
  <div class="nav_container animated fadeInDown">
  <div class="site_nav" id="site_nav">
    <ul>
      
      <li>
        <a href="/">é¦–é¡µ</a>
      </li>
      
      <li>
        <a href="/post/">å½’æ¡£</a>
      </li>
      
      <li>
        <a href="/tags/">æ ‡ç­¾</a>
      </li>
      
      <li>
        <a href="/about/">å…³äº</a>
      </li>
      
    </ul>
  </div>
  <div class="menu_icon">
    <a id="menu_icon"><i class="remixicon-links-line"></i></a>
  </div>
</div>

  <div class="header animated fadeInDown">
  <div class="site_title_container">
    <div class="site_title">
      <h1>
        <a href="https://oubc.github.io/">
          <span>Love, or death</span>
          <img src="https://oubc.github.io/images/logo.svg"/>
        </a>
      </h1>
    </div>
    <div class="description">
      <p class="sub_title">For you, a thousand times over.</p>
      <div class="my_socials">
        
        
        <a href="https://github.com/oubc" title="github" target="_blank"><i class="remixicon-github-fill"></i></a>
        
        
        
        <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=uYGOjo6OiIuLivnIyJfa1tQ" title="mail" target="_blank"><i class="remixicon-mail-fill"></i></a>
        
        
        
        <a href="http://sighttp.qq.com/msgrd?v=1&amp;uin=877771223" title="qq" target="_blank"><i class="remixicon-qq-fill"></i></a>
        
        
        
        <a href="https://github.com/oubc/oubc.github.io/blob/master/images/wx.jpg?raw=true" title="wechat" target="_blank"><i class="remixicon-wechat-fill"></i></a>
        
        
        
        <a href="https://weibo.com/u/6993631995?topnav=1&amp;wvr=6&amp;topsug=1" title="weibo" target="_blank"><i class="remixicon-weibo-fill"></i></a>
        
        
        <a href="https://oubc.github.io/index.xml" type="application/rss+xml" title="rss" target="_blank"><i class="remixicon-rss-fill"></i></a>
      </div>
    </div>
  </div>
</div>

  <div class="content">
    <div class="post_page">
      <div class="post animated fadeInDown">
        <div class="post_title post_detail_title">
          <h2><a href='/post/modernc&#43;&#43;5/'>Modern C&#43;&#43; å¤šçº¿ç¨‹ atomic</a></h2>
          <span class="date">2020.02.16</span>
        </div>
        <div class="post_content markdown"><p><br>
<br><font color=green size = 5>C++æ–°æ ‡å‡†ä¹‹å¤šçº¿ç¨‹ atomicåŸå­æ“ä½œ</font>
<br>
<br><font color = gray size = 3>ç›®å½•</font><font color = gray size = 2> (ç‚¹å‡»è·³è½¬)</font>
<br><a href="#bc0"><font color=yellow size = 4>&lt;atomic&gt;å¤´æ–‡ä»¶ç»“æ„</font></a>
<br><a href="#bc1"><font color=blue size = 4>std::atomic</font></a>
<br><a href="#bc2"><font color=pink size = 4>std::atomic_flag</font></a>
<br><a href="#bc3"><font color=purple size = 4>std::memory_order</font></a>
<br><a href="#bc4"><font color=cyan size = 4>Functions</font></a>
<br><a href="#bc5"><font color=blue size = 4>Functions for atomic objects (C-style)</font></a>
<br><a href="#bc6"><font color=yellow size = 4>Macro functions</font></a>
<br>
<br>
<br> â— åŸå­æ“ä½œæ˜¯ä¸€ç§lock freeçš„æ“ä½œï¼Œä¸éœ€è¦åŒæ­¥é”ï¼Œå…·æœ‰å¾ˆé«˜çš„æ€§èƒ½
<br> â— åŸå­æ“ä½œæ˜¯ä¸å¯æ‰“æ–­çš„æœ€ä½ç²’åº¦æ“ä½œï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„
<br> â— C++æ–°æ ‡å‡†ä¸­åŸå­ç±»æä¾›çš„æˆå‘˜å‡½æ•°éƒ½æ˜¯åŸå­çš„ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„
<br> â— åŸå­æ“ä½œä¸­æœ€ç®€å•çš„è«è¿‡äºatomic_flagï¼Œåªæœ‰ä¸¤ç§æ“ä½œï¼Œtest and setã€clear
<br> â— C++æ–°æ ‡å‡†ä¸­æ‰€æœ‰çš„åŸå­ç±»éƒ½æ˜¯ä¸å…è®¸æ‹·è´ã€ä¸å…è®¸Moveçš„
<br>
<br><a name="bc0"><font color=green size = 5>&lt;atomic&gt;å¤´æ–‡ä»¶</font></a>
<br> â— åŸå­ç±»å‹æ˜¯å°è£…äº†ä¸€ä¸ªå€¼çš„ç±»å‹ï¼Œå®ƒçš„è®¿é—®ä¿è¯ä¸ä¼šå¯¼è‡´æ•°æ®çš„ç«äº‰ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºåœ¨ä¸åŒçš„çº¿ç¨‹ä¹‹é—´åŒæ­¥å†…å­˜è®¿é—®
<br> â— &lt;atomic&gt;å£°æ˜ä¸¤ä¸ªC++ç±»ï¼ŒåŸå­å’Œatomic_flagï¼Œå®ƒå®ç°äº†è‡ªåŒ…å«ç±»ä¸­çš„åŸå­ç±»å‹çš„æ‰€æœ‰ç‰¹æ€§ï¼Œheaderè¿˜å£°æ˜äº†æ•´ä¸ªCæ ·å¼ç±»å‹å’Œå‡½æ•°å¹¶ä¸Cä¸­çš„åŸå­æ”¯æŒå…¼å®¹
<br> ğŸ›  &lt;atomic&gt;å¤´æ–‡ä»¶ç»“æ„
<table border="2">
<tr>
<th>Class</th>
<th>æè¿°</th>
</tr>
<tr>
<td>atomic</td>
<td>ç”¨äºboolã€æ•´æ•°å’ŒæŒ‡é’ˆç±»å‹çš„åŸå­ç±»æ¨¡æ¿å’Œç‰¹æ®ŠåŒ–(ç±»æ¨¡æ¿)</td>
</tr>
<tr>
<td>atomic_flag</td>
<td>æ— é”boolåŸå­ç±»å‹(ç±»)</td>
</tr>
</table>
<br>
<table border="2">
<tr>
<th>Types</th>
<th>æè¿°</th>
</tr>
<tr>
<td>memory_order</td>
<td>ä¸ºç»™å®šçš„åŸå­æ“ä½œå®šä¹‰å†…å­˜æ’åºçº¦æŸ(typedef)</td>
</tr>
</table>
<br>
<table border="2">
<tr>
<th>Functions</th>
<th>æè¿°</th>
</tr>
<tr>
<td>kill_dependency</td>
<td>ä»std::memory_order_consumeä¾èµ–æ ‘ä¸­åˆ é™¤æŒ‡å®šå¯¹è±¡(æ¨¡æ¿å‡½æ•°)</td>
</tr>
<tr>
<td>atomic_thread_fence</td>
<td>é€šç”¨å†…å­˜é¡ºåºä¾èµ–å…³ç³»çš„éš”ç¦»åŒæ­¥åŸè¯­(å‡½æ•°)</td>
</tr>
<tr>
<td>atomic_signal_fence</td>
<td>åœ¨åŒä¸€çº¿ç¨‹ä¸­æ‰§è¡Œçš„çº¿ç¨‹å’Œä¿¡å·å¤„ç†ç¨‹åºä¹‹é—´çš„éš”ç¦»(å‡½æ•°)</td>
</tr>
</table>
<br>
<table border="2">
<tr>
<th>Functions for atomic objects (C-style)</th>
<th>æè¿°</th>
</tr>
<tr>
<td>atomic_is_lock_free</td>
<td>æ£€æŸ¥åŸå­ç±»å‹çš„æ“ä½œæ˜¯å¦å…é”(å‡½æ•°æ¨¡æ¿)</td>
</tr>
<tr>
<td>atomic_store<br>atomic_store_explicit</td>
<td>ä½¿ç”¨éåŸå­å‚æ•°ä»¥åŸå­æ–¹å¼æ›¿æ¢åŸå­å¯¹è±¡çš„å€¼(å‡½æ•°æ¨¡æ¿)</td>
</tr>
<tr>
<td>atomic_load<br>atomic_load_explicit</td>
<td>åœ¨åŸå­å¯¹è±¡ä¸­åŸå­æ€§åœ°è·å–å­˜å‚¨çš„å€¼(å‡½æ•°æ¨¡æ¿)</td>
</tr>
<tr>
<td>atomic_exchange<br>atomic_exchange_explicit</td>
<td>åŸå­æ€§åœ°ç”¨éåŸå­å‚æ•°æ›¿æ¢åŸå­å¯¹è±¡çš„å€¼ï¼Œå¹¶è¿”å›åŸå­çš„æ—§å€¼(å‡½æ•°æ¨¡æ¿)</td>
</tr>
<tr>
<td>atomic_compare_exchange_weak<br>atomic_compare_exchange_weak_explicit<br>atomic_compare_exchange_strong<br>atomic_compare_exchange_strong_explicit</td>
<td>åŸå­åœ°æ¯”è¾ƒåŸå­å¯¹è±¡å’ŒéåŸå­å‚æ•°çš„å€¼ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™æ‰§è¡ŒåŸå­äº¤æ¢ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±load atomic</td>
</tr>
<tr>
<td>atomic_fetch_add<br>atomic_fetch_add_explicit</td>
<td>å‘åŸå­å¯¹è±¡æ·»åŠ éåŸå­å€¼ï¼Œå¹¶è·å–åŸå­çš„å‰å€¼(å‡½æ•°æ¨¡æ¿)</td>
</tr>
<tr>
<td>atomic_fetch_sub<br>atomic_fetch_sub_explicit</td>
<td>å‘åŸå­å¯¹è±¡å‡å»éåŸå­å€¼ï¼Œå¹¶è·å–åŸå­çš„å‰å€¼(å‡½æ•°æ¨¡æ¿)</td>
</tr>
<tr>
<td>atomic_fetch_and<br>atomic_fetch_and_explicit</td>
<td>ç”¨é€»è¾‘ç»“æœå’ŒéåŸå­å‚æ•°æ›¿æ¢åŸå­å¯¹è±¡ï¼Œå¹¶è·å¾—åŸå­çš„å‰å€¼(å‡½æ•°æ¨¡æ¿)</td>
</tr>
<tr>
<td>atomic_fetch_or<br>atomic_fetch_or_explicit</td>
<td>ç”¨é€»è¾‘æˆ–éåŸå­å‚æ•°æ›¿æ¢åŸå­å¯¹è±¡ï¼Œå¹¶è·å¾—åŸå­çš„å‰å€¼(å‡½æ•°æ¨¡æ¿)</td>
</tr>
<tr>
<td>atomic_fetch_xor<br>atomic_fetch_xor_explicit</td>
<td>ç”¨é€»è¾‘XORå’ŒéåŸå­å‚æ•°æ›¿æ¢åŸå­å¯¹è±¡ï¼Œå¹¶è·å¾—åŸå­çš„å‰å€¼(å‡½æ•°æ¨¡æ¿)</td>
</tr>
</table>
<br>
<table border="2">
<tr>
<th>Functions for atomic flags (C-style)</th>
<th>æè¿°</th>
</tr>
<tr>
<td>atomic_flag_test_and_set<br>atomic_flag_test_and_set_explicit</td>
<td>åŸå­åœ°å°†flagè®¾ç½®ä¸ºtrueå¹¶è¿”å›å…¶å…ˆå‰çš„å€¼(å‡½æ•°)</td>
</tr>
<tr>
<td>atomic_flag_clear<br>atomic_flag_clear_explicit</td>
<td>åŸå­åœ°å°†flagè®¾ç½®ä¸ºfalse</td>
</tr>
</table>
<br>
<table border="2">
<tr>
<th>Preprocessor macros</th>
<th>æè¿°</th>
</tr>
<tr>
<td>ATOMIC_VAR_INIT</td>
<td>é™æ€å­˜å‚¨æ—¶é—´çš„åŸå­å˜é‡çš„å¸¸é‡åˆå§‹åŒ–(å®)</td>
</tr>
<tr>
<td>ATOMIC_FLAG_INIT</td>
<td>åˆå§‹åŒ–std::atomic_flagä¸ºfalse</td>
</tr>
</table>
<br> â— Macro constants
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#008000;">//&nbsp;lock-free&nbsp;property<BR>
</span><span style="color:#0000ff;">#define</span><span style="color:#000000;">&nbsp;ATOMIC_BOOL_LOCK_FREE&nbsp;</span><span style="color:#008000;">/*unspecified*/</span><span style="color:#000000;"><BR>
</span><span style="color:#0000ff;">#define</span><span style="color:#000000;">&nbsp;ATOMIC_CHAR_LOCK_FREE&nbsp;</span><span style="color:#008000;">/*unspecified*/</span><span style="color:#000000;"><BR>
</span><span style="color:#0000ff;">#define</span><span style="color:#000000;">&nbsp;ATOMIC_CHAR16_T_LOCK_FREE&nbsp;</span><span style="color:#008000;">/*unspecified*/</span><span style="color:#000000;"><BR>
</span><span style="color:#0000ff;">#define</span><span style="color:#000000;">&nbsp;ATOMIC_CHAR32_T_LOCK_FREE&nbsp;</span><span style="color:#008000;">/*unspecified*/</span><span style="color:#000000;"><BR>
</span><span style="color:#0000ff;">#define</span><span style="color:#000000;">&nbsp;ATOMIC_WCHAR_T_LOCK_FREE&nbsp;</span><span style="color:#008000;">/*unspecified*/</span><span style="color:#000000;"><BR>
</span><span style="color:#0000ff;">#define</span><span style="color:#000000;">&nbsp;ATOMIC_SHORT_LOCK_FREE&nbsp;</span><span style="color:#008000;">/*unspecified*/</span><span style="color:#000000;"><BR>
</span><span style="color:#0000ff;">#define</span><span style="color:#000000;">&nbsp;ATOMIC_INT_LOCK_FREE&nbsp;</span><span style="color:#008000;">/*unspecified*/</span><span style="color:#000000;"><BR>
</span><span style="color:#0000ff;">#define</span><span style="color:#000000;">&nbsp;ATOMIC_LONG_LOCK_FREE&nbsp;</span><span style="color:#008000;">/*unspecified*/</span><span style="color:#000000;"><BR>
</span><span style="color:#0000ff;">#define</span><span style="color:#000000;">&nbsp;ATOMIC_LLONG_LOCK_FREE&nbsp;</span><span style="color:#008000;">/*unspecified*/</span><span style="color:#000000;"><BR>
</span><span style="color:#0000ff;">#define</span><span style="color:#000000;">&nbsp;ATOMIC_POINTER_LOCK_FREE&nbsp;</span><span style="color:#008000;">/*unspecified*/</span></div></td></tr></table></div>
<br>
<br><a name="bc1"><font color=green size = 5>std::atomic</font></a>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&lt;&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&nbsp;&gt;&nbsp;</span><span style="color:#0000ff;">struct</span><span style="color:#000000;">&nbsp;atomic;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;(since&nbsp;C++</span><span style="color:#ff0000;">11</span><span style="color:#000000;">)<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&lt;&gt;&nbsp;&nbsp;</span><span style="color:#0000ff;">struct</span><span style="color:#000000;">&nbsp;atomic&lt;Integral&gt;;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;(since&nbsp;C++</span><span style="color:#ff0000;">11</span><span style="color:#000000;">)<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&lt;&gt;&nbsp;&nbsp;</span><span style="color:#0000ff;">struct</span><span style="color:#000000;">&nbsp;atomic&lt;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&gt;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">3</span><span style="color:#000000;">)&nbsp;&nbsp;(since&nbsp;C++</span><span style="color:#ff0000;">11</span><span style="color:#000000;">)<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&lt;&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&nbsp;&gt;&nbsp;&nbsp;</span><span style="color:#0000ff;">struct</span><span style="color:#000000;">&nbsp;atomic&lt;T*&gt;;&nbsp;(</span><span style="color:#ff0000;">4</span><span style="color:#000000;">)&nbsp;&nbsp;(since&nbsp;C++</span><span style="color:#ff0000;">11</span><span style="color:#000000;">)æŒ‡é’ˆç‰¹åŒ–</span></div></td></tr></table></div>
 â— std::atomicæ¨¡æ¿çš„æ¯ä¸ªå®ä¾‹åŒ–å’Œä¸“é—¨åŒ–éƒ½å®šä¹‰äº†ä¸€ä¸ªåŸå­ç±»å‹
<br> â— å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨å¦ä¸€ä¸ªçº¿ç¨‹è¯»å–å®ƒæ—¶å†™å…¥ä¸€ä¸ªåŸå­å¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥è¡Œä¸ºå°±ä¼šè¢«æ˜ç¡®å®šä¹‰(å‚è§å…³äºæ•°æ®ç«äº‰çš„è¯¦ç»†ä¿¡æ¯çš„å†…å­˜æ¨¡å‹)
<br> â— æ­¤å¤–ï¼Œå¯¹åŸå­å¯¹è±¡çš„è®¿é—®å¯ä»¥å»ºç«‹çº¿ç¨‹é—´çš„åŒæ­¥ï¼Œå¹¶æŒ‰ç…§std::memory_orderæŒ‡å®šéåŸå­æ€§çš„å†…å­˜è®¿é—®
<br> â— std::atomicå¯ä»¥ç”¨äºä»»ä½•ç®€å•çš„å¯å¤åˆ¶çš„Tå®ä¾‹åŒ–ï¼ŒåŒæ—¶std::atomicæ˜¯ä¸å¯å¤åˆ¶å’Œä¸å¯ç§»åŠ¨çš„
<br>
<br><font color=blue size = 5>Member functions</font>
<br>
<br><font color=purple size = 4>(constructor)æ„é€ å‡½æ•°</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;">atomic()&nbsp;noexcept&nbsp;=&nbsp;<span style="color:#0000ff;">default</span><span style="color:#000000;">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;</span><span style="color:#0000ff;">default</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(since&nbsp;C++</span><span style="color:#ff0000;">11</span><span style="color:#000000;">)<BR>
constexpr&nbsp;atomic(&nbsp;T&nbsp;desired&nbsp;)&nbsp;noexcept;&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;initialization&nbsp;(since&nbsp;C++</span><span style="color:#ff0000;">11</span><span style="color:#000000;">)<BR>
atomic(&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;atomic&nbsp;&amp;&nbsp;)&nbsp;=&nbsp;</span><span style="color:#0000ff;">delete</span><span style="color:#000000;">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">3</span><span style="color:#000000;">)&nbsp;&nbsp;copy&nbsp;[deleted]&nbsp;(since&nbsp;C++</span><span style="color:#ff0000;">11</span><span style="color:#000000;">)</span></div></td></tr></table></div>
 â— æ„é€ åŸå­å˜é‡
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)å°†åŸå­å¯¹è±¡æ”¾åœ¨æœªåˆå§‹åŒ–çš„çŠ¶æ€ä¸­ï¼Œæœªåˆå§‹åŒ–çš„åŸå­å¯¹è±¡å¯ä»¥é€šè¿‡è°ƒç”¨atomicinitè¿›è¡Œåˆå§‹åŒ–
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)ç”¨desiredåˆå§‹åŒ–å¯¹è±¡ï¼Œåˆå§‹åŒ–ä¸æ˜¯åŸå­æ€§çš„
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)åŸå­å˜é‡æ˜¯ä¸å¯å¤åˆ¶çš„
<br>
<br><font color=purple size = 4>operator=</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;">T&nbsp;<span style="color:#0000ff;">operator</span><span style="color:#000000;">=(&nbsp;T&nbsp;desired&nbsp;)&nbsp;noexcept;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;value&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">=(&nbsp;T&nbsp;desired&nbsp;)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;value&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
atomic&nbsp;&amp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">=(&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;atomic&nbsp;&amp;&nbsp;)&nbsp;=&nbsp;</span><span style="color:#0000ff;">delete</span><span style="color:#000000;">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy&nbsp;[deleted]&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)<BR>
atomic&nbsp;&amp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">=(&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;atomic&nbsp;&amp;&nbsp;)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;=&nbsp;</span><span style="color:#0000ff;">delete</span><span style="color:#000000;">;&nbsp;copy&nbsp;[deleted]&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)</span></div></td></tr></table></div>
 â— ç”¨valæ›¿æ¢å­˜å‚¨çš„å€¼ã€‚è¯¥æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œå¹¶ä½¿ç”¨é¡ºåºä¸€è‡´æ€§(memoryorderseqcst)ã€‚è¦ä½¿ç”¨ä¸åŒçš„å†…å­˜æ’åºæ¥ä¿®æ”¹å€¼ï¼Œè¯·å‚è§atomic::store
<br> â— åŸå­å¯¹è±¡æ²¡æœ‰å®šä¹‰çš„å¤åˆ¶èµ‹å€¼ï¼Œä½†æ˜¯æ³¨æ„å®ƒä»¬æ˜¯å¯ä»¥éšå¼åœ°è½¬æ¢ä¸ºç±»å‹T
<br>æ³¨ï¼šä¸å¤§å¤šæ•°å¤åˆ¶è¿ç®—ç¬¦ä¸åŒï¼ŒåŸå­ç±»å‹çš„å¤åˆ¶è¿ç®—ç¬¦ä¸ä¼šè¿”å›å¯¹å®ƒä»¬çš„å·¦å‚æ•°çš„å¼•ç”¨ï¼Œå®ƒä»¬è¿”å›ä¸€ä¸ªå­˜å‚¨å€¼çš„å‰¯æœ¬
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;atomic&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;vector&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
atomic&lt;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&gt;&nbsp;ready(</span><span style="color:#0000ff;">false</span><span style="color:#000000;">);<BR>
atomic_flag&nbsp;winner&nbsp;=&nbsp;ATOMIC_FLAG_INIT;<BR>
atomic&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;foo(</span><span style="color:#ff0000;">0</span><span style="color:#000000;">);<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;count1m(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;id)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(!ready)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this_thread::yield();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">1000000</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(!winner.test_and_set())<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;thread&nbsp;#&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;id&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;&nbsp;won!\n&quot;</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;set_foo(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;foo&nbsp;=&nbsp;x;<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;print_foo()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(foo&nbsp;==&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this_thread::yield();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;foo:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;foo&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;vector&lt;thread&gt;&nbsp;threads;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;spawning&nbsp;10&nbsp;threads&nbsp;that&nbsp;count&nbsp;to&nbsp;1&nbsp;million&nbsp;...\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threads.push_back(thread(count1m,&nbsp;i&nbsp;+&nbsp;</span><span style="color:#ff0000;">1</span><span style="color:#000000;">));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;ready&nbsp;=&nbsp;</span><span style="color:#0000ff;">true</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&amp;&nbsp;th&nbsp;:&nbsp;threads)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;th.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;first(print_foo);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;second(set_foo,&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;first.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;second.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br><font color=blue size = 5>General atomic operations</font>
<br>
<br><font color=purple size = 4>std::atomic::is_lock_free</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;is_lock_free()&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;noexcept;<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;is_lock_free()&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;</span></div></td></tr></table></div>
 â— ä¸€ä¸ªæ— é”å¯¹è±¡å¹¶ä¸ä¼šå¯¼è‡´å…¶å®ƒçº¿ç¨‹åœ¨è®¿é—®æ—¶é˜»å¡(å¯èƒ½ä½¿ç”¨æŸç§ç±»å‹çš„äº‹åŠ¡æ€§å†…å­˜)ï¼Œè¯¥å‡½æ•°è¿”å›å€¼ä¸ç›¸åŒç±»å‹çš„æ‰€æœ‰å…¶å®ƒå¯¹è±¡è¿”å›å€¼ä¸€è‡´
<br> â— æ£€æŸ¥è¿™ä¸ªç±»å‹çš„æ‰€æœ‰å¯¹è±¡çš„åŸå­æ“ä½œæ˜¯å¦éƒ½æ˜¯æ— é”çš„ï¼Œè¿”å›trueè¡¨ç¤ºlock_free
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;utility&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;atomic&gt;<BR>
<BR>
</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;A&nbsp;{&nbsp;</span><span style="color:#0000ff;">public</span><span style="color:#000000;">:&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;a[</span><span style="color:#ff0000;">100</span><span style="color:#000000;">];&nbsp;};<BR>
</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;B&nbsp;{&nbsp;</span><span style="color:#0000ff;">public</span><span style="color:#000000;">:&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x;&nbsp;};<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;boolalpha<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;atomic&lt;A&gt;&nbsp;is&nbsp;lock&nbsp;free?&nbsp;&quot;</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;atomic&lt;A&gt;{}.is_lock_free()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">'\n'</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;atomic&lt;B&gt;&nbsp;is&nbsp;lock&nbsp;free?&nbsp;&quot;</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;atomic&lt;B&gt;{}.is_lock_free()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">'\n'</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}<BR>
</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼šfalse&nbsp;&nbsp;true</span></div></td></tr></table></div>
<br><font color=purple size = 4>std::atomic::store</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;store&nbsp;(T&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;store&nbsp;(T&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— ç”¨valæ›¿æ¢åŒ…å«çš„å€¼
<br> â— æ“ä½œæ˜¯åŸå­çš„ï¼ŒæŒ‰ç…§åŒæ­¥æ‰€æŒ‡å®šçš„å†…å­˜é¡ºåºå†…å­˜æ•°åºåŒ…æ‹¬ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ï¼ˆstd::memory_order_relaxed, std::memory_order_release å’Œstd::memory_order_seq_cstï¼‰
<br> â— å‚æ•°syncçš„æè¿°(åç»­ä¼šä»‹ç»memory_order)ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order_relaxedï¼šä¸åŒæ­¥å‰¯æœ¬
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order_releaseï¼šåŒæ­¥ä¸‹ä¸€ä¸ªä½¿ç”¨æˆ–è€…è·å–æ“ä½œçš„å‰¯æœ¬
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order_seq_cstï¼šåŒæ­¥æ‰€æœ‰ä¸å…¶ä»–é¡ºåºä¸€è‡´æ“ä½œçš„å¯è§çš„å‰¯æœ¬ï¼Œå¹¶éµå¾ªä¸€ä¸ªå®Œæ•´çš„é¡ºåº
<br>
<br><font color=purple size = 4>std::atomic::load</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;">T&nbsp;load&nbsp;(memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;<span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
T&nbsp;load&nbsp;(memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;noexcept;</span></div></td></tr></table></div>
 â— è¿”å›åŒ…å«å€¼
<br> â— æ“ä½œæ˜¯åŸå­çš„ï¼ŒæŒ‰ç…§åŒæ­¥æ‰€æŒ‡å®šçš„å†…å­˜é¡ºåºã€‚æŒ‡ä»¤å¿…é¡»æ˜¯ std::memory_order_relaxed, std::memory_order_consume, std::memory_order_acquire å’Œ std::memory_order_seq_cstï¼›å¦åˆ™ï¼Œè¡Œä¸ºæ˜¯æ²¡æœ‰å®šä¹‰çš„
<br> â— syncæŒ‡ä»¤æè¿°ï¼š
<br>(ä¸Šæ–‡å·²ç»æè¿°äº†std::memory_order_relaxedå’Œ std::memory_order_seq_cstï¼Œè¿™é‡Œåªæè¿°memory_order_acquireå’Œmemory_order_consume)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order_acquireï¼šåŒæ­¥ä»æœ€åä¸€ä¸ªReleaseæˆ–é¡ºåºä¸€è‡´çš„æ“ä½œæ‰€æœ‰å¯è§çš„å‰¯æœ¬
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order_consumeï¼šåŒæ­¥ä¸æœ€åä¸€ä¸ªReleaseæˆ–é¡ºåºä¸€è‡´çš„æ“ä½œæ‰€äº§ç”Ÿçš„ä¾èµ–å…³ç³»çš„å¯è§çš„å‰¯æœ¬
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;atomic&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
atomic&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;foo(</span><span style="color:#ff0000;">0</span><span style="color:#000000;">);<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;set_foo(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;set&nbsp;value&nbsp;atomically<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;foo.store(x,&nbsp;memory_order_relaxed);<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;print_foo()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">do</span><span style="color:#000000;">&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;get&nbsp;value&nbsp;atomically<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;foo.load(std::memory_order_seq_cst);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(x&nbsp;==&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;foo:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;x&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">'\n'</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;first(print_foo);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;second(set_foo,&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;first.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;second.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼šfoo:&nbsp;10</span></div></td></tr></table></div>
<br><font color=purple size = 4>std::atomic::operator T</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;operator T() const volatile noexcept;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;operator T() const noexcept;
<br> â— è¿™æ˜¯ä¸€ä¸ªç±»å‹è½¬æ¢çš„æ“ä½œç¬¦
<br> â— è¿™ä¸ªè¡¨è¾¾å¼æœŸæœ›å®ƒåŒ…å«çš„ç±»å‹(T)çš„å€¼ï¼Œè°ƒç”¨è¿™ä¸ªæˆå‘˜å‡½æ•°ï¼Œè®¿é—®åŒ…å«çš„å€¼
<br> â— è¯¥æ“ä½œæ˜¯åŸå­çš„ï¼Œå¹¶ä½¿ç”¨é¡ºåºä¸€è‡´æ€§(memory_order_seq_cst)ï¼Œè¦æ£€ç´¢å…·æœ‰ä¸åŒå†…å­˜é¡ºåºçš„å€¼ï¼Œç›¸å½“äºstd::atomic::load
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;atomic&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
atomic&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;foo(</span><span style="color:#ff0000;">0</span><span style="color:#000000;">);<BR>
atomic&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;bar(</span><span style="color:#ff0000;">0</span><span style="color:#000000;">);<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;set_foo(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;foo.store(x,&nbsp;memory_order_seq_cst);<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;foo&nbsp;=&nbsp;x;<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;copy_foo_to_bar()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(foo&nbsp;==&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this_thread::yield();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;bar&nbsp;=&nbsp;</span><span style="color:#0000ff;">static_cast</span><span style="color:#000000;">&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;(foo);<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;print_bar()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(bar&nbsp;==&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this_thread::yield();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;bar:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;bar&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;first(print_bar);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;second(set_foo,&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;third(copy_foo_to_bar);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;first.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;second.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;third.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br><font color=purple size = 4>std::atomic::exchange</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T exchange (T val, memory_order sync = memory_order_seq_cst) volatile noexcept;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T exchange (T val, memory_order sync = memory_order_seq_cst) noexcept;
<br> â— è®¿é—®å’Œä¿®æ”¹åŒ…å«çš„å€¼
<br> â— ç”¨valæ›¿æ¢åŒ…å«çš„å€¼å¹¶è¿”å›å®ƒä¹‹å‰çš„å€¼ï¼Œæ•´ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„(ä¸€ä¸ªåŸå­çš„è¯»-ä¿®æ”¹-å†™æ“ä½œ)ï¼Œåœ¨è¯»å–(è¿”å›)å€¼å’Œè¢«è¯¥å‡½æ•°ä¿®æ”¹çš„é‚£ä¸€åˆ»ä¹‹é—´ï¼Œå€¼ä¸ä¼šå—åˆ°å…¶å®ƒçº¿ç¨‹çš„å½±å“
<br> â— syncæŒ‡ä»¤æè¿°
<br>(ä¸Šæ–‡å·²ç»æè¿°äº†std::memory_order_relaxedå’Œ std::memory_order_seq_cst å’Œmemory_order_consume å’Œ memory_order_acquireï¼Œè¿™é‡Œåªæè¿°memory_order_acq_rel)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order_acq_relï¼šè¯»å–ä½œä¸ºä¸€ä¸ªè·å–æ“ä½œï¼Œå¹¶ä½œä¸ºä¸€ä¸ªå‘å¸ƒæ“ä½œå†™å…¥
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;atomic&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;vector&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
atomic&lt;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&gt;&nbsp;ready(</span><span style="color:#0000ff;">false</span><span style="color:#000000;">);<BR>
atomic&lt;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&gt;&nbsp;winner(</span><span style="color:#0000ff;">false</span><span style="color:#000000;">);<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;count1m(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;id)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">(!ready){}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">1000000</span><span style="color:#000000;">;&nbsp;++i){&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(!winner.exchange(</span><span style="color:#0000ff;">true</span><span style="color:#000000;">))<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;thread&nbsp;#&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;id&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;&nbsp;won!\n&quot;</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;vector&lt;thread&gt;&nbsp;threads;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;spawning&nbsp;10&nbsp;threads&nbsp;that&nbsp;count&nbsp;to&nbsp;1&nbsp;million&nbsp;...\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">1</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;=&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threads.push_back(thread(count1m,&nbsp;i));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;ready&nbsp;=&nbsp;</span><span style="color:#0000ff;">true</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&amp;&nbsp;th&nbsp;:&nbsp;threads)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;th.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br><font color=purple size = 4>std::atomic::compare_exchange_weak å’Œstd::atomic::compare_exchange_strong</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;compare_exchange_weak&nbsp;(T&amp;&nbsp;expected,&nbsp;T&nbsp;val,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;compare_exchange_weak&nbsp;(T&amp;&nbsp;expected,&nbsp;T&nbsp;val,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;noexcept;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;compare_exchange_weak&nbsp;(T&amp;&nbsp;expected,&nbsp;T&nbsp;val,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order&nbsp;success,&nbsp;memory_order&nbsp;failure)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;compare_exchange_weak&nbsp;(T&amp;&nbsp;expected,&nbsp;T&nbsp;val,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order&nbsp;success,&nbsp;memory_order&nbsp;failure)&nbsp;noexcept;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;compare_exchange_strong&nbsp;(T&amp;&nbsp;expected,&nbsp;T&nbsp;val,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;compare_exchange_strong&nbsp;(T&amp;&nbsp;expected,&nbsp;T&nbsp;val,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;noexcept;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;compare_exchange_strong&nbsp;(T&amp;&nbsp;expected,&nbsp;T&nbsp;val,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order&nbsp;success,&nbsp;memory_order&nbsp;failure)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;compare_exchange_strong&nbsp;(T&amp;&nbsp;expected,&nbsp;T&nbsp;val,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order&nbsp;success,&nbsp;memory_order&nbsp;failure)&nbsp;noexcept;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)</span></div></td></tr></table></div>
 â— æ¯”è¾ƒåŸå­å¯¹è±¡çš„åŒ…å«å€¼ä¸é¢„æœŸçš„å†…å®¹ï¼š
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 å¦‚æœæ˜¯çœŸçš„ï¼Œå®ƒä¼šç”¨valæ›¿æ¢åŒ…å«çš„å€¼(æ¯”å¦‚å­˜å‚¨)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 å¦‚æœæ˜¯å‡çš„ï¼Œå®ƒä¼šç”¨æ‰€åŒ…å«çš„å€¼æ›¿æ¢é¢„æœŸ,å› æ­¤è°ƒç”¨è¯¥å‡½æ•°ä¹‹åï¼Œå¦‚æœè¢«è¯¥åŸå­å¯¹è±¡å°è£…çš„å€¼ä¸å‚æ•° expected æ‰€æŒ‡å®šçš„å€¼ä¸ç›¸ç­‰ï¼Œexpected ä¸­çš„å†…å®¹å°±æ˜¯åŸå­å¯¹è±¡çš„æ—§å€¼
<br> â— å‡½æ•°æ€»æ˜¯è®¿é—®åŒ…å«çš„å€¼æ¥è¯»å–å®ƒï¼Œå¦‚æœè¿™ä¸ªæ¯”è¾ƒæ˜¯çœŸçš„ï¼Œé‚£ä¹ˆå®ƒä¹Ÿä¼šæ›¿æ¢å®ƒã€‚ä½†æ˜¯æ•´ä¸ªæ“ä½œéƒ½æ˜¯åŸå­æ€§çš„:åœ¨è¯»å–å€¼å’Œè¢«æ›¿æ¢çš„æ—¶åˆ»ä¹‹é—´ï¼Œå®ƒçš„å€¼ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹
<br> â— åœ¨ç¬¬(2)ç§æƒ…å†µä¸‹ï¼Œå†…å­˜åºï¼ˆMemory Orderï¼‰çš„é€‰æ‹©å–å†³äºæ¯”è¾ƒæ“ä½œç»“æœï¼Œå¦‚æœæ¯”è¾ƒç»“æœä¸º true(å³åŸå­å¯¹è±¡çš„å€¼ç­‰äº expected)ï¼Œåˆ™é€‰æ‹©å‚æ•° success æŒ‡å®šçš„å†…å­˜åºï¼Œå¦åˆ™é€‰æ‹©å‚æ•° failure æ‰€æŒ‡å®šçš„å†…å­˜åº
<br> â— æ³¨æ„ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™ä¸ªå‡½æ•°ç›´æ¥çš„æ¯”è¾ƒç‰©ç†å†…å®¹æ‰€åŒ…å«çš„ä»·å€¼ä¸é¢„æœŸçš„å†…å®¹ï¼Œè¿™å¯èƒ½å¯¼è‡´å¾—åˆ°ä½¿ç”¨operator==æ¯”è¾ƒçš„ç»“æœæ˜¯ä¸€ä¸ªå¤±è´¥çš„ç»“æœï¼Œå› ä¸ºå¯¹è±¡åº•å±‚çš„ç‰©ç†å†…å®¹ä¸­å¯èƒ½å­˜åœ¨ä½å¯¹é½æˆ–å…¶ä»–é€»è¾‘è¡¨ç¤ºç›¸åŒä½†æ˜¯ç‰©ç†è¡¨ç¤ºä¸åŒçš„å€¼(æ¯”å¦‚ true å’Œ 2 æˆ– 3ï¼Œå®ƒä»¬åœ¨é€»è¾‘ä¸Šéƒ½è¡¨ç¤º&quot;çœŸ&quot;ï¼Œä½†åœ¨ç‰©ç†ä¸Šä¸¤è€…çš„è¡¨ç¤ºå¹¶ä¸ç›¸åŒ)ï¼›
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸åƒ compare_exchange_strongï¼Œè¿™ä¸ªå¼±ç‰ˆæœ¬å…è®¸(spuriously åœ°)è¿”å› false(å³åŸå­å¯¹è±¡æ‰€å°è£…çš„å€¼ä¸å‚æ•° expected çš„ç‰©ç†å†…å®¹ç›¸åŒï¼Œä½†å´ä»ç„¶è¿”å› false)ï¼Œå³ä½¿åœ¨é¢„æœŸçš„å®é™…æƒ…å†µä¸æ‰€åŒ…å«çš„å¯¹è±¡ç›¸æ¯”è¾ƒæ—¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¯¹äºæŸäº›å¾ªç¯ç®—æ³•æ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯å¯æ¥å—çš„è¡Œä¸ºï¼Œå¹¶ä¸”å¯èƒ½ä¼šåœ¨æŸäº›å¹³å°ä¸Šå¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚åœ¨è¿™äº›è™šå‡çš„å¤±è´¥ä¸­ï¼Œå‡½æ•°è¿”å›falseï¼Œè€Œä¸ä¿®æ”¹é¢„æœŸã€‚
<br> â— å¯¹äºéå¾ªç¯ç®—æ³•æ¥è¯´ï¼Œ compare_exchange_strongé€šå¸¸æ˜¯é¦–é€‰
<br> â— compare_exchange_strong è·Ÿ compare_exchange_week ä¸åŒçš„æ˜¯ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸compare_exchange_weak ä¸åŒï¼Œstrongç‰ˆæœ¬çš„ compare-and-exchange æ“ä½œä¸å…è®¸(spuriously åœ°)è¿”å› falseï¼Œå³åŸå­å¯¹è±¡æ‰€å°è£…çš„å€¼ä¸å‚æ•° expected çš„ç‰©ç†å†…å®¹ç›¸åŒï¼Œæ¯”è¾ƒæ“ä½œä¸€å®šä¼šä¸º trueã€‚ä¸è¿‡åœ¨æŸäº›å¹³å°ä¸‹ï¼Œå¦‚æœç®—æ³•æœ¬èº«éœ€è¦å¾ªç¯æ“ä½œæ¥åšæ£€æŸ¥ï¼Œ compare_exchange_weak çš„æ€§èƒ½ä¼šæ›´å¥½ã€‚
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;atomic&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;vector&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#008000;">//&nbsp;a&nbsp;simple&nbsp;global&nbsp;linked&nbsp;list:<BR>
</span><span style="color:#0000ff;">struct</span><span style="color:#000000;">&nbsp;Node&nbsp;{&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;value;&nbsp;Node*&nbsp;next;&nbsp;};<BR>
atomic&lt;Node*&gt;&nbsp;list_head(nullptr);<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;append(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;val)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;append&nbsp;an&nbsp;element&nbsp;to&nbsp;the&nbsp;list<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Node*&nbsp;oldHead&nbsp;=&nbsp;list_head;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;Node*&nbsp;newNode&nbsp;=&nbsp;</span><span style="color:#0000ff;">new</span><span style="color:#000000;">&nbsp;Node{&nbsp;val,oldHead&nbsp;};<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;what&nbsp;follows&nbsp;is&nbsp;equivalent&nbsp;to:&nbsp;list_head&nbsp;=&nbsp;newNode,&nbsp;<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;but&nbsp;in&nbsp;a&nbsp;thread-safe&nbsp;way:<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(!list_head.compare_exchange_weak(oldHead,&nbsp;newNode))<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newNode-&gt;next&nbsp;=&nbsp;oldHead;<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;spawn&nbsp;10&nbsp;threads&nbsp;to&nbsp;fill&nbsp;the&nbsp;linked&nbsp;list:<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;vector&lt;thread&gt;&nbsp;threads;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threads.push_back(thread(append,&nbsp;i));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&amp;&nbsp;th&nbsp;:&nbsp;threads)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;th.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;print&nbsp;contents:<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(Node*&nbsp;it&nbsp;=&nbsp;list_head;&nbsp;it&nbsp;!=&nbsp;nullptr;&nbsp;it&nbsp;=&nbsp;it-&gt;next)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">'&nbsp;'</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;it-&gt;value;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">'\n'</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;cleanup:<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;Node*&nbsp;it;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(it&nbsp;=&nbsp;list_head)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list_head&nbsp;=&nbsp;it-&gt;next;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">delete</span><span style="color:#000000;">&nbsp;it;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br><font color=blue size = 4>ç‰¹å®šçš„æ“ä½œæ”¯æŒ(æ•´å‹å’ŒæŒ‡é’ˆ)</font>
<br>
<br><font color=purple size = 4>std::atomic::fetch_add/std::atomic::fetch_sub</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;T&nbsp;is&nbsp;integral&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;fetch_add&nbsp;(T&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;fetch_add&nbsp;(T&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;fetch_sub&nbsp;(T&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;fetch_sub&nbsp;(T&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;noexcept;<BR>
</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;T&nbsp;is&nbsp;pointer&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;fetch_add&nbsp;(ptrdiff_t&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;fetch_add&nbsp;(ptrdiff_t&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;fetch_sub&nbsp;(ptrdiff_t&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;fetch_sub&nbsp;(ptrdiff_t&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— å°†valåŠ æˆ–è€…å‡å»åˆ°åŒ…å«çš„å€¼å¹¶è¿”å›åœ¨æ“ä½œä¹‹å‰çš„å€¼
<br> â— æ•´ä¸ªæ“ä½œæ˜¯åŸå­çš„(ä¸€ä¸ªåŸå­çš„è¯»-ä¿®æ”¹-å†™æ“ä½œ)ï¼šå½“åœ¨è¿™ä¸ªå‡½æ•°è¢«ä¿®æ”¹çš„æ—¶å€™ï¼Œè¯»å–çš„(è¿”å›)å€¼è¢«è¯»å–ï¼Œå€¼ä¸å—å…¶ä»–çº¿ç¨‹çš„å½±å“
<br> â— è¿™ä¸ªæˆå‘˜å‡½æ•°æ˜¯å¯¹æ•´æ•°(1)å’ŒæŒ‡é’ˆ(2)ç±»å‹(é™¤äº†boolé™¤å¤–)çš„åŸå­ä¸“é—¨åŒ–ä¸­å®šä¹‰
<br> â— å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä½¿ç”¨é»˜è®¤å€¼ï¼Œåˆ™è¯¥å‡½æ•°ç­‰ä»·äºåŸå­::è¿ç®—ç¬¦+ =s
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;atomic&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
atomic&lt;</span><span style="color:#8000ff;">long</span><span style="color:#000000;">&nbsp;</span><span style="color:#8000ff;">long</span><span style="color:#000000;">&gt;&nbsp;data1;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;do_work()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;data1.fetch_add(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">,&nbsp;memory_order_relaxed);<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;th1(do_work);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;th2(do_work);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;th3(do_work);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;th4(do_work);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;th5(do_work);<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;th1.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;th2.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;th3.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;th4.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;th5.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Result:&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;data1&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">'\n'</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼šResult:5</span></div></td></tr></table></div>
<br><font color=purple size = 4>std::atomic::fetch_and/std::atomic::fetch_or/std::atomic::fetch_xor</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;">T&nbsp;fetch_and&nbsp;(T&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;<span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
T&nbsp;fetch_and&nbsp;(T&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;noexcept;<BR>
T&nbsp;fetch_or&nbsp;(T&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
T&nbsp;fetch_or&nbsp;(T&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;noexcept;<BR>
T&nbsp;fetch_xor&nbsp;(T&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
T&nbsp;fetch_xor&nbsp;(T&nbsp;val,&nbsp;memory_order&nbsp;sync&nbsp;=&nbsp;memory_order_seq_cst)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— è¯»å–åŒ…å«çš„å€¼å¹¶æ›¿æ¢è°ƒè¯¥å€¼å’Œvalæ‰§è¡Œä¸€ä¸ªä½å’Œæ“ä½œçš„ç»“æœ
<br> â— æ•´ä¸ªæ“ä½œæ˜¯åŸå­çš„(ä¸€ä¸ªåŸå­çš„è¯»-ä¿®æ”¹-å†™æ“ä½œ):å½“åœ¨è¿™ä¸ªå‡½æ•°è¢«ä¿®æ”¹çš„æ—¶å€™,è¯»å–çš„(è¿”å›)å€¼è¢«è¯»å–ï¼Œå€¼ä¸å—å…¶ä»–çº¿ç¨‹çš„å½±å“
<br> â— è¿™ä¸ªæˆå‘˜å‡½æ•°åªåœ¨åŸå­ä¸“é—¨åŒ–ä¸­å®šä¹‰ä¸ºæ•´æ•°ç±»å‹(é™¤äº†bool)
<br> â— å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä½¿ç”¨é»˜è®¤å€¼ï¼Œåˆ™è¯¥å‡½æ•°ç­‰ä»·äºåŸå­::operator&amp; =
<br>
<br><font color=purple size = 4>std::atomic::operator++/std::atomic::operator--</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;">pre-increment&nbsp;(<span style="color:#ff0000;">1</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">++()&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">++()&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">--()&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">--()&nbsp;noexcept;<BR>
&nbsp;post-increment&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">++&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">++&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">--&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">--&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— åŒ…å«å€¼çš„å€¼è¿›è¡Œå¢åŠ æˆ–å‡å°‘1ï¼Œæ“ä½œ(1)è¿”å›æ‰€å¾—åˆ°çš„åŒ…å«å€¼ï¼Œæ“ä½œ(2)è¿”å›ä¹‹å‰çš„å€¼
<br> â— æ•´ä¸ªæ“ä½œæ˜¯åŸå­çš„(ä¸€ä¸ªåŸå­çš„è¯»-ä¿®æ”¹-å†™æ“ä½œ):å½“åœ¨è¿™ä¸ªå‡½æ•°è¢«ä¿®æ”¹çš„æ—¶å€™,è¯»å–çš„(è¿”å›)å€¼è¢«è¯»å–ï¼Œå€¼ä¸å—å…¶ä»–çº¿ç¨‹çš„å½±å“
<br> â— å‡½æ•°åªåœ¨åŸå­ä¸“é—¨åŒ–ä¸­å®šä¹‰ä¸ºæ•´æ•°å’ŒæŒ‡é’ˆç±»å‹(é™¤äº†bool)
<br> â— è¿™ä¸ªå‡½æ•°çš„è¡Œä¸ºå°±åƒè°ƒç”¨std::stomic::fetch_add(1),memory_order_seq_cstä½œä¸ºå‚æ•°
<br>
<br><font color=purple size = 4>atomic::operator (comp. assign.)</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;T&nbsp;is&nbsp;integral&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">+=&nbsp;(T&nbsp;val)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">+=&nbsp;(T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">-=&nbsp;(T&nbsp;val)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">-=&nbsp;(T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">&amp;=&nbsp;(T&nbsp;val)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">&amp;=&nbsp;(T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;operator|=&nbsp;(T&nbsp;val)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;operator|=&nbsp;(T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">^=&nbsp;(T&nbsp;val)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">^=&nbsp;(T&nbsp;val)&nbsp;noexcept;<BR>
</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;T&nbsp;is&nbsp;pointer&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">+=&nbsp;(ptrdiff_t&nbsp;val)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">+=&nbsp;(ptrdiff_t&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">-=&nbsp;(ptrdiff_t&nbsp;val)&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;</span><span style="color:#0000ff;">operator</span><span style="color:#000000;">-=&nbsp;(ptrdiff_t&nbsp;val)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— å¯¹äºæ•´å‹(1)å’ŒæŒ‡é’ˆ(2)ç±»å‹çš„åŸå­ä¸“é—¨åŒ–æ˜¯æ”¯æŒå¤åˆèµ‹å€¼çš„ï¼›æ¯ä¸€ä¸ªå‡½æ•°éƒ½è®¿é—®åŒ…å«çš„å€¼ï¼Œåº”ç”¨åˆé€‚çš„æ“ä½œç¬¦ï¼Œå¹¶åœ¨æ“ä½œä¹‹å‰è¿”å›åŒ…å«å€¼çš„å€¼ï¼›æ‰€æœ‰è¿™äº›æ“ä½œéƒ½ä¸ä¼šå—åˆ°å…¶ä»–çº¿ç¨‹çš„å½±å“
<br> â— è¿™äº›å‡½æ•°çš„è¡Œä¸ºå°±åƒä½¿ç”¨memory_order<em>seq</em>_cstè°ƒç”¨std::stomic::fetch_ *å‡½æ•°ä¸€æ ·ï¼š
<table border="2">
<tr>
<th rowspan=2>operator</th>
<th colspan=2>member functions</th>
<th colspan=3>supported for</th>
</tr>
<tr>
<th>comp. assign.</th>
<th>equivalent</th>
<th>integral types</th>
<th>pointer types</th>
<th>other types</th>
</tr>
<tr align=center>
<td>+</td>
<td>atomic::operator +=</td>
<td>atomic::fetch_add</td>
<td>yes</td>
<td>yes</td>
<td>no</td>
</tr>
<tr align=center>
<td>-</td>
<td>atomic::operator -=</td>
<td>atomic::fetch_sub</td>
<td>yes</td>
<td>yes</td>
<td>no</td>
</tr>
<tr align=center>
<td>&amp;</td>
<td>atomic::operator &amp;=</td>
<td>atomic::fetch_and</td>
<td>yes</td>
<td>no</td>
<td>no</td>
</tr>
<tr align=center>
<td>|</td>
<td>atomic::operator |=</td>
<td>atomic::fetch_or</td>
<td>yes</td>
<td>no</td>
<td>no</td>
</tr>
<tr align=center>
<td>^</td>
<td>atomic::operator ^=</td>
<td>atomic::fetch_xor</td>
<td>yes</td>
<td>no</td>
<td>no</td>
</tr>
</table>
<br><a name="bc2"><font color=green size = 5>std::atomic_flag</font></a>
<br> â— atomic_flagæ˜¯ä¸€ä¸ªåŸå­å¸ƒå°”ç±»å‹
<br> â— ä¸åŒäºstd::atomicçš„æ‰€æœ‰ä¸“é—¨åŒ–ï¼Œå®ƒä¿è¯æ˜¯lock_free
<br> â— ä¸åƒstd::stomic<bool>ï¼Œstd::atomic_flagä¸æä¾›è´Ÿè½½æˆ–å­˜å‚¨æ“ä½œ
<br>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;atomic&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;vector&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
atomic_flag&nbsp;lock&nbsp;=&nbsp;ATOMIC_FLAG_INIT;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;f(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;n)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">100</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(lock.test_and_set(memory_order_acquire))&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;acquire&nbsp;lock<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;spin<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Output&nbsp;from&nbsp;thread&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;n&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lock.clear(memory_order_release);&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;release&nbsp;lock<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;vector&lt;thread&gt;&nbsp;v;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.emplace_back(f,&nbsp;i);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&amp;&nbsp;t&nbsp;:&nbsp;v)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br>
<br><font color=purple size = 4>æ„é€ å‡½æ•°(std::atomic_flag::atomic_flag)</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;atomic_flag() noexcept = default;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;atomic_flag (const atomic_flag&amp;T) = delete;
<br> â— atomic_flagåœ¨æ„å»º(æˆ–è®¾ç½®æˆ–æ¸…é™¤)ä¸Šå¤„äºä¸€ä¸ªæœªæŒ‡å®šçš„çŠ¶æ€ï¼Œé™¤éå®ƒè¢«æ˜¾å¼åœ°åˆå§‹åŒ–ä¸ºATOMIC_FLAG_INIT
<br> â— ATOMIC_FLAG_INITåˆå§‹åŒ–æ˜¯é€šè¿‡ç®€å•åœ°è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°æˆ–å…¶ä»–æ–¹æ³•æ¥å®ç°çš„ï¼Œè¿™å–å†³äºç‰¹å®šçš„åº“å®ç°
<br> â— atomic_flagå€¼ä¸èƒ½å¤åˆ¶/ç§»åŠ¨
<br> â— æ³¨æ„ï¼š std::atomic_flag::operator= ä¸å¯èµ‹å€¼ï¼Œå…¶èµ‹å€¼æ“ä½œç¬¦è¢«åˆ é™¤
<br>
<br><font color=purple size = 4>std::atomic_flag::test_and_set</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool test_and_set (memory_order sync = memory_order_seq_cst) volatile noexcept;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool test_and_set (memory_order sync = memory_order_seq_cst) noexcept;
<br> â— è®¾ç½®atomic_flagå¹¶è¿”å›æ˜¯å¦åœ¨è°ƒç”¨ä¹‹å‰å·²ç»è®¾ç½®çš„
<br> â— æ•´ä¸ªæ“ä½œæ˜¯åŸå­çš„(ä¸€ä¸ªåŸå­çš„è¯»-ä¿®æ”¹-å†™æ“ä½œ)ï¼šå½“åœ¨è¿™ä¸ªå‡½æ•°è¢«ä¿®æ”¹çš„æ—¶å€™ï¼Œè¯»å–çš„(è¿”å›)å€¼è¢«è¯»å–ï¼Œå€¼ä¸å—å…¶ä»–çº¿ç¨‹çš„å½±å“
<br>
<br><font color=purple size = 4>std::atomic_flag::clear</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void clear (memory_order sync = memory_order_seq_cst) volatile noexcept;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void clear (memory_order sync = memory_order_seq_cst) noexcept;
<br> â— æ¸…é™¤atomic_flag(å³æŠŠatomic_flag è®¾ä¸ºå‡)
<br> â— æ¸…é™¤atomic_flagä½¿ä¸‹ä¸€æ¬¡è°ƒç”¨æˆå‘˜atomic_flag::test_and_setå¯¹è±¡è¿”å›false
<br> â— æ“ä½œæ˜¯åŸå­çš„ï¼ŒæŒ‰ç…§syncæ‰€æŒ‡å®šçš„å†…å­˜é¡ºåº
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;atomic&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;vector&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;sstream&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
atomic&lt;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&gt;&nbsp;ready(</span><span style="color:#0000ff;">false</span><span style="color:#000000;">);<BR>
atomic_flag&nbsp;winner&nbsp;=&nbsp;ATOMIC_FLAG_INIT;<BR>
atomic_flag&nbsp;lock_stream&nbsp;=&nbsp;ATOMIC_FLAG_INIT;<BR>
stringstream&nbsp;stream;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;count1m(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;id)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(!ready)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this_thread::yield();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">1000000</span><span style="color:#000000;">;&nbsp;++i){}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(!winner.test_and_set())<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;thread&nbsp;#&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;id&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;&nbsp;won!\n&quot;</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;append_number(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">(lock_stream.test_and_set()){}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;stream&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;thread&nbsp;#&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;x&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;lock_stream.clear();<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;winner.test_and_set()&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;winner.clear();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;vector&lt;thread&gt;&nbsp;threads;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;spawning&nbsp;10&nbsp;threads&nbsp;that&nbsp;count&nbsp;to&nbsp;1&nbsp;million...\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threads.push_back(thread(count1m,&nbsp;i));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;ready&nbsp;=&nbsp;</span><span style="color:#0000ff;">true</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&amp;&nbsp;th&nbsp;:&nbsp;threads)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;th.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;vector&lt;thread&gt;&nbsp;th4reads;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">1</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;=&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;th4reads.push_back(thread(append_number,&nbsp;i));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&amp;&nbsp;th&nbsp;:&nbsp;th4reads)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;th.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;stream.str();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br><a name="bc3"><font color=green size = 5>std::memory_order</font></a>
<br> â— ä½œä¸ºç”¨äºæ‰§è¡ŒåŸå­æ“ä½œçš„å‡½æ•°çš„å‚æ•°ï¼Œç”¨äºæŒ‡å®šå¦‚ä½•åŒæ­¥ä¸åŒçº¿ç¨‹ä¸Šçš„å…¶ä»–æ“ä½œ
<br> ğŸ¨ å®šä¹‰ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">typedef</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">enum</span><span style="color:#000000;">&nbsp;memory_order<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;memory_order_relaxed,&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;relaxed<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;memory_order_consume,&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;consume<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;memory_order_acquire,&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;acquire<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;memory_order_release,&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;release<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;memory_order_acq_rel,&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;acquire/release<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;memory_order_seq_cst&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;sequentially&nbsp;consistent<BR>
</span><span style="color:#000000;">}&nbsp;memory_order;</span></div></td></tr></table></div>
<br> â— å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŸå­å¯¹è±¡æ—¶ï¼Œæ‰€æœ‰åŸå­æ“ä½œéƒ½ä¼šå¯¹ä¸€ä¸ªåŸå­å¯¹è±¡å®šä¹‰è‰¯å¥½çš„è¡Œä¸ºï¼šåœ¨ä»»ä½•å…¶ä»–åŸå­æ“ä½œèƒ½å¤Ÿè®¿é—®è¯¥å¯¹è±¡ä¹‹å‰ï¼Œæ¯ä¸ªåŸå­æ“ä½œéƒ½æ˜¯å®Œå…¨åœ¨å¯¹è±¡ä¸Šæ‰§è¡Œçš„ã€‚è¿™ä¿è¯äº†è¿™äº›å¯¹è±¡ä¸Šæ²¡æœ‰æ•°æ®ç«äº‰ï¼Œè€Œè¿™æ­£æ˜¯å®šä¹‰åŸå­æ€§çš„ç‰¹æ€§
<br> â— ä½†æ˜¯ï¼Œæ¯ä¸ªçº¿ç¨‹å¯èƒ½åœ¨å†…å­˜ä½ç½®ä¸Šæ‰§è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯åŸå­å¯¹è±¡æœ¬èº«ï¼šè¿™äº›æ“ä½œå¯èƒ½ä¼šå¯¹å…¶ä»–çº¿ç¨‹äº§ç”Ÿå¯è§çš„å‰¯ä½œç”¨ã€‚è¿™ç§ç±»å‹çš„å‚æ•°å…è®¸æŒ‡å®šæ“ä½œçš„å†…å­˜é¡ºåºï¼Œä»¥ç¡®å®šè¿™äº›(å¯èƒ½éåŸå­)å¯è§çš„å‰¯ä½œç”¨æ˜¯å¦‚ä½•åœ¨çº¿ç¨‹é—´åŒæ­¥çš„ï¼Œä½¿ç”¨åŸå­æ“ä½œä½œä¸ºåŒæ­¥ç‚¹ï¼Œå¦‚ä¸‹å‚æ•°
<br>
<br><font color=purple size = 4>memory_order_relaxed</font>
<br> â— è¯¥æ“ä½œåœ¨æŸä¸€æ—¶åˆ»è¢«å‘½ä»¤è¿›è¡ŒåŸå­åŒ–ï¼Œè¿™æ˜¯æœ€å®½æ¾çš„å†…å­˜é¡ºåºï¼Œæ— æ³•ä¿è¯å¯¹ä¸åŒçº¿ç¨‹çš„å†…å­˜è®¿é—®æ˜¯å¦‚ä½•æ ¹æ®åŸå­æ“ä½œè¿›è¡Œæ’åºçš„
<br> â— æ ‡è®°ä¸ºmemory_order_relaxedçš„åŸå­æ“ä½œä¸æ˜¯åŒæ­¥æ“ä½œï¼Œå®ƒä»¬ä¸ä¼šåœ¨å¹¶å‘å†…å­˜è®¿é—®ä¸­å¼ºåˆ¶æ‰§è¡Œé¡ºåºï¼Œå®ƒä»¬åªä¿è¯åŸå­æ€§å’Œä¿®æ”¹é¡ºåºçš„ä¸€è‡´æ€§
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;vector&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;atomic&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
atomic&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;cnt&nbsp;=&nbsp;{&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">&nbsp;};<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;f()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;n&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;n&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">1000</span><span style="color:#000000;">;&nbsp;++n)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cnt.fetch_add(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">,&nbsp;memory_order_relaxed);<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;vector&lt;thread&gt;&nbsp;v;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;n&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;n&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">;&nbsp;++n)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v.emplace_back(f);<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&amp;&nbsp;t&nbsp;:&nbsp;v)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Final&nbsp;counter&nbsp;value&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;cnt&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">'\n'</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼šFinal&nbsp;counter&nbsp;value&nbsp;is&nbsp;10000</span></div></td></tr></table></div>
<br><font color=purple size = 4>memory_order_consume</font>
<br> â— å¦‚æœåœ¨è¿™ä¸ªå¯¹é‡Šæ”¾æ“ä½œè¿›è¡Œä¾èµ–ï¼ˆå¹¶ä¸”å¯¹åŠ è½½çº¿ç¨‹æœ‰æ˜æ˜¾çš„å‰¯ä½œç”¨ï¼‰çš„é‡Šæ”¾çº¿ç¨‹ä¸Š æ‰€æœ‰è®¿é—®å†…å­˜ å·²ç»å‘ç”Ÿï¼Œé‚£ä¹ˆæ“ä½œå°†è¢«å‘½ä»¤æ‰§è¡Œ
<br> â— å¸¦æœ‰è¿™ä¸ªå†…å­˜é¡ºåºçš„åŠ è½½æ“ä½œåœ¨å—å½±å“çš„å†…å­˜ä½ç½®ä¸Šæ‰§è¡Œè·å–æ“ä½œï¼šå½“å‰çº¿ç¨‹ä¾èµ–äºå½“å‰è£…è½½çš„å€¼ï¼Œåœ¨æ­¤è´Ÿè½½ä¹‹å‰ï¼Œä¸éœ€è¦è¯»å–æˆ–å†™å…¥ã€‚åœ¨å½“å‰çº¿ç¨‹ä¸­å¯ä»¥çœ‹åˆ°ç›¸åŒçš„åŸå­å˜é‡ã€‚åœ¨å¤§å¤šæ•°å¹³å°ä¸Šï¼Œè¿™åªä¼šå½±å“ç¼–è¯‘å™¨ä¼˜åŒ–(å‚è§ä¸‹é¢çš„Release-Consume)
<br>
<br><font color=purple size = 4>memory_order_acquire</font>
<br> â— åœ¨é‡Šæ”¾çº¿ç¨‹(å¯¹åŠ è½½çº¿ç¨‹æœ‰æ˜æ˜¾çš„å‰¯ä½œç”¨)çš„æƒ…å†µä¸‹ï¼Œæ“ä½œè¢«å‘½ä»¤è¿›è¡Œä¸€æ¬¡
<br> â— å¸¦æœ‰è¿™ä¸ªå†…å­˜é¡ºåºçš„åŠ è½½æ“ä½œåœ¨å—å½±å“çš„å†…å­˜ä½ç½®ä¸Šæ‰§è¡Œè·å–æ“ä½œï¼šåœ¨æ­¤è´Ÿè½½ä¹‹å‰ï¼Œåœ¨å½“å‰çº¿ç¨‹ä¸­ä¸å¯ä»¥é‡æ–°æ’åºã€‚æ‰€æœ‰åœ¨å…¶ä»–çº¿ç¨‹ä¸­éƒ½å¯ä»¥åœ¨å½“å‰çº¿ç¨‹ä¸­çœ‹åˆ°ç›¸åŒçš„åŸå­å˜é‡(å‚è§ä¸‹é¢çš„Release-Acquire)
<br>
<br><font color=purple size = 4>memory_order_release</font>
<br> â— è¯¥æ“ä½œè¢«å‘½ä»¤åœ¨æ¶ˆè´¹æˆ–è·å–æ“ä½œä¹‹å‰å‘ç”Ÿï¼Œä½œä¸ºå¯¹å†…å­˜çš„å…¶ä»–è®¿é—®çš„åŒæ­¥ç‚¹ï¼Œå¯èƒ½å¯¹åŠ è½½çº¿ç¨‹æœ‰å¯è§çš„å‰¯ä½œç”¨
<br> â— å…·æœ‰è¿™ç§å†…å­˜é¡ºåºçš„å­˜å‚¨æ“ä½œæ‰§è¡Œé‡Šæ”¾æ“ä½œï¼šåœ¨å½“å‰çº¿ç¨‹ä¸­ï¼Œåœ¨è¯¥å­˜å‚¨ä¹‹åï¼Œä¸å¯ä»¥åœ¨å½“å‰çº¿ç¨‹ä¸­é‡æ–°æ’åºã€‚å½“å‰çº¿ç¨‹ä¸­æ‰€æœ‰çš„å†™æ“ä½œéƒ½å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­çœ‹åˆ°ï¼Œè¿™äº›çº¿ç¨‹è·å¾—ç›¸åŒçš„åŸå­å˜é‡(å‚è§ä¸‹é¢çš„Release-Acquire)ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ç›¸åŒåŸå­çš„å…¶ä»–çº¿ç¨‹ä¸­ï¼Œå°†å¯¹åŸå­å˜é‡çš„ä¾èµ–å˜ä¸ºå¯è§(å‚è§ä¸‹é¢çš„Release-Consume)
<br>
<br><font color=purple size = 4>memory_order_acq_rel</font>
<br> â— è¯¥æ“ä½œåŠ è½½å¹¶å­˜å‚¨é‡Šæ”¾(å¦‚ä¸Šæ‰€è¿°ï¼Œç”¨äºmemory_order_acquire ã€memory_order_release)
<br>
<br><font color=purple size = 4>memory_order_seq_cst</font>
<br> â— è¿™ä¸ªæ“ä½œæ˜¯æŒ‰é¡ºåºä¸€è‡´çš„æ–¹å¼æ’åºçš„ï¼šæ‰€æœ‰ä½¿ç”¨è¿™ä¸ªå†…å­˜é¡ºåºçš„æ“ä½œéƒ½æ˜¯åœ¨æ‰€æœ‰å¯èƒ½å¯¹å…¶ä»–çº¿ç¨‹éƒ½æœ‰å¯è§å‰¯ä½œç”¨çš„å†…å­˜ä¸­æ‰§è¡Œçš„
<br> â— è¿™æ˜¯æœ€ä¸¥æ ¼çš„å†…å­˜é¡ºåºï¼Œåœ¨éåŸå­å†…å­˜è®¿é—®çš„æƒ…å†µä¸‹ï¼Œä¿è¯äº†çº¿ç¨‹äº¤äº’ä¸­æœ€ä¸æ„å¤–çš„å‰¯ä½œç”¨
<br> â— å¯¹äºæ¶ˆè´¹å’Œè·å–è´Ÿè½½ï¼Œé¡ºåºä¸€è‡´çš„å­˜å‚¨æ“ä½œè¢«è®¤ä¸ºæ˜¯å‘å¸ƒæ“ä½œ
<br>è¡¨æ ¼ç®€è¿°ï¼š
<br><table border="2">
<tr>
<th>å€¼</th>
<th>æ„ä¹‰</th>
</tr>
<tr>
<td>memory_order_relaxed</td>
<td>å®½æ¾æ¨¡å‹ï¼Œä¸å¯¹æ‰§è¡Œé¡ºåºåšä¿è¯</td>
</tr>
<tr>
<td>memory_order_consume</td>
<td>å½“å‰çº¿ç¨‹ä¸­ï¼Œæ»¡è¶³happens-beforeåŸåˆ™<br>å½“å‰çº¿ç¨‹ä¸­è¯¥åŸå­çš„æ‰€æœ‰åç»­æ“ä½œï¼Œå¿…é¡»åœ¨æœ¬æ¡æ“ä½œå®Œæˆä¹‹åæ‰§è¡Œ</td>
</tr>
<tr>
<td>memory_order_acquire</td>
<td>å½“å‰çº¿ç¨‹ä¸­ï¼Œè¯»æ“ä½œæ»¡è¶³happens-beforeåŸåˆ™<br>æ‰€æœ‰åç»­çš„è¯»æ“ä½œå¿…é¡»åœ¨æœ¬æ“ä½œå®Œæˆåæ‰§è¡Œ</td>
</tr>
<tr>
<td>memory_order_release</td>
<td>å½“å‰çº¿ç¨‹ä¸­ï¼Œå†™æ“ä½œæ»¡è¶³happens-beforeåŸåˆ™<br>æ‰€æœ‰åç»­çš„å†™æ“ä½œå¿…é¡»åœ¨æœ¬æ“ä½œå®Œæˆåæ‰§è¡Œ</td>
</tr>
<tr>
<td>memory_order_acq_rel</td>
<td>å½“å‰çº¿ç¨‹ä¸­ï¼ŒåŒæ—¶æ»¡è¶³memory_order_acquireå’Œmemory_order_release</td>
</tr>
<tr>
<td>memory_order_seq_cst</td>
<td>æœ€å¼ºçº¦æŸã€‚å…¨éƒ¨è¯»å†™éƒ½æŒ‰é¡ºåºæ‰§è¡Œ</td>
</tr>
</table>
<br><a name="bc4"><font color=green size = 5>Functions</font></a>
<br>
<br><font color=purple size = 4>std::kill_dependency</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template <class T>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T kill_dependency (T y) noexcept;
<br> â— è¿”å›yçš„å€¼è€Œä¸éœ€è¦ä¾èµ–é¡¹
<br> â— ä½¿ç”¨memory_order_consumeä½œä¸ºå†…å­˜é¡ºåºçš„åŸå­æ“ä½œï¼Œè¦æ±‚ç¼–è¯‘å™¨æ£€æŸ¥é€šè¿‡è®¿é—®å­˜å‚¨çš„å†…å­˜ä½ç½®æ‰€å¸¦æ¥çš„ä¾èµ–å…³ç³»ï¼ŒåŒæ­¥è¿™æ ·çš„ä¾èµ–å…³ç³»å¯èƒ½ä¼šå¯¼è‡´æŸäº›ç¡¬ä»¶é€‰é¡¹è¢«è®¾ç½®ï¼Œå¹¶è¿«ä½¿ç¼–è¯‘å™¨æ”¾å¼ƒæ¶‰åŠè¿™äº›å†…å­˜çš„ä½ç½®å¹¶å­˜åœ¨æŸäº›æ½œåœ¨ä¼˜åŒ–
<br> â— è°ƒç”¨æ­¤å‡½æ•°æŒ‡ç¤ºç¼–è¯‘å™¨ï¼Œä»»ä½•ä¾èµ–äºyçš„ä¾èµ–é¡¹éƒ½ä¸åº”è¯¥ä¼ é€’åˆ°è¿”å›å€¼ï¼Œè€Œä¸éœ€è¦åŒæ­¥
<br>
<br><font color=blue size = 4>&quot;C&quot;é£æ ¼å¯¼å‡ºçš„å‡½æ•°ï¼š</font>
<br>
<br><font color=purple size = 4>atomic_thread_fence</font>
<br> ğŸ¨ å®šä¹‰ï¼šextern &quot;C&quot; void atomic_thread_fence (memory_order sync) noexcept;
<br> â— å»ºç«‹ä¸€ä¸ªå¤šçº¿ç¨‹çš„éš”ç¦»ï¼šå¯¹è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨çš„æ—¶é—´ç‚¹å˜æˆä¸€ä¸ªè·å–æˆ–è€…ä¸€ä¸ªé‡Šæ”¾(æˆ–è€…ä¸¤è€…éƒ½æ˜¯)çš„åŒæ­¥ç‚¹
<br> â— åœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¹‹å‰å‘ç”Ÿçš„é‡Šæ”¾çº¿ç¨‹çš„æ‰€æœ‰å¯è§çš„å‰¯ä½œç”¨éƒ½æ˜¯åŒæ­¥çš„ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°åœ¨è·å–çº¿ç¨‹ä¹‹å‰
<br> â— è°ƒç”¨è¯¥å‡½æ•°ä¸åŠ è½½æˆ–å­˜å‚¨åŸå­æ“ä½œå…·æœ‰ç›¸åŒçš„æ•ˆæœï¼Œä½†ä¸æ¶‰åŠåŸå­å€¼
<br>
<br><font color=purple size = 4>atomic_thread_fence</font>
<br> ğŸ¨ å®šä¹‰ï¼šextern &quot;C&quot; void atomic_signal_fence (memory_order sync) noexcept;
<br> â— å»ºç«‹ä¸€ä¸ªå•çº¿ç¨‹çš„éš”ç¦»ï¼šå¯¹è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨ç‚¹åœ¨ä¸€ä¸ªçº¿ç¨‹å†…å˜æˆä¸€ä¸ªè·å–æˆ–ä¸€ä¸ªé‡Šæ”¾ç‚¹(æˆ–è€…ä¸¤è€…)
<br> â— è¿™ä¸ªå‡½æ•°ç›¸å½“äºatomic_thread_fenceï¼Œä½†æ˜¯æ²¡æœ‰å› ä¸ºè°ƒç”¨è€Œå‘ç”Ÿçº¿ç¨‹é—´åŒæ­¥
<br> â— è¯¥å‡½æ•°çš„ä½œç”¨æ˜¯å¯¹ç¼–è¯‘å™¨è¿›è¡Œå‘é€æŒ‡ä»¤ï¼Œä»¥é˜»æ­¢å®ƒè¿›è¡Œä¼˜åŒ–ï¼ŒåŒ…æ‹¬å°†å†™æ“ä½œç§»åŠ¨åˆ°ä¸€ä¸ªé‡Šæ”¾æ …æ æˆ–åœ¨è·å–æ …æ ä¹‹å‰çš„è¯»æ“ä½œ
<br>
<br><a name="bc5"><font color=green size = 5>Functions for atomic objects (C-style)</font></a>
<br>
<br><font color=purple size = 4>atomic_is_lock_free</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_is_lock_free&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_is_lock_free&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj)&nbsp;noexcept;<BR>
overloads&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_is_lock_free&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_is_lock_free&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;A*&nbsp;obj)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— æ˜¯å¦æ˜¯lock_free
<br> â— æ³¨æ„ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é™¤äº†std::atomic_flagçš„æ‰€æœ‰åŸå­ç±»å‹éƒ½å¯ä»¥ä½¿ç”¨äº’æ–¥é”æˆ–å…¶ä»–é”å®šæ“ä½œå®ç°ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ— é”çš„åŸå­CPUæŒ‡ä»¤
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åŸå­ç±»å‹ä¹Ÿè¢«å…è®¸æœ‰æ—¶æ˜¯æ— é”çš„ï¼Œä¾‹å¦‚ï¼Œå¦‚æœåœ¨ç»™å®šçš„ä½“ç³»ç»“æ„ä¸­ï¼Œåªæœ‰å¯¹é½çš„å†…å­˜è®¿é—®æ˜¯è‡ªç„¶çš„ï¼Œé‚£ä¹ˆç›¸åŒç±»å‹çš„ä¸ä¸€è‡´çš„å¯¹è±¡å°±å¿…é¡»ä½¿ç”¨é”
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C++æ ‡å‡†æ¨è(ä½†ä¸éœ€è¦)æ— é”çš„åŸå­æ“ä½œä¹Ÿæ˜¯æ— åœ°å€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé€‚åˆäºä½¿ç”¨å…±äº«å†…å­˜çš„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;utility&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;atomic&gt;<BR>
<BR>
</span><span style="color:#0000ff;">struct</span><span style="color:#000000;">&nbsp;A<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;a[</span><span style="color:#ff0000;">100</span><span style="color:#000000;">];<BR>
};<BR>
</span><span style="color:#0000ff;">struct</span><span style="color:#000000;">&nbsp;B<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x,&nbsp;y;<BR>
};<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;std::atomic&lt;A&gt;&nbsp;a;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;std::atomic&lt;B&gt;&nbsp;b;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;std::cout&nbsp;&lt;&lt;&nbsp;std::boolalpha<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;std::atomic&lt;A&gt;&nbsp;is&nbsp;lock&nbsp;free?&nbsp;&quot;</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;std::atomic_is_lock_free(&amp;a)&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">'\n'</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;std::atomic&lt;B&gt;&nbsp;is&nbsp;lock&nbsp;free?&nbsp;&quot;</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&nbsp;std::atomic_is_lock_free(&amp;b)&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">'\n'</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br><font color=purple size = 4>std::atomic_init</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_init&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_init&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
overloads&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_init&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_init&nbsp;(A*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— ç”¨valçš„ä¸€ä¸ªåŒ…å«å€¼åˆå§‹åŒ–objï¼Œè¯¥å‡½æ•°ä¸æ˜¯åŸå­æ€§çš„ï¼šæ¥è‡ªå¦ä¸€ä¸ªçº¿ç¨‹çš„å¹¶å‘è®¿é—®ï¼Œå³ä½¿æ˜¯é€šè¿‡åŸå­æ“ä½œï¼Œä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç«äº‰
<br> â— å¦‚æœobjä¸æ˜¯é»˜è®¤æ„é€ ï¼Œé‚£ä¹ˆè¿™ä¸ªè¡Œä¸ºå°±æ²¡æœ‰å®šä¹‰
<br> â— å¦‚æœè¿™ä¸ªå‡½æ•°åœ¨åŒä¸€ä¸ªobjä¸Šè¢«è°ƒç”¨ä¸¤æ¬¡ï¼Œé‚£ä¹ˆè¿™ä¸ªè¡Œä¸ºæ˜¯æ²¡æœ‰å®šä¹‰çš„
<br>
<br><font color=purple size = 4>std::atomic_storeå’Œstd::atomic_store_explicit</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_store&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_store&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_store_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_store_explicit&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
overloads&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_store&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_store&nbsp;(A*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_store_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_store_explicit&nbsp;(A*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— ç”¨valæ›¿æ¢objä¸­åŒ…å«çš„å€¼ã€‚è¯¥æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œatomic_store ä½¿ç”¨é¡ºåºä¸€è‡´æ€§(memory_order_seq_cst)
<br> â— atomic_store_explicit æ˜¾ç¤ºåˆ¶å®šå†…å­˜é¡ºåºã€‚å‚è§stomicçš„ç­‰ä»·å‡½æ•°atomic::storeå’Œ atomic::operator=
<br>
<br><font color=purple size = 4>std::atomic_loadå’Œstd::atomic_load_explicit</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_load&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_load&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_load_explicit&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_load_explicit&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
overloads&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_load&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_load&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;A*&nbsp;obj)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_load_explicit&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_load_explicit&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— åŒä¸Šé¢å‡½æ•°ï¼Œè¿”å›objä¸­åŒ…å«çš„å€¼ã€‚è¯¥æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œå¹¶ä½¿ç”¨é¡ºåºä¸€è‡´æ€§(memory_order_seq_cst)
<br> â— è¦åˆ¶å®šå†…å­˜æ•°åºä½¿ç”¨æ˜¾ç¤ºè°ƒç”¨å‡½æ•°atomic_load_explicit
<br>
<br><font color=purple size = 4>std::atomic_exchangeå’Œstd::atomic_exchange_explicit</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_exchange&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_exchange&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_exchange_explicit(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_exchange_explicit(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
overloads&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_exchange&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_exchange&nbsp;(A*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_exchange_explicit(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_exchange_explicit(A*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— ç”¨valæ›¿æ¢objä¸­åŒ…å«çš„å€¼ï¼Œå¹¶è¿”å›objä¹‹å‰çš„å€¼
<br> â— æ•´ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„(ä¸€ä¸ªåŸå­çš„è¯»-ä¿®æ”¹-å†™æ“ä½œ)ï¼šåœ¨è¯»å–(è¿”å›)å€¼å’Œè¢«è¯¥å‡½æ•°ä¿®æ”¹çš„ç¬é—´ä¹‹é—´ï¼Œobjçš„å€¼ä¸ä¼šå—åˆ°å…¶ä»–çº¿ç¨‹çš„å½±å“ã€‚è¦åˆ¶å®šå†…å­˜æ•°åºä½¿ç”¨æ˜¾ç¤ºè°ƒç”¨å‡½æ•°atomic_exchange_explicit
<br>
<br><font color=purple size = 4>atomic_compare_exchange_weakå’Œatomic_compare_exchange_weak_explicit</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_weak&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_weak&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_weak_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;success,&nbsp;memory_order&nbsp;failure)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_weak_explicit&nbsp;(atomic&lt;T&gt;*&nbsp;obj,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;success,&nbsp;memory_order&nbsp;failure)&nbsp;noexcept;<BR>
overloads&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_weak&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_weak&nbsp;(A*&nbsp;obj,&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_weak_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;success,&nbsp;memory_order&nbsp;failure)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_weak_explicit&nbsp;(A*&nbsp;obj,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;success,&nbsp;memory_order&nbsp;failure)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— å°†objä¸­åŒ…å«çš„å€¼ä¸é¢„æœŸçš„å†…å®¹è¿›è¡Œæ¯”è¾ƒ
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦‚æœæ˜¯çœŸçš„ï¼Œå®ƒä¼šç”¨valæ›¿æ¢åŒ…å«çš„å€¼
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦‚æœæ˜¯å‡çš„ï¼Œå®ƒå°†ç”¨æ‰€åŒ…å«çš„å€¼æ›¿æ¢é¢„æœŸå€¼
<br> â— å‡½æ•°æ€»æ˜¯è®¿é—®åŒ…å«çš„å€¼æ¥è¯»å–å®ƒï¼Œå¦‚æœè¿™ä¸ªæ¯”è¾ƒæ˜¯çœŸçš„ï¼Œé‚£ä¹ˆå®ƒä¹Ÿä¼šæ›¿æ¢å®ƒã€‚ä½†æ˜¯æ•´ä¸ªæ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼šåœ¨è¯»å–å€¼å’Œè¢«æ›¿æ¢çš„æ—¶åˆ»ä¹‹é—´ï¼Œå®ƒçš„å€¼ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹
<br> â— æ³¨æ„ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™ä¸ªå‡½æ•°ç›´æ¥çš„æ¯”è¾ƒç‰©ç†å†…å®¹æ‰€åŒ…å«çš„ä»·å€¼ä¸é¢„æœŸçš„å†…å®¹ï¼Œè¿™å¯èƒ½å¯¼è‡´å¾—åˆ°ä½¿ç”¨operator==æ¯”è¾ƒçš„ç»“æœæ˜¯ä¸€ä¸ªå¤±è´¥çš„ç»“æœï¼Œå› ä¸ºå¯¹è±¡åº•å±‚çš„ç‰©ç†å†…å®¹ä¸­å¯èƒ½å­˜åœ¨ä½å¯¹é½æˆ–å…¶ä»–é€»è¾‘è¡¨ç¤ºç›¸åŒä½†æ˜¯ç‰©ç†è¡¨ç¤ºä¸åŒçš„å€¼(æ¯”å¦‚ true å’Œ 2 æˆ– 3ï¼Œå®ƒä»¬åœ¨é€»è¾‘ä¸Šéƒ½è¡¨ç¤º&quot;çœŸ&quot;ï¼Œä½†åœ¨ç‰©ç†ä¸Šä¸¤è€…çš„è¡¨ç¤ºå¹¶ä¸ç›¸åŒ)ï¼›
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸åƒ compare_exchange_strongï¼Œè¿™ä¸ªå¼±ç‰ˆæœ¬å…è®¸(spuriously åœ°)è¿”å› false(å³åŸå­å¯¹è±¡æ‰€å°è£…çš„å€¼ä¸å‚æ•° expected çš„ç‰©ç†å†…å®¹ç›¸åŒï¼Œä½†å´ä»ç„¶è¿”å› false)ï¼Œå³ä½¿åœ¨é¢„æœŸçš„å®é™…æƒ…å†µä¸æ‰€åŒ…å«çš„å¯¹è±¡ç›¸æ¯”è¾ƒæ—¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¯¹äºæŸäº›å¾ªç¯ç®—æ³•æ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯å¯æ¥å—çš„è¡Œä¸ºï¼Œå¹¶ä¸”å¯èƒ½ä¼šåœ¨æŸäº›å¹³å°ä¸Šå¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚åœ¨è¿™äº›è™šå‡çš„å¤±è´¥ä¸­ï¼Œå‡½æ•°è¿”å›falseï¼Œè€Œä¸ä¿®æ”¹é¢„æœŸï¼›
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯¹äºéå¾ªç¯ç®—æ³•æ¥è¯´ï¼Œ compare_exchange_strongé€šå¸¸æ˜¯é¦–é€‰ã€‚
<br>
<br><font color=purple size = 4>atomic_compare_exchange_strongå’Œatomic_compare_exchange_strong_explicit</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_strong&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_strong&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_strong_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;success,&nbsp;memory_order&nbsp;failure)&nbsp;noexcept;<BR>
&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_strong_explicit&nbsp;(atomic&lt;T&gt;*&nbsp;obj,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;success,&nbsp;memory_order&nbsp;failure)&nbsp;noexcept;<BR>
overloads&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_strong&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_strong&nbsp;(A*&nbsp;obj,&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_strong_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;success,&nbsp;memory_order&nbsp;failure)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_compare_exchange_strong_explicit&nbsp;(A*&nbsp;obj,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T*&nbsp;expected,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;success,&nbsp;memory_order&nbsp;failure)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— å°†objä¸­åŒ…å«çš„å€¼ä¸é¢„æœŸçš„å€¼è¿›è¡Œæ¯”è¾ƒï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦‚æœæ˜¯çœŸçš„ï¼Œå®ƒä¼šç”¨valæ›¿æ¢åŒ…å«çš„å€¼
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦‚æœæ˜¯å‡çš„ï¼Œå®ƒå°†ç”¨æ‰€åŒ…å«çš„å€¼æ›¿æ¢é¢„æœŸå€¼
<br> â— å‡½æ•°æ€»æ˜¯è®¿é—®åŒ…å«çš„å€¼æ¥è¯»å–å®ƒï¼Œå¦‚æœè¿™ä¸ªæ¯”è¾ƒæ˜¯çœŸçš„ï¼Œé‚£ä¹ˆå®ƒä¹Ÿä¼šæ›¿æ¢å®ƒã€‚ä½†æ˜¯æ•´ä¸ªæ“ä½œéƒ½æ˜¯åŸå­æ€§çš„:åœ¨è¯»å–å€¼å’Œè¢«æ›¿æ¢çš„æ—¶åˆ»ä¹‹é—´ï¼Œå®ƒçš„å€¼ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹
<br> â— æ³¨æ„ï¼š
<br>compare_exchange_strong è·Ÿ compare_exchange_week ä¸åŒçš„æ˜¯ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸compare_exchange_weak ä¸åŒ, strongç‰ˆæœ¬çš„ compare-and-exchange æ“ä½œä¸å…è®¸(spuriously åœ°)è¿”å› falseï¼Œå³åŸå­å¯¹è±¡æ‰€å°è£…çš„å€¼ä¸å‚æ•° expected çš„ç‰©ç†å†…å®¹ç›¸åŒï¼Œæ¯”è¾ƒæ“ä½œä¸€å®šä¼šä¸º trueã€‚ä¸è¿‡åœ¨æŸäº›å¹³å°ä¸‹ï¼Œå¦‚æœç®—æ³•æœ¬èº«éœ€è¦å¾ªç¯æ“ä½œæ¥åšæ£€æŸ¥ï¼Œ compare_exchange_weak çš„æ€§èƒ½ä¼šæ›´å¥½
<br>
<br><font color=purple size = 4>atomic_fetch_addå’Œatomic_fetch_add_explicit</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(integral)&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_fetch_add&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_fetch_add&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_add_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_add_explicit&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(pointer)&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;U&gt;&nbsp;U*&nbsp;atomic_fetch_add&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;U*&gt;*&nbsp;obj,&nbsp;ptrdiff_t&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;U&gt;&nbsp;U*&nbsp;atomic_fetch_add&nbsp;(atomic&lt;U*&gt;*&nbsp;obj,&nbsp;ptrdiff_t&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;U&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U*&nbsp;atomic_fetch_add_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;U*&gt;*&nbsp;obj,&nbsp;ptrdiff_t&nbsp;val,&nbsp;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;U&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U*&nbsp;atomic_fetch_add_explicit&nbsp;(atomic&lt;U*&gt;*&nbsp;obj,&nbsp;ptrdiff_t&nbsp;val,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
overloads&nbsp;(</span><span style="color:#ff0000;">3</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_add&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;M&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_add&nbsp;(A*&nbsp;obj,&nbsp;M&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_add_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;M&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_add_explicit&nbsp;(A*&nbsp;obj,&nbsp;M&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— å°†valæ·»åŠ åˆ°objä¸­æ‰€åŒ…å«çš„å€¼
<br> â— æ•´ä¸ªæ“ä½œéƒ½æ˜¯åŸå­æ€§çš„:åœ¨è¯»å–(è¿”å›)å€¼å’Œè¢«è¯¥å‡½æ•°ä¿®æ”¹çš„æ—¶åˆ»ä¹‹é—´ï¼Œå€¼ä¸èƒ½è¢«ä¿®æ”¹
<br> â— è¦åˆ¶å®šå†…å­˜æ•°åºä½¿ç”¨æ˜¾ç¤ºè°ƒç”¨å‡½æ•°atomic_fetch_add_explicit
<br>
<br><font color=purple size = 4>atomic_fetch_subå’Œatomic_fetch_sub_explicit</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(integral)&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_fetch_sub&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_fetch_sub&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_sub_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_sub_explicit&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(pointer)&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;U&gt;&nbsp;U*&nbsp;atomic_fetch_sub&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;U*&gt;*&nbsp;obj,&nbsp;ptrdiff_t&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;U&gt;&nbsp;U*&nbsp;atomic_fetch_sub&nbsp;(atomic&lt;U*&gt;*&nbsp;obj,&nbsp;ptrdiff_t&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;U&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U*&nbsp;atomic_fetch_sub_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;U*&gt;*&nbsp;obj,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ptrdiff_t&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;U&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U*&nbsp;atomic_fetch_sub_explicit&nbsp;(atomic&lt;U*&gt;*&nbsp;obj,&nbsp;ptrdiff_t&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
overloads&nbsp;(</span><span style="color:#ff0000;">3</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_sub&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;M&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_sub&nbsp;(A*&nbsp;obj,&nbsp;M&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_sub_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;M&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_sub_explicit&nbsp;(A*&nbsp;obj,&nbsp;M&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— ä»objä¸­æ‰€åŒ…å«çš„å€¼å‡å»val
<br> â— æ•´ä¸ªæ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼šåœ¨è¯»å–(è¿”å›)å€¼å’Œè¢«è¯¥å‡½æ•°ä¿®æ”¹çš„æ—¶åˆ»ä¹‹é—´ï¼Œå€¼ä¸èƒ½è¢«ä¿®æ”¹
<br> â— è¦åˆ¶å®šå†…å­˜æ•°åºä½¿ç”¨æ˜¾ç¤ºè°ƒç”¨å‡½æ•°atomic_fetch_sub_explicit
<br>
<br><font color=purple size = 4>atomic_fetch_andå’Œatomic_fetch_and_explicit</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(integral)&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_fetch_and&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_fetch_and&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_and_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_and_explicit&nbsp;(atomic&lt;T&gt;*&nbsp;obj,T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
overloads&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_and&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_and&nbsp;(A*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_and_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_and_explicit&nbsp;(A*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— è¯»å–objä¸­åŒ…å«çš„å€¼ï¼Œå¹¶é€šè¿‡åœ¨è¯»å–å€¼å’Œvalä¹‹é—´æ‰§è¡Œä¸€ä¸ªä½æ“ä½œâ€œä¸â€æ“ä½œæ¥æ›¿æ¢å®ƒ
<br> â— æ•´ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„(ä¸€ä¸ªåŸå­çš„è¯»-ä¿®æ”¹-å†™æ“ä½œ)ï¼šåœ¨è¯»å–(è¿”å›)å€¼å’Œè¢«è¯¥å‡½æ•°ä¿®æ”¹çš„é‚£ä¸€åˆ»ä¹‹é—´ï¼Œå€¼ä¸ä¼šå—åˆ°å…¶ä»–çº¿ç¨‹çš„å½±å“
<br> â— è¦åˆ¶å®šå†…å­˜æ•°åºä½¿ç”¨æ˜¾ç¤ºè°ƒç”¨å‡½æ•°atomic_fetch_and_explicit
<br>
<br><font color=purple size = 4>atomic_fetch_orå’Œatomic_fetch_or_explicit</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(integral)&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_fetch_or&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_fetch_or&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_or_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_or_explicit&nbsp;(atomic&lt;T&gt;*&nbsp;obj,T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
overloads&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_or&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_or&nbsp;(A*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_or_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_or_explicit&nbsp;(A*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— è¯»å–objä¸­åŒ…å«çš„å€¼ï¼Œå¹¶é€šè¿‡åœ¨è¯»å–å€¼å’Œvalä¹‹é—´æ‰§è¡Œä¸€ä¸ªä½æ“ä½œâ€œæˆ–â€æ“ä½œæ¥æ›¿æ¢å®ƒ
<br> â— æ•´ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„(ä¸€ä¸ªåŸå­çš„è¯»-ä¿®æ”¹-å†™æ“ä½œ)ï¼šåœ¨è¯»å–(è¿”å›)å€¼å’Œè¢«è¯¥å‡½æ•°ä¿®æ”¹çš„é‚£ä¸€åˆ»ä¹‹é—´ï¼Œå€¼ä¸ä¼šå—åˆ°å…¶ä»–çº¿ç¨‹çš„å½±å“
<br> â— è¦åˆ¶å®šå†…å­˜æ•°åºä½¿ç”¨æ˜¾ç¤ºè°ƒç”¨å‡½æ•°atomic_fetch_or_explicit
<br>
<br><font color=purple size = 4>atomic_fetch_xorå’Œatomic_fetch_xor_explicit</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;(integral)&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_fetch_xor&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;T&nbsp;atomic_fetch_xor&nbsp;(atomic&lt;T&gt;*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_xor_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic&lt;T&gt;*&nbsp;obj,T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_xor_explicit&nbsp;(atomic&lt;T&gt;*&nbsp;obj,T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
overloads&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;&nbsp;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_xor&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_xor&nbsp;(A*&nbsp;obj,&nbsp;T&nbsp;val)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_xor_explicit&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;A*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
&nbsp;&nbsp;&nbsp;T&nbsp;atomic_fetch_xor_explicit&nbsp;(A*&nbsp;obj,&nbsp;T&nbsp;val,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— è¯»å–objä¸­åŒ…å«çš„å€¼ï¼Œå¹¶é€šè¿‡åœ¨è¯»å–å€¼å’Œvalä¹‹é—´æ‰§è¡Œä¸€ä¸ªä½æ“ä½œâ€œå¼‚æˆ–â€æ“ä½œæ¥æ›¿æ¢å®ƒ
<br> â— æ•´ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„(ä¸€ä¸ªåŸå­çš„è¯»-ä¿®æ”¹-å†™æ“ä½œ):åœ¨è¯»å–(è¿”å›)å€¼å’Œè¢«è¯¥å‡½æ•°ä¿®æ”¹çš„é‚£ä¸€åˆ»ä¹‹é—´ï¼Œå€¼ä¸ä¼šå—åˆ°å…¶ä»–çº¿ç¨‹çš„å½±å“
<br> â— è¦åˆ¶å®šå†…å­˜æ•°åºä½¿ç”¨æ˜¾ç¤ºè°ƒç”¨å‡½æ•°atomic_fetch_xor_explicit
<br>
<br><font color=purple size = 4>atomic_flag_test_and_setå’Œatomic_flag_test_and_set_explicit</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_flag_test_and_set&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic_flag&nbsp;*obj)&nbsp;noexcept;<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_flag_test_and_set&nbsp;(atomic_flag&nbsp;*obj)&nbsp;noexcept;<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_flag_test_and_set&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic_flag&nbsp;*obj,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;atomic_flag_test_and_set&nbsp;(atomic_flag&nbsp;*obj,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— è®¾ç½®objæŒ‡å‘çš„åŸå­æ ‡å¿—ï¼Œå¹¶è¿”å›è°ƒç”¨ä¹‹å‰çš„å€¼
<br> â— æ•´ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„(ä¸€ä¸ªåŸå­çš„è¯»-ä¿®æ”¹-å†™æ“ä½œ):åœ¨è¯»å–(è¿”å›)å€¼å’Œè¢«è¯¥å‡½æ•°ä¿®æ”¹çš„ç¬é—´ä¹‹é—´ï¼Œobjçš„å€¼ä¸ä¼šå—åˆ°å…¶ä»–çº¿ç¨‹çš„å½±å“
<br> â— è¦åˆ¶å®šå†…å­˜æ•°åºä½¿ç”¨æ˜¾ç¤ºè°ƒç”¨å‡½æ•°atomic_flag_test_and_set
<br>
<br><font color=purple size = 4>atomic_flag_clearå’Œatomic_flag_clear_explicit</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_flag_clear&nbsp;(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic_flag&nbsp;*obj)&nbsp;noexcept;<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_flag_clear&nbsp;(atomic_flag&nbsp;*obj)&nbsp;noexcept;<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_flag_clear_explicit(</span><span style="color:#0000ff;">volatile</span><span style="color:#000000;">&nbsp;atomic_flag&nbsp;*obj,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;atomic_flag_clear_explicit(atomic_flag&nbsp;*obj,&nbsp;memory_order&nbsp;sync)&nbsp;noexcept;</span></div></td></tr></table></div>
 â— æ¸…é™¤objï¼Œå°†å®ƒçš„æ ‡å¿—å€¼è®¾ç½®ä¸ºfalse
<br> â— è¯¥æ“ä½œæ˜¯åŸå­æ€§çš„
<br> â— è¦åˆ¶å®šå†…å­˜æ•°åºä½¿ç”¨æ˜¾ç¤ºè°ƒç”¨å‡½æ•°atomic_flag_clear_explicit
<br>
<br><a name="bc6"><font color=green size = 5>Macro functions</font></a>
<br>
<br><font color=purple size = 4>ATOMIC_VAR_INIT</font>
<br> â— ATOMIC_VAR_INIT(val) //åˆå§‹åŒ– std::atomic å¯¹è±¡
<br> â— è¿™ä¸ªå®çš„å­˜åœ¨æ˜¯ä¸ºäº†ä¸Cå®ç°å…¼å®¹ï¼Œåœ¨å…¶ä¸­ï¼Œå®ƒè¢«ç”¨ä½œæ„é€ å‡½æ•°(é»˜è®¤æ„é€ çš„)åŸå­å¯¹è±¡
<br> â— åœ¨C++ä¸­ï¼Œè¿™ä¸ªåˆå§‹åŒ–å¯ä»¥ç”±åˆå§‹åŒ–æ„é€ å‡½æ•°ç›´æ¥æ‰§è¡Œ
<br>
<br><font color=purple size = 4>ATOMIC_FLAG_INIT</font>
<br> â— ATOMIC_FLAG_INIT //åˆå§‹åŒ– std::atomic_flag å¯¹è±¡
<br> â— è¿™ä¸ªå®çš„å®šä¹‰ç”¨æ¥å°†ç±»å‹std::atomic_flagçš„å¯¹è±¡åˆå§‹åŒ–åˆ°clearçš„çŠ¶æ€</p>

<p><br><br><br>
<font color = gray size = 3>å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼</font></p></div>
        <div class="post_footer">
          
          <div class="meta">
            <div class="info">
              <span class="field tags">
                <i class="remixicon-stack-line"></i>
                
                <a href="https://oubc.github.io/tags/c/c&#43;&#43;/">C/C&#43;&#43;</a>
                
              </span>
            </div>
          </div>
          
        </div>
      </div>
      
      
    </div>
  </div>
  <a id="back_to_top" href="#" class="back_to_top"><span>â–³</span></a>
</div>
<footer class="footer">
  <div class="powered_by">
    <a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4l9lmg4aog3074074gnf.gif?tags=%5B%5D">I </a>
	<a href="">love</a>
    <a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4l9lmfm2eg306o06o74u.gif?tags=%5B%5D"> you </a>
    <a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4njrx4tpcj30fn0bq3zg.jpg?tags=%5B%5D">three </a>
	<a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4njrx64ctg307s07swfy.gif?tags=%5B%5D">thousand</a>
    <a href="https://www.kugou.com/song/#hash=96426C78381DE98DC31A5846FC274CBF&album_id=646623"> times.</a>
  </div>

  <div class="footer_slogan">
    <span>å®¶åº­ã€æ¢¦æƒ³ã€å†…å¿ƒçš„å¹³é™</span>
  </div>
</footer>



<script src="https://oubc.github.io/js/jquery-3.3.1.min.js"></script>
<script src="https://oubc.github.io/js/zozo.js"></script>
<script src="https://oubc.github.io/js/highlight.pack.js"></script>
<link  href="https://oubc.github.io/css/fancybox.min.css" rel="stylesheet">
<script src="https://oubc.github.io/js/fancybox.min.js"></script>

<script>hljs.initHighlightingOnLoad()</script>


  <script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>






</body>
</html>
