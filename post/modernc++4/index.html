<!DOCTYPE html>
<html lang="zh-cn" >
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  
  <meta name="author"
        content="Bruce Cheung"/>

  
  <meta name="description" content=""/>
  

  
  
  <meta name="keywords" content="blog, simple, dream"/>
  

  
  <link rel="canonical" href="https://oubc.github.io/post/modernc&#43;&#43;4/"/>

  

  <title>Modern C&#43;&#43; å¤šçº¿ç¨‹ å¼‚æ­¥ &middot; Love, or death</title>

  <link rel="shortcut icon" href="https://oubc.github.io/images/favicon.ico"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/animate.min.css"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/remixicon.css"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/zozo.css"/>
  <link rel="stylesheet" href="https://oubc.github.io/css/highlight.css"/>

  
  
</head>

<body>
<div class="main animated">
  <div class="nav_container animated fadeInDown">
  <div class="site_nav" id="site_nav">
    <ul>
      
      <li>
        <a href="/">é¦–é¡µ</a>
      </li>
      
      <li>
        <a href="/post/">å½’æ¡£</a>
      </li>
      
      <li>
        <a href="/tags/">æ ‡ç­¾</a>
      </li>
      
      <li>
        <a href="/about/">å…³äº</a>
      </li>
      
    </ul>
  </div>
  <div class="menu_icon">
    <a id="menu_icon"><i class="remixicon-links-line"></i></a>
  </div>
</div>

  <div class="header animated fadeInDown">
  <div class="site_title_container">
    <div class="site_title">
      <h1>
        <a href="https://oubc.github.io/">
          <span>Love, or death</span>
          <img src="https://oubc.github.io/images/logo.svg"/>
        </a>
      </h1>
    </div>
    <div class="description">
      <p class="sub_title">For you, a thousand times over.</p>
      <div class="my_socials">
        
        
        <a href="https://github.com/oubc" title="github" target="_blank"><i class="remixicon-github-fill"></i></a>
        
        
        
        <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=uYGOjo6OiIuLivnIyJfa1tQ" title="mail" target="_blank"><i class="remixicon-mail-fill"></i></a>
        
        
        
        <a href="http://sighttp.qq.com/msgrd?v=1&amp;uin=877771223" title="qq" target="_blank"><i class="remixicon-qq-fill"></i></a>
        
        
        
        <a href="https://github.com/oubc/oubc.github.io/blob/master/images/wx.jpg?raw=true" title="wechat" target="_blank"><i class="remixicon-wechat-fill"></i></a>
        
        
        
        <a href="https://weibo.com/u/6993631995?topnav=1&amp;wvr=6&amp;topsug=1" title="weibo" target="_blank"><i class="remixicon-weibo-fill"></i></a>
        
        
        <a href="https://oubc.github.io/index.xml" type="application/rss+xml" title="rss" target="_blank"><i class="remixicon-rss-fill"></i></a>
      </div>
    </div>
  </div>
</div>

  <div class="content">
    <div class="post_page">
      <div class="post animated fadeInDown">
        <div class="post_title post_detail_title">
          <h2><a href='/post/modernc&#43;&#43;4/'>Modern C&#43;&#43; å¤šçº¿ç¨‹ å¼‚æ­¥</a></h2>
          <span class="date">2020.02.14</span>
        </div>
        <div class="post_content markdown"><p><br>
<br><font color=green size = 5>C++æ–°æ ‡å‡†ä¹‹å¤šçº¿ç¨‹ å¼‚æ­¥æ“ä½œ</font>
<br>
<br><font color = gray size = 3>ç›®å½•</font><font color = gray size = 2> (ç‚¹å‡»è·³è½¬)</font>
<br><a href="#bc0"><font color=yellow size = 4>&lt;future&gt;å¤´æ–‡ä»¶æè¿°åŠç»“æ„</font></a>
<br><a href="#bc1"><font color=blue size = 4>class promise</font></a>
<br><a href="#bc2"><font color=pink size = 4>class packaged_task</font></a>
<br><a href="#bc3"><font color=purple size = 4>class future</font></a>
<br><a href="#bc4"><font color=cyan size = 4>class shared_future</font></a>
<br><a href="#bc5"><font color=yellow size = 4>other types</font></a>
<br><a href="#bc6"><font color=blue size = 4>&lt;future&gt; function</font></a>
<br>
<br>
<br>æœ¬æ–‡å°†ä»‹ç»C++11çš„å¦ä¸€å¤§ç‰¹æ€§ï¼šå¼‚æ­¥è¿è¡Œ(std::async)ã€‚asyncé¡¾åæ€ä¹‰æ˜¯å°†ä¸€ä¸ªå‡½æ•°Aç§»è‡³å¦ä¸€çº¿ç¨‹ä¸­å»è¿è¡Œï¼ŒAå¯ä»¥æ˜¯é™æ€å‡½æ•°ã€å…¨å±€å‡½æ•°ï¼Œç”šè‡³ç±»æˆå‘˜å‡½æ•°ï¼Œåœ¨å¼‚æ­¥è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœAéœ€è¦å‘è°ƒç”¨è€…è¾“å‡ºç»“æœæ€ä¹ˆåŠå‘¢ï¼Ÿstd::asyncå®Œç¾è§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚åœ¨äº†è§£asyncçš„è§£å†³ä¹‹é“å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›çŸ¥è¯†å‚¨å¤‡ï¼Œé‚£å°±æ˜¯ï¼šstd::promiseã€std::packaged_taskå’Œstd::futureã€‚
<br>
<br><a name="bc0"><font color=green size = 5>&lt;future&gt;å¤´æ–‡ä»¶æè¿°åŠç»“æ„</font></a>
<br> â— &lt;future&gt;å¤´æ–‡ä»¶åŠŸèƒ½å…è®¸å¯¹ç‰¹å®šæä¾›è€…è®¾ç½®çš„å€¼è¿›è¡Œå¼‚æ­¥è®¿é—®ï¼Œå¯èƒ½åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ï¼›
<br> â— è¿™äº›æä¾›ç¨‹åº(è¦ä¹ˆæ˜¯promise å¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯packaged_taskå¯¹è±¡ï¼Œæˆ–è€…æ˜¯å¯¹å¼‚æ­¥çš„è°ƒç”¨async)ä¸futureå¯¹è±¡å…±äº«å…±äº«çŠ¶æ€ï¼šæä¾›è€…ä½¿å…±äº«çŠ¶æ€å°±ç»ªçš„ç‚¹ä¸futureå¯¹è±¡è®¿é—®å…±äº«çŠ¶æ€çš„ç‚¹åŒæ­¥ã€‚
<br>&lt;future&gt; å¤´æ–‡ä»¶ç»“æ„ï¼š
<br>
<table border="2">
<tr>
<th>ç±»å‹</th>
<th>ç±»</th>
<th>æè¿°</th>
</tr>
<tr>
<th>Providers</th>
<td>promise<br>packaged_task</td>
<td>ä¸ºå¼‚æ­¥æ£€ç´¢å­˜å‚¨ä¸€ä¸ªå€¼(ç±»æ¨¡æ¿)<br>æ‰“åŒ…ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå­˜å‚¨å¼‚æ­¥æ£€ç´¢çš„è¿”å›å€¼(ç±»æ¨¡æ¿)</td>
</tr>
<tr>
<th>Futures</th>
<td>future<br>shared_future</td>
<td>ç­‰å¾…ä¸€ä¸ªå¼‚æ­¥è®¾ç½®çš„å€¼(ç±»æ¨¡æ¿)<br>ç­‰å¾…ä¸€ä¸ªå¼‚æ­¥è®¾ç½®çš„å€¼(å¯èƒ½è¢«å…¶å®ƒfutureæ‰€å¼•ç”¨)(ç±»æ¨¡æ¿)</td>
</tr>
<tr>
<th>Other types</th>
<td>future_error<br>future_errc<br>future_status<br>launch</td>
<td>æŠ¥å‘Šä¸futureæˆ–promisesæœ‰å…³çš„é”™è¯¯(ç±»)<br>è¯†åˆ«futureçš„é”™è¯¯ä»£ç (æšä¸¾)<br>ç”¨äºå®šæ—¶çš„æ“ä½œçš„è¿”å›å€¼(æšä¸¾)<br>æŒ‡å®šstd::asyncçš„å¯åŠ¨ç­–ç•¥(æšä¸¾)</td>
</tr>
</table>
<br>
<table border="2">
<tr>
<th>ç±»å‹</th>
<th>å‡½æ•°</th>
<th>æè¿°</th>
</tr>
<tr>
<th>Provider</th>
<td>async</td>
<td>å¼‚æ­¥åœ°è¿è¡Œä¸€ä¸ªå‡½æ•°(å¯èƒ½åœ¨ä¸€ä¸ªæ–°çº¿ç¨‹ä¸­)å¹¶è¿”å›ä¸€ä¸ªä¿æŒç»“æœçš„std::future(å‡½æ•°æ¨¡æ¿)</td>
</tr>
<tr>
<th>Other types</th>
<td>future_category</td>
<td>è¯†åˆ«futureçš„é”™è¯¯ç±»åˆ«(å‡½æ•°)</td>
</tr>
</table>
<br><font color=green size = 5>&lt;future&gt; Providers</font>
<br>
<br><a name="bc1"><font color=blue size = 5>std::promise</font></a>
<br> ğŸ¨ å®šä¹‰ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;&nbsp;promise;&nbsp;&nbsp;&nbsp;<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;R&amp;&gt;&nbsp;promise&lt;R&amp;&gt;;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;specialization:&nbsp;T&nbsp;is&nbsp;a&nbsp;reference&nbsp;type&nbsp;(R&amp;)<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise&lt;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&gt;;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;specialization:&nbsp;T&nbsp;is&nbsp;void</span></div></td></tr></table></div>
 â— promiseæ˜¯ä¸€ä¸ªå­˜å‚¨ç”±ä¸€ä¸ª(å¯èƒ½æ˜¯å¦ä¸€ä¸ªçº¿ç¨‹)futureå¯¹è±¡æ£€ç´¢çš„ç±»å‹Tçš„å€¼çš„å¯¹è±¡ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåŒæ­¥ç‚¹ï¼›
<br> â— åœ¨æ„é€ ä¸Šï¼Œpromiseå¯¹è±¡ä¸ä¸€ä¸ªæ–°çš„å…±äº«çŠ¶æ€ç›¸å…³è”ï¼Œå®ƒä»¬å¯ä»¥å­˜å‚¨ç±»å‹Tçš„å€¼æˆ–ä»std::exceptionä¸­æ´¾ç”Ÿçš„å¼‚å¸¸ï¼›
<br> â— è¿™ä¸ªå…±äº«çŠ¶æ€å¯ä»¥é€šè¿‡è°ƒç”¨æˆå‘˜get_futureå…³è”åˆ°ä¸€ä¸ªfutureå¯¹è±¡ï¼Œè°ƒç”¨åï¼Œä¸¤ä¸ªå¯¹è±¡å…±äº«ç›¸åŒçš„å…±äº«çŠ¶æ€ï¼š
<br> 1.promiseå¯¹è±¡æ˜¯å¼‚æ­¥æä¾›ç¨‹åºï¼Œå®ƒå°†ä¸ºå…±äº«çŠ¶æ€è®¾ç½®ä¸€ä¸ªå€¼
<br> 2.futureå¯¹è±¡æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿”å›å¯¹è±¡ï¼Œå®ƒå¯ä»¥æ£€ç´¢å…±äº«çŠ¶æ€çš„å€¼ï¼Œç­‰å¾…å®ƒåœ¨å¿…è¦æ—¶å°±ç»ª
<br> â— å…±äº«çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸè‡³å°‘æŒç»­åˆ°æœ€åä¸€ä¸ªå¯¹è±¡é‡Šæ”¾å®ƒæˆ–è¢«é”€æ¯ã€‚å› æ­¤ï¼Œå®ƒå¯ä»¥ä½¿promiseå¯¹è±¡å­˜æ´»ä¸‹æ¥ï¼Œå¦‚æœæŠŠå®ƒä¸futureå¯¹è±¡è”ç³»åœ¨ä¸€èµ·çš„è¯ï¼Œå®ƒå°±èƒ½åœ¨ç¬¬ä¸€ä¸ªåœ°æ–¹å¾—åˆ°å®ƒï¼›
<br> â— ä¸¤ä¸ªpromiseçš„ç‰¹åŒ–å®šä¹‰åœ¨&lt;future&gt;å¤´æ–‡ä»¶ä¸­ï¼Œå®ƒä»¬ä»¥ä¸éä¸“é—¨åŒ–æ¨¡æ¿ç›¸åŒçš„æ–¹å¼æ“ä½œï¼Œé™¤éå‚æ•°æ˜¯set_valueå’Œset_value_thread_exitæˆå‘˜å‡½æ•°ï¼›
<br> â— std::promiseå…è®¸moveè¯­ä¹‰(å³å€¼æ„é€ ï¼Œå³å€¼èµ‹å€¼)ï¼Œä½†ä¸å…è®¸æ‹·è´(æ‹·è´æ„é€ ã€èµ‹å€¼)ï¼Œstd::futureäº¦ç„¶ï¼›
<br> â— std::promiseå’Œstd::futureåˆä½œå…±åŒå®ç°äº†å¤šçº¿ç¨‹é—´é€šä¿¡ã€‚
<br>
<br> ğŸ“ ç¼–ç¨‹ç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;functional&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;mutex&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;future&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;print_int(future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&amp;&nbsp;fut)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x&nbsp;=&nbsp;fut.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;value:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;x&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;promise&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;prom;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;fut&nbsp;=&nbsp;prom.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;th1(print_int,&nbsp;ref(fut));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;ref&nbsp;ç”¨äºåŒ…è£…æŒ‰å¼•ç”¨ä¼ é€’çš„å€¼ï¼Œcref&nbsp;ç”¨äºåŒ…è£…æŒ‰constä¼ é€’çš„å€¼<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;this_thread::sleep_for(chrono::milliseconds(5000));<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;prom.set_value(</span><span style="color:#ff0000;">10</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;th1.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}<BR>
</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼švalue:&nbsp;10</span></div></td></tr></table></div>
 â—  ä¸std::promiseå…³è”çš„std::futureæ˜¯é€šè¿‡std::promise::get_futureè·å–åˆ°çš„ï¼Œè‡ªå·±æ„é€ å‡ºæ¥çš„æ— æ•ˆï¼›
<br> â—  ä¸€ä¸ªstd::promiseå®ä¾‹åªèƒ½ä¸ä¸€ä¸ªstd::futureå…³è”å…±äº«çŠ¶æ€ï¼Œå½“åœ¨åŒä¸€ä¸ªstd::promiseä¸Šåå¤è°ƒç”¨get_futureä¼šæŠ›å‡ºfuture_errorå¼‚å¸¸
<br> â— å…±äº«çŠ¶æ€ï¼šåœ¨std::promiseæ„é€ æ—¶ï¼Œstd::promiseå¯¹è±¡ä¼šä¸å…±äº«çŠ¶æ€å…³è”èµ·æ¥ï¼Œè¿™ä¸ªå…±äº«çŠ¶æ€å¯ä»¥å­˜å‚¨ä¸€ä¸ªTç±»å‹çš„å€¼æˆ–è€…ä¸€ä¸ªç”±std::exceptionæ´¾ç”Ÿå‡ºæ¥çš„å¼‚å¸¸å€¼ï¼Œé€šè¿‡std::promise::get_futureè°ƒç”¨è·å¾—çš„std::futureä¸std::promiseå…±äº«ç›¸åŒçš„å…±äº«çŠ¶æ€
<br> â— å¦‚æœpromiseç›´åˆ°é”€æ¯æ—¶ï¼Œéƒ½æœªè®¾ç½®è¿‡ä»»ä½•å€¼ï¼Œåˆ™promiseä¼šåœ¨ææ„æ—¶è‡ªåŠ¨è®¾ç½®ä¸ºstd::future_errorï¼Œè¿™ä¼šé€ æˆstd::future.getæŠ›å‡ºstd::future_errorå¼‚å¸¸
<br> â— é€šè¿‡std::promise::set_exceptionå‡½æ•°å¯ä»¥è®¾ç½®è‡ªå®šä¹‰å¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸æœ€ç»ˆä¼šè¢«ä¼ é€’åˆ°std::futureï¼Œå¹¶åœ¨å…¶getå‡½æ•°ä¸­è¢«æŠ›å‡º
<br>std::promiseè™½ç„¶æ”¯æŒè‡ªå®šä¹‰å¼‚å¸¸ï¼Œä½†å®ƒå¹¶ä¸ç›´æ¥æ¥å—å¼‚å¸¸å¯¹è±¡ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void set_exception(std::exception_ptr p);
<br> è‡ªå®šä¹‰å¼‚å¸¸å¯ä»¥é€šè¿‡ä½äºå¤´æ–‡ä»¶exceptionä¸‹çš„std::make_exception_ptrå‡½æ•°è½¬åŒ–ä¸ºstd::exception_ptr
<br>
<br><font color=blue size = 5>Member functions</font>
<br>
<br><font color=purple size = 4>(constructor)æ„é€ å‡½æ•°</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">default</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;promise();<BR>
with&nbsp;allocator&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Alloc&gt;&nbsp;promise&nbsp;(allocator_arg_t&nbsp;aa,<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;Alloc&nbsp;&amp;alloc);<BR>
copy&nbsp;[deleted]&nbsp;(</span><span style="color:#ff0000;">3</span><span style="color:#000000;">)&nbsp;&nbsp;promise&nbsp;(</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;promise&nbsp;&amp;)&nbsp;=&nbsp;</span><span style="color:#0000ff;">delete</span><span style="color:#000000;">;<BR>
move&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">4</span><span style="color:#000000;">)&nbsp;&nbsp;promise&nbsp;(promise&nbsp;&amp;&amp;x)&nbsp;noexcept;</span></div></td></tr></table></div>
(1)é»˜è®¤æ„é€ å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯¹è±¡è¢«åˆå§‹åŒ–ï¼Œä»¥è®¿é—®ä¸€ä¸ªæ–°çš„ç©ºå…±äº«çŠ¶æ€
<br>(2)æ„é€ å™¨å’Œåˆ†é…å™¨
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸(1)ç›¸åŒï¼Œä½†æ˜¯ä½¿ç”¨allocä¸ºå…±äº«çŠ¶æ€åˆ†é…å†…å­˜
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aaï¼š std::allocator_argä»·å€¼ã€‚è¿™ä¸ªå¸¸é‡å€¼åªæ˜¯ç”¨äºæ˜¾å¼åœ°é€‰æ‹©è¿™ä¸ªæ„é€ å‡½æ•°é‡è½½
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allocï¼šåˆ†é…å™¨å¯¹è±¡ã€‚å®¹å™¨ä¿å­˜å¹¶ä½¿ç”¨è¿™ä¸ªåˆ†é…å™¨çš„å†…éƒ¨å‰¯æœ¬ï¼Œå¹¶ä½¿ç”¨å®ƒä¸ºå…±äº«çŠ¶æ€åˆ†é…å­˜å‚¨
<br>(3)æ‹·è´æ„é€ å‡½æ•° (åˆ é™¤)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promiseå¯¹è±¡ä¸èƒ½è¢«å¤åˆ¶
<br>(4)ç§»åŠ¨æ„é€ å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ„é€ çš„å¯¹è±¡è·å¾—xçš„å…±äº«çŠ¶æ€(å¦‚æœæœ‰çš„è¯)ã€‚xæ˜¯æ²¡æœ‰å…±äº«çŠ¶æ€çš„ï¼ŒåŒä¸€ç±»å‹çš„å¦ä¸€ä¸ªpromiseå¯¹è±¡(å…·æœ‰ç›¸åŒçš„æ¨¡æ¿å‚æ•°T)
<br>(5)std::promise<void>æ˜¯åˆæ³•çš„ï¼Œæ­¤æ—¶std::promise.set_valueä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œä»…ç”¨äºé€šçŸ¥å…³è”çš„std::future.get()è§£é™¤é˜»å¡
<br> â— å‡½æ•°æ‰§è¡Œå¼‚å¸¸æƒ…å†µï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¼ºä¿è¯ï¼šåœ¨æŠ›å‡ºå¼‚å¸¸æ—¶æ²¡æœ‰ä»»ä½•æ•ˆæœ
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ ¹æ®åº“çš„å®ç°ï¼Œæˆå‘˜å‡½æ•°å¯èƒ½ä¼šåœ¨æŸäº›æ¡ä»¶(ä¾‹å¦‚bad_alloc)ä¸ŠæŠ›å‡ºå¼‚å¸¸(ä¾‹å¦‚åœ¨æ²¡æœ‰åˆ†é…å†…å­˜çš„æƒ…å†µä¸‹)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç§»åŠ¨æ„é€ å‡½æ•°(4)ä»ä¸æŠ›å‡ºå¼‚å¸¸(æ— æŠ›å‡ºä¿è¯)
<br>
<br><font color=purple size = 4>(destructor)ææ„å‡½æ•°</font>
<br> â— ææ„promise
<br> â— æ”¾å¼ƒå…±äº«çŠ¶æ€ï¼Œå¹¶ç ´åpromiseå¯¹è±¡
<br>æ³¨ï¼š
<br> â— å¦‚æœå…¶å®ƒfutureå¯¹è±¡ä¸ç›¸åŒçš„å…±äº«çŠ¶æ€ç›¸å…³è”ï¼Œå…±äº«çŠ¶æ€æœ¬èº«ä¸ä¼šè¢«ç ´åï¼Œç›´åˆ°æ‰€æœ‰è¿™äº›å¯¹è±¡ä¹Ÿé‡Šæ”¾å®ƒï¼›
<br> â— å¦‚æœå¯¹è±¡åœ¨å®ƒçš„å…±äº«çŠ¶æ€é€šè¿‡æ˜¾å¼è®¾ç½®å€¼æˆ–å¼•ç”¨ä¹‹å‰è¢«é”€æ¯ï¼Œé‚£ä¹ˆå…±äº«çŠ¶æ€å°†è‡ªåŠ¨ä¸ºåŒ…å«future_errorç±»å‹çš„å¼‚å¸¸åšå¥½å‡†å¤‡(æœ‰æ•…éšœæ—¶çš„é”™è¯¯æ¡ä»¶)ã€‚
<br>
<br><font color=purple size = 4>std::promise::operator=</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;move (1) promise&amp; operator= (promise&amp;&amp; rhs) noexcept;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy [deleted] (2) promise&amp; operator= (const promise&amp;) = delete;
<br> â— Move-assignæ‰¿è¯ºï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦‚æœæœ‰å…±äº«çŠ¶æ€ï¼Œè·å¾—rhsçš„å…±äº«çŠ¶æ€
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è°ƒç”¨ä¹‹å‰çš„å¯¹è±¡ç›¸å…³è”çš„å…±äº«çŠ¶æ€
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rhsï¼šæ²¡æœ‰å…±äº«çŠ¶æ€ï¼šä»»ä½•å½±å“å…¶å…±äº«çŠ¶æ€çš„æ“ä½œéƒ½å°†æŠ›å‡ºfuture_errorå’Œno_statusé”™è¯¯æ¡ä»¶
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promiseå¯¹è±¡ä¸èƒ½æ‹·è´
<br>
<br><font color=purple size = 4>std::promise::get_future</font>
<br> â— å®šä¹‰ï¼šfuture<T> get_future();
<br> â— å¾—åˆ°futureå¯¹è±¡
<br> â— è¿”å›å…³è”ç€å…±äº«çŠ¶æ€çš„futureå¯¹è±¡
<br> â— è¿”å›çš„futureå¯¹è±¡å¯ä»¥é€šè¿‡promiseå¯¹è±¡åœ¨å‡†å¤‡å°±ç»ªæ—¶è®¿é—®å…±äº«çŠ¶æ€çš„å€¼æˆ–å¼‚å¸¸
<br> â— æ¯ä¸ªpromiseå…±äº«çŠ¶æ€åªèƒ½æ£€ç´¢åˆ°ä¸€ä¸ªfutureå¯¹è±¡
<br> â— åœ¨è°ƒç”¨æ­¤å‡½æ•°ä¹‹åï¼Œé¢„æœŸå°†åœ¨æŸä¸ªç‚¹é€šè¿‡è®¾ç½®å€¼æˆ–å¼‚å¸¸ä½¿å…¶å…±äº«çŠ¶æ€å°±ç»ªï¼Œå¦åˆ™å®ƒå°†è‡ªåŠ¨ä¸ºé”€æ¯æ‰€å‡†å¤‡å°±ç»ªï¼ŒåŒ…å«äº†future_errorç±»å‹çš„å¼‚å¸¸
<br>
<br><font color=purple size = 4>std::promise::set_value</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;generic template(1) void set_value (const T&amp; val);
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void set_value (T&amp;&amp; val);
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specializations(2) void promise<R&>::set_value (R&amp; val); //when T is a reference type(R&amp;)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void promise<void>::set_value (void); //when T is void
<br> â— å­˜å‚¨valä½œä¸ºå…±äº«çŠ¶æ€çš„å€¼ï¼Œå®ƒå·²ç»å‡†å¤‡å¥½äº†
<br> â— å¦‚æœä¸€ä¸ªä¸ç›¸åŒå…±äº«çŠ¶æ€ç›¸å…³è”çš„futureå¯¹è±¡æ­£åœ¨ç­‰å¾…å¯¹futureçš„è°ƒç”¨::getï¼Œå®ƒå°†æ‰“å¼€å¹¶è¿”å›val
<br> â— voidä¸“é—¨åŒ–çš„æˆå‘˜åªæ˜¯ä½¿å…±äº«çŠ¶æ€å°±ç»ªï¼Œæ²¡æœ‰è®¾ç½®ä»»ä½•å€¼
<br>
<br><font color=purple size = 4>std::promise::set_exception</font>
<br> ğŸ¨ å®šä¹‰ï¼švoid set_exception (exception_ptr p);
<br> â— è®¾ç½®å¼‚å¸¸
<br> â— ä½¿å‡†å¤‡çŠ¶æ€çš„å…±äº«çŠ¶æ€ä¸­å­˜å‚¨å¼‚å¸¸æŒ‡é’ˆp
<br> â— å¦‚æœä¸åŒä¸€å…±äº«çŠ¶æ€ç›¸å…³è”çš„futureå¯¹è±¡åœ¨å½“å‰æ­£åœ¨ç­‰å¾…future::getï¼Œå®ƒå°†æŠ›å‡ºå¼‚å¸¸å¯¹è±¡
<br> â— æ­¤æˆå‘˜å‡½æ•°ä¼šåœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹æŠ›å‡ºå¼‚å¸¸ï¼Œæ ¹æ®åº“çš„å®ç°ï¼Œä¹Ÿå¯èƒ½ä¼šåœ¨å…¶å®ƒæƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸
<table border="2">
<tr>
<th>å¼‚å¸¸ç±»å‹</th>
<th>é”™è¯¯æ¡ä»¶</th>
<th>æè¿°</th>
</tr>
<tr>
<td>future_error</td>
<td>future_errc::no_state</td>
<td>å¯¹è±¡æ²¡æœ‰å…±äº«çŠ¶æ€(å·²è¢«ç§»åŠ¨)</td>
</tr>
<tr>
<td>future_error</td>
<td>future_errc::promise_already_satisfied</td>
<td>åœ¨å…±äº«çŠ¶æ€å·²ç»å…·æœ‰å­˜å‚¨çš„å€¼æˆ–å¼‚å¸¸</td>
</tr>
</table>
<br><font color=purple size = 4>std::promise::set_value_at_thread_exit</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;generic template (1) void set_value_at_thread_exit (const T&amp; val);
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void set_value_at_thread_exit (T&amp;&amp; val);
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specializations (2) void promise<R&>::set_value_at_thread_exit (R&amp; val);
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// when T is a reference type (R&amp;)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void promise<void>::set_value_at_thread_exit (void); // when T is void
<br> â— å½“çº¿ç¨‹é€€å‡ºæ—¶è®¾ç½®å€¼
<br> â— å­˜å‚¨valä½œä¸ºå…±äº«çŠ¶æ€çš„å€¼ï¼Œè€Œä¸ç«‹å³å‡†å¤‡ã€‚ç›¸åï¼Œå®ƒå°†åœ¨çº¿ç¨‹é€€å‡ºæ—¶è‡ªåŠ¨å®Œæˆï¼Œå› ä¸ºæ‰€æœ‰çº¿ç¨‹å­˜å‚¨æ—¶é—´çš„å¯¹è±¡éƒ½è¢«é”€æ¯äº†
<br> â— å¦‚æœä¸åŒä¸€å…±äº«çŠ¶æ€ç›¸å…³è”çš„futureå¯¹è±¡åœ¨å½“å‰æ­£åœ¨ç­‰å¾…è°ƒç”¨futureï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°çº¿ç¨‹ç»“æŸï¼Œä¸€æ—¦çº¿ç¨‹ç»“æŸï¼Œå®ƒå°†æ‰“å¼€å¹¶è¿”å›val
<br>æ³¨ï¼š
<br> â— è°ƒç”¨æ­¤å‡½æ•°å·²ç»è®¾ç½®äº†å…±äº«çŠ¶æ€çš„å€¼ï¼Œå¹¶ä¸”ä»»ä½•å°è¯•åœ¨æ­¤è°ƒç”¨å’Œçº¿ç¨‹æœ«å°¾ä¿®æ”¹æ­¤å€¼çš„è°ƒç”¨éƒ½å°†æŠ›å‡ºfuture_errorä¸promise_already_satisfiedä½œä¸ºé”™è¯¯æ¡ä»¶
<br> â— æ­¤æˆå‘˜å‡½æ•°åœ¨ä»¥ä¸‹æ¡ä»¶æŠ›å‡ºå¼‚å¸¸ï¼š
<table border="2">
<tr>
<th>å¼‚å¸¸ç±»å‹</th>
<th>é”™è¯¯æ¡ä»¶</th>
<th>æè¿°</th>
</tr>
<tr>
<td>future_error</td>
<td>future_errc::no_state</td>
<td>å¯¹è±¡æ²¡æœ‰å…±äº«çŠ¶æ€(å·²è¢«ç§»åŠ¨)</td>
</tr>
<tr>
<td>future_error</td>
<td>future_errc::promise_already_satisfied</td>
<td>åœ¨å…±äº«çŠ¶æ€å·²ç»å…·æœ‰å­˜å‚¨çš„å€¼æˆ–å¼‚å¸¸</td>
</tr>
</table>
<br><font color=purple size = 4>std::promise::set_value_at_thread_exit</font>
<br> ğŸ¨ å®šä¹‰ï¼švoid set_exception_at_thread_exit (exception_ptr p);
<br> â— åœ¨çº¿ç¨‹é€€å‡ºæ—¶è®¾ç½®å¼‚å¸¸
<br> â— åœ¨å…±äº«çŠ¶æ€ä¸­å­˜å‚¨å¼‚å¸¸æŒ‡é’ˆï¼Œè€Œä¸ç«‹å³å‡†å¤‡ã€‚ç›¸åï¼Œå®ƒå°†åœ¨çº¿ç¨‹é€€å‡ºæ—¶è‡ªåŠ¨å®Œæˆï¼Œå› ä¸ºæ‰€æœ‰çº¿ç¨‹å­˜å‚¨æ—¶é—´çš„å¯¹è±¡éƒ½è¢«é”€æ¯äº†
<br> â— å¦‚æœä¸åŒä¸€å…±äº«çŠ¶æ€ç›¸å…³è”çš„futureå¯¹è±¡æ­£åœ¨ç­‰å¾…è°ƒç”¨future:getï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°çº¿ç¨‹ç»“æŸã€‚ä¸€æ—¦çº¿ç¨‹ç»“æŸï¼Œå®ƒå°±ä¼šæŠ›å‡ºå¼‚å¸¸å¯¹è±¡p
<br>æ³¨ï¼š
<br> â— è°ƒç”¨è¿™ä¸ªå‡½æ•°å·²ç»åœ¨å…±äº«çŠ¶æ€ä¸­è®¾ç½®äº†ä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªè°ƒç”¨å’Œçº¿ç¨‹ç»“æŸä¹‹é—´ä¿®æ”¹è¿™ä¸ªå€¼çš„ä»»ä½•è°ƒç”¨éƒ½ä¼šå°†æŠ›å‡ºfuture_errorä¸promise_already_satisfiedé”™è¯¯æ¡ä»¶
<br> â— æ­¤æˆå‘˜å‡½æ•°åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹æŠ›å‡ºå¼‚å¸¸ï¼š
<table border="2">
<tr>
<th>å¼‚å¸¸ç±»å‹</th>
<th>é”™è¯¯æ¡ä»¶</th>
<th>æè¿°</th>
</tr>
<tr>
<td>future_error</td>
<td>future_errc::no_state</td>
<td>å¯¹è±¡æ²¡æœ‰å…±äº«çŠ¶æ€(å·²è¢«ç§»åŠ¨)</td>
</tr>
<tr>
<td>future_error</td>
<td>future_errc::promise_already_satisfied</td>
<td>åœ¨å…±äº«çŠ¶æ€å·²ç»å…·æœ‰å­˜å‚¨çš„å€¼æˆ–å¼‚å¸¸</td>
</tr>
</table>
<br><font color=purple size = 4>std::promise::swap</font>
<br> ğŸ¨ å®šä¹‰ï¼švoid swap (promise&amp; x) noexcept;
<br> â— ä¸xäº¤æ¢å…±äº«çŠ¶æ€
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br>79<br>80<br>81<br>82<br>83<br>84<br>85<br>86<br>87<br>88<br>89<br>90<br>91<br>92<br>93<br>94<br>95<br>96<br>97<br>98<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;functional&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;chrono&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;mutex&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;future&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
promise&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;prom;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;print_string(future&lt;string&gt;&amp;&nbsp;fut)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;str&nbsp;=&nbsp;fut.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;string&nbsp;value:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;str&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;print_global_promise()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;fut&nbsp;=&nbsp;prom.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x&nbsp;=&nbsp;fut.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;global_promise&nbsp;value:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;x&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;get_int(promise&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&amp;&nbsp;proi)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Please,&nbsp;enter&nbsp;an&nbsp;integer&nbsp;value:&nbsp;&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cin.exceptions(ios::failbit);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">try</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cin&nbsp;&gt;&gt;&nbsp;x;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proi.set_value(x);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">catch</span><span style="color:#000000;">(exception&amp;)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proi.set_exception(current_exception());<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;print_int(future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&amp;&nbsp;fut)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">try</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x&nbsp;=&nbsp;fut.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;integer&nbsp;value:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;x&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">catch</span><span style="color:#000000;">&nbsp;(exception&nbsp;&amp;&nbsp;e)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;[exception&nbsp;caught:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;e.what()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;]\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;æ„é€ å‡½æ•°(2)ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;promise&lt;string&gt;&nbsp;foo;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;promise&lt;string&gt;&nbsp;bar&nbsp;=&nbsp;promise&lt;string&gt;(allocator_arg,&nbsp;allocator&lt;string&gt;());<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;string&gt;&nbsp;fut&nbsp;=&nbsp;bar.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;th0(print_string,&nbsp;ref(fut));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;this_thread::sleep_for(chrono::seconds(1));<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;bar.set_value(</span><span style="color:#800000;">&quot;Hello&nbsp;thread!&quot;</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;th0.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼šstring&nbsp;value:&nbsp;Hello&nbsp;thread!<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;promise::operator=/get_future()/set_value()&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;th1(print_global_promise);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;prom.set_value(</span><span style="color:#ff0000;">10</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;th1.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;prom&nbsp;=&nbsp;promise&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;th2(print_global_promise);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;prom.set_value(</span><span style="color:#ff0000;">20</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;th2.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼šglobal_promise&nbsp;value:&nbsp;10\n&nbsp;global_promise&nbsp;value&nbsp;:&nbsp;20<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;promise::set_exception&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;promise&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;proi;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;fur&nbsp;=&nbsp;proi.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;th3(print_int,&nbsp;ref(fur));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;th4(get_int,&nbsp;ref(proi));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;th3.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;th4.join();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//promise::set_value_at_thread_exit&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;promise&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;p;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;f&nbsp;=&nbsp;p.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread([&amp;p]<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this_thread::sleep_for(chrono::seconds(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.set_value_at_thread_exit(</span><span style="color:#ff0000;">9</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}).detach();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Waiting&nbsp;...&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;flush;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;f.wait();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Done!\nResult&nbsp;is:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;f.get()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;ç»“æœ&nbsp;f.get()&nbsp;ä¸º&nbsp;9<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br><font color=blue size = 5>Non-member function overloads</font>
<br>
<br><font color=purple size = 4>std::swap(promise)</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template <class T>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void swap (promise<T>&amp; x, promise<T>&amp; y) noexcept;
<br> â— äº¤æ¢xå’Œyä¹‹é—´çš„å…±äº«çŠ¶æ€ï¼Œç±»ä¼¼äºé‡è½½çš„äº¤æ¢ï¼Œå°±åƒx.swap(y)
<br>
<br><font color=blue size = 5>Non-member class specializations</font>
<br>
<br><font color=purple size = 4>std::uses_allocator<promise></font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template <class T, class Alloc>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct uses_allocator<promise<T>,Alloc&gt;;
<br> â— ä¸ºä¿è¯ä½¿ç”¨åˆ†é…å™¨uses_allocatorçš„è¿™ç§ç‰¹æ€§ä¸“é—¨åŒ–é€šçŸ¥promiseå¯¹è±¡å¯ä»¥ç”¨é…ç½®å™¨æ„å»ºï¼Œå³ä½¿ç±»æ²¡æœ‰ä»»ä½•allocator_typeæˆå‘˜ã€‚å®ƒåœ¨&lt; future &gt;ä¸­å®šä¹‰ï¼Œä¸ç›¸åŒçš„è¡Œä¸ºå¦‚ä¸‹ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template <class T, class Alloc>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct uses_allocator<promise<T>,Alloc&gt; : true_type {};
<br>&nbsp;&nbsp;&nbsp;std::uses_allocatorå®šä¹‰å¦‚ä¸‹ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template <class T, class Alloc> struct uses_allocator;
<br> â— Uses allocatorï¼š integral_constant â† uses_allocator
<br> â— è¯†åˆ«Tæ˜¯å¦æ¥å—æ¥è‡ªAllocçš„åˆ†é…å™¨å¯è½¬æ¢çš„ç‰¹æ€§ç±»
<br> â— å®ƒä» integral_constantç»§æ‰¿ä¸ºtrue_typeæˆ–false_typeï¼Œè¿™å–å†³äºTæ˜¯å¦æ¥å—è¿™æ ·çš„åˆ†é…å™¨
<br> â— ä¸å¡«å†™è¿™ä¸€è¦æ±‚ä½†ä»ç„¶ä½¿ç”¨åˆ†é…å™¨çš„ç±»å°†ä¸“é—¨åŒ–è¯¥æ¨¡æ¿ï¼Œä»¥ä»true_typeæ´¾ç”Ÿå‡ºï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ„é€ å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æœ‰ç±»å‹Alloc
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æœ‰ç±»å‹allocator_arg_tï¼Œç¬¬äºŒä¸ªå‚æ•°æœ‰ç±»å‹Alloc
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;memory&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;vector&gt;<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">typedef</span><span style="color:#000000;">&nbsp;std::vector&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;Container;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">typedef</span><span style="color:#000000;">&nbsp;std::allocator&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;Allocator;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(std::uses_allocator&lt;Container,&nbsp;Allocator&gt;::value)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Allocator&nbsp;alloc;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Container&nbsp;foo&nbsp;(</span><span style="color:#ff0000;">5</span><span style="color:#000000;">,&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">,&nbsp;alloc);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;x&nbsp;:&nbsp;foo)&nbsp;std::cout&nbsp;&lt;&lt;&nbsp;x&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">'&nbsp;'</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;std::cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">'\n'</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br><a name="bc2"><font color=green size = 5>packaged_task</font></a>
<br> â— std::packaged_taskä½äºå¤´æ–‡ä»¶#include&lt;future&gt;ä¸­ï¼Œæ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»
<br> â— spackaged_taskå°è£…å¯è°ƒç”¨çš„å…ƒç´ ï¼Œå¹¶å…è®¸å¼‚æ­¥æ£€ç´¢å…¶ç»“æœ
<br> â— å®ƒç±»ä¼¼äºstd::functionï¼Œä½†æ˜¯å°†å…¶ç»“æœè‡ªåŠ¨ä¼ è¾“åˆ°ä¸€ä¸ªfutureå¯¹è±¡
<br> â— å¯¹è±¡åŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.ä¸€ä¸ªå­˜å‚¨çš„ä»»åŠ¡ï¼Œå®ƒæ˜¯ä¸€äº›å¯è°ƒç”¨çš„å¯¹è±¡(ä¾‹å¦‚å‡½æ•°æŒ‡é’ˆã€æŒ‡å‘æˆå‘˜æˆ–å‡½æ•°å¯¹è±¡çš„æŒ‡é’ˆ)ï¼Œå…¶è°ƒç”¨ç­¾åå°†åœ¨Argsä¸­è¿›è¡Œç±»å‹çš„ä¼ å‚ï¼Œè¿”å›ä¸€ä¸ªç±»å‹ä¸ºRetçš„å€¼
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.ä¸€ä¸ªå…±äº«çŠ¶æ€ï¼Œå®ƒå¯ä»¥å­˜å‚¨è°ƒç”¨ä»»åŠ¡(ç±»å‹ä¸ºRet)çš„ç»“æœï¼Œå¹¶é€šè¿‡æœªæ¥å¼‚æ­¥è®¿é—®
<br> â— å…±äº«çŠ¶æ€å¯ä»¥é€šè¿‡è°ƒç”¨æˆå‘˜get_futureå…³è”åˆ°ä¸€ä¸ªfutureå¯¹è±¡ã€‚è°ƒç”¨åï¼Œä¸¤ä¸ªå¯¹è±¡å…±äº«ç›¸åŒçš„å…±äº«çŠ¶æ€ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.packaged_taskå¯¹è±¡æ˜¯å¼‚æ­¥æä¾›ç¨‹åºï¼Œå¹¶æœŸæœ›é€šè¿‡è°ƒç”¨å­˜å‚¨ä»»åŠ¡åœ¨æŸä¸ªç‚¹ä¸Šè®¾ç½®å…±äº«çŠ¶æ€
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.futureå¯¹è±¡æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿”å›å¯¹è±¡ï¼Œå¯ä»¥æ£€ç´¢å…±äº«çŠ¶æ€çš„å€¼ï¼Œç­‰å¾…å®ƒåœ¨å¿…è¦æ—¶å°±ç»ª
<br> â— å…±äº«çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸè‡³å°‘æŒç»­åˆ°æœ€åä¸€ä¸ªå¯¹è±¡é‡Šæ”¾å®ƒæˆ–è¢«é”€æ¯ã€‚å› æ­¤ï¼Œå®ƒå¯ä»¥åœ¨packaged_taskå¯¹è±¡ä¸­ç”Ÿå­˜ï¼Œè¯¥å¯¹è±¡åœ¨ä¸å°†æ¥ç›¸å…³è”çš„æƒ…å†µä¸‹ï¼Œé¦–å…ˆè·å¾—å®ƒ
<br> â— åˆ¤æ–­ä¸€ä¸ªstd::packaged_taskæ˜¯å¦å¯ä½¿ç”¨ï¼Œå¯é€šè¿‡å…¶æˆå‘˜å‡½æ•°validæ¥åˆ¤æ–­
<br>
<br><font color=blue size = 5>Member functions</font>
<br>
<br><font color=purple size = 4>(constructor)æ„é€ å‡½æ•°</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">default</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;packaged_task()&nbsp;noexcept;<BR>
initialization&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Fn&gt;<BR>
</span><span style="color:#0000ff;">explicit</span><span style="color:#000000;">&nbsp;packaged_task&nbsp;(Fn&nbsp;&amp;&amp;fn);<BR>
with&nbsp;allocator&nbsp;(</span><span style="color:#ff0000;">3</span><span style="color:#000000;">)&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Fn,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Alloc&gt;<BR>
</span><span style="color:#0000ff;">explicit</span><span style="color:#000000;">&nbsp;packaged_task&nbsp;(allocator_arg_t&nbsp;aa,&nbsp;</span><span style="color:#0000ff;">const</span><span style="color:#000000;">&nbsp;Alloc&nbsp;&amp;alloc,&nbsp;Fn&nbsp;&amp;&amp;fn);<BR>
copy&nbsp;[deleted]&nbsp;(</span><span style="color:#ff0000;">4</span><span style="color:#000000;">)&nbsp;packaged_task&nbsp;(packaged_task&nbsp;&amp;)&nbsp;=&nbsp;</span><span style="color:#0000ff;">delete</span><span style="color:#000000;">;<BR>
move&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">5</span><span style="color:#000000;">)&nbsp;packaged_task&nbsp;(packaged_task&nbsp;&amp;&amp;x)&nbsp;noexcept;</span></div></td></tr></table></div>
<br>(1)é»˜è®¤æ„é€ å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯¹è±¡è¢«åˆå§‹åŒ–ï¼Œæ²¡æœ‰å…±äº«çŠ¶æ€ï¼Œä¹Ÿæ²¡æœ‰å­˜å‚¨ä»»åŠ¡
<br>(2)åˆå§‹åŒ–æ„é€ å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯¹è±¡è¢«åˆå§‹åŒ–ï¼Œå®ƒçš„å­˜å‚¨ä»»åŠ¡åˆå§‹åŒ–ä¸ºfn
<br>(3)å¸¦æœ‰åˆ†é…å™¨çš„åˆå§‹åŒ–æ„é€ å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸(2)ç›¸åŒï¼Œä½†æ˜¯ä½¿ç”¨allocä¸ºå†…éƒ¨æ•°æ®ç»“æ„åˆ†é…å†…å­˜
<br>(4)æ‹·è´æ„é€ å‡½æ•°(åˆ é™¤)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ— æ³•å¤åˆ¶packaged_taskå¯¹è±¡(åˆ é™¤äº†æ‹·è´æ„é€ å‡½æ•°)
<br>(5)æ„é€ å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ„é€ çš„å¯¹è±¡è·å¾—xçš„å…±äº«çŠ¶æ€ï¼Œå¹¶ä¸”å®ƒçš„å­˜å‚¨ä»»åŠ¡è¢«ç§»åŠ¨ï¼Œæ­¤åï¼Œxæ˜¯æ²¡æœ‰å…±äº«çŠ¶æ€çš„
<br>(6)å‚æ•°ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.fnï¼šä¸€ä¸ªå¯è°ƒç”¨çš„æŒ‡é’ˆï¼ŒæŒ‡å‘å‡½æ•°ã€æŒ‡å‘æˆå‘˜çš„æŒ‡é’ˆæˆ–ä»»ä½•å½¢å¼çš„å¯æ„é€ å‡½æ•°å¯¹è±¡(ä¸€ä¸ªç±»å®šä¹‰æ“ä½œç¬¦çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬é—­åŒ…å’Œå‡½æ•°å¯¹è±¡ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›ç±»å‹å’Œå‚æ•°åº”è¯¥ä¸packaged_taskçš„æ¨¡æ¿å‚æ•°(Retå’ŒArgs)ç›¸å¯¹åº”ï¼Œå­˜å‚¨ä»»åŠ¡è¢«è®¾ç½®ä¸ºfn(å†…éƒ¨åˆå§‹åŒ–ä¸ºstd::forword<fn>(fn)))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.aaï¼šstd::allocator_argï¼Œè¿™ä¸ªå¸¸é‡å€¼åªæ˜¯ç”¨äºæ˜¾å¼åœ°é€‰æ‹©è¿™ä¸ªæ„é€ å‡½æ•°é‡è½½
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.allocï¼šå®¹å™¨ä¸­ä¿å­˜å¹¶ä½¿ç”¨è¿™ä¸ªåˆ†é…å™¨çš„å†…éƒ¨å‰¯æœ¬ï¼Œå¹¶ä½¿ç”¨å®ƒä¸ºå†…éƒ¨æ•°æ®ç»“æ„åˆ†é…å­˜å‚¨
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.xï¼šåŒä¸€ç±»å‹çš„å¦ä¸€ä¸ªpackaged_taskå¯¹è±¡ï¼Œå…·æœ‰ç›¸åŒçš„æ¨¡æ¿å‚æ•°ã€Retå’ŒArgs
<br>
<br><font color=purple size = 4>(destructor)ææ„å‡½æ•°</font>
<br> â— æ”¾å¼ƒå…±äº«çŠ¶æ€(å¦‚æœæœ‰çš„è¯)å¹¶é”€æ¯packaged_taskå¯¹è±¡
<br>æ³¨ï¼š
<br> â— å¦‚æœå…¶ä»–(future)å¯¹è±¡ä¸ç›¸åŒçš„å…±äº«çŠ¶æ€ç›¸å…³è”ï¼Œå…±äº«çŠ¶æ€æœ¬èº«ä¸ä¼šè¢«ç ´å(ç›´åˆ°æ‰€æœ‰è¿™äº›å¯¹è±¡ä¹Ÿé‡Šæ”¾å®ƒ)
<br> â— å¦‚æœå¯¹è±¡åœ¨å·²ç»å‡†å¤‡å¥½(é€šè¿‡è°ƒç”¨å­˜å‚¨ä»»åŠ¡)ä¹‹å‰è¢«é”€æ¯ï¼Œé‚£ä¹ˆå…±äº«çŠ¶æ€å°±ä¼šè‡ªåŠ¨è¢«å‡†å¤‡å¥½ï¼ŒåŒ…å«ä¸€ä¸ªfuture_errorç±»å‹çš„å¼‚å¸¸(æœ‰ä¸€ä¸ªç ´ç¢çš„promiseé”™è¯¯æ¡ä»¶)
<br>
<br><font color=purple size = 4>std::packaged_task::operator=</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;move (1) packaged_task&amp; operator= (packaged_task&amp;&amp; rhs) noexcept;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy [deleted] (2) packaged_task&amp; operator= (const packaged_task&amp;) = delete;
<br> â— è·å¾—rhsçš„å…±äº«çŠ¶æ€å’Œå­˜å‚¨ä»»åŠ¡
<br> â— åœ¨è°ƒç”¨(å¦‚æœæœ‰çš„è¯)ä¹‹å‰ï¼Œè½¬ç§»å¯¹è±¡å…³è”çš„å…±äº«çŠ¶æ€(å¦‚æœæœ‰çš„è¯)(å°±åƒpackaged_taskè¢«é”€æ¯ä¸€æ ·)
<br> â— rhsæ²¡æœ‰å…±äº«çŠ¶æ€ï¼Œä»»ä½•è®¿é—®å…¶å…±äº«çŠ¶æ€çš„æ“ä½œéƒ½å°†æŠ›å‡ºfuture_errorå’Œno_stateé”™è¯¯æ¡ä»¶
<br>
<br><font color=purple size = 4>std::packaged_task::valid</font>
<br> ğŸ¨ å®šä¹‰ï¼šbool valid() const noexcept;
<br> â— æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„å…±äº«çŠ¶æ€
<br> â— è¿”å›packaged_taskå½“å‰æ˜¯å¦ä¸å…±äº«çŠ¶æ€ç›¸å…³è”
<br> â— å¯¹äºé»˜è®¤æ„é€ çš„packaged_taskå¯¹è±¡ï¼Œæ­¤å‡½æ•°å°†è¿”å›false(é™¤éè¢«åˆ†é…æˆ–ä¸æœ‰æ•ˆçš„packaged_taskäº¤æ¢)
<br>
<br><font color=purple size = 4>std::packaged_task::get_future</font>
<br> ğŸ¨ å®šä¹‰ï¼šfuture<Ret> get_future();
<br> â— è¿”å›ä¸å¯¹è±¡çš„å…±äº«çŠ¶æ€ç›¸å…³è”çš„futureå¯¹è±¡
<br> â— ä¸€æ—¦è°ƒç”¨äº†å®ƒçš„å­˜å‚¨ä»»åŠ¡ï¼Œè¿”å›å¯ä»¥é€šè¿‡packaged_taskè®¿é—®å…±äº«çŠ¶æ€ä¸‹çš„å€¼æˆ–å¼‚å¸¸çš„futureå¯¹è±¡
<br> â— æ¯ä¸ªpromiseå…±äº«çŠ¶æ€åªèƒ½æ£€ç´¢åˆ°ä¸€ä¸ªfutureå¯¹è±¡
<br> â— è°ƒç”¨æ­¤å‡½æ•°ä¹‹åï¼Œpackaged_taskå°†åœ¨æŸä¸ªç‚¹(é€šè¿‡è°ƒç”¨å®ƒçš„å­˜å‚¨ä»»åŠ¡)è®¾ç½®å…±äº«çŠ¶æ€ï¼Œå®ƒä¼šè‡ªåŠ¨åœ¨é”€æ¯å‰è€Œå‡†å¤‡å°±ç»ªï¼ŒåŒ…å«ä¸€ä¸ªfuture_errorç±»å‹çš„å¼‚å¸¸(ä¸€ä¸ªpromiseé”™è¯¯æ¡ä»¶)
<br>
<br><font color=purple size = 4>std::packaged_task::operator()</font>
<br> ğŸ¨ å®šä¹‰ï¼švoid operator()(Args... args);
<br> â— è°ƒç”¨å­˜å‚¨ä»»åŠ¡ï¼Œå°†Argsä½œä¸ºå…¶å‚æ•°è½¬å‘
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦‚æœå¯¹å­˜å‚¨ä»»åŠ¡çš„è°ƒç”¨æˆåŠŸå®Œæˆï¼Œå®ƒè¿”å›çš„å€¼(å¦‚æœæœ‰çš„è¯)å­˜å‚¨åœ¨å…±äº«çŠ¶æ€ä¸­
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦‚æœå¯¹å­˜å‚¨ä»»åŠ¡çš„è°ƒç”¨æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™æ•è·å¼‚å¸¸å¹¶å­˜å‚¨åœ¨å…±äº«çŠ¶æ€ä¸­
<br> â— åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå…±äº«çŠ¶æ€éƒ½å·²å‡†å¤‡å¥½(è¿™å°†è§£é™¤å½“å‰ç­‰å¾…å®ƒçš„ä»»ä½•çº¿ç¨‹)
<br> â— å¯ä»¥é€šè¿‡è°ƒç”¨get()æ¥è®¿é—®å…±äº«çŠ¶æ€ï¼Œè¯¥å¯¹è±¡å°†é€šè¿‡ä¹‹å‰è°ƒç”¨æˆå‘˜get_futureè¿”å›çš„å¯¹è±¡è¿›è¡Œè®¿é—®
<br> â— å­˜å‚¨ä»»åŠ¡é€šå¸¸åœ¨æ„é€ ä¸ŠæŒ‡å®šï¼Œè°ƒç”¨çš„æ•ˆæœå–å†³äºå®ƒçš„ç±»å‹ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦‚æœå­˜å‚¨ä»»åŠ¡æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆæˆ–å‡½æ•°å¯¹è±¡ï¼Œåˆ™è°ƒç”¨å®ƒå°†å‚æ•°è½¬å‘ç»™è°ƒç”¨
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦‚æœå­˜å‚¨ä»»åŠ¡æ˜¯ä¸€ä¸ªæŒ‡å‘éé™æ€æˆå‘˜å‡½æ•°çš„æŒ‡é’ˆï¼Œå®ƒè¢«ç§°ä¸ºä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå¯¹è±¡çš„æˆå‘˜(è¿™å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡,å¼•ç”¨,æˆ–è€…ä¸€ä¸ªæŒ‡é’ˆ)ï¼Œå’Œå…¶ä½™å‚æ•°è½¬å‘ä¸ºæˆå‘˜å‡½æ•°ä½œä¸ºå‚æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦‚æœå®ƒæ˜¯æŒ‡å‘éé™æ€æ•°æ®æˆå‘˜çš„æŒ‡é’ˆï¼Œåˆ™åº”è¯¥ç”¨ä¸€ä¸ªå‚æ•°è°ƒç”¨å®ƒï¼Œå¹¶ä¸”åœ¨å…±äº«çŠ¶æ€ä¸­å­˜å‚¨çš„å‡½æ•°å°†å¼•ç”¨å…¶å‚æ•°çš„æˆå‘˜(å‚æ•°å¯èƒ½æ˜¯å¯¹è±¡ã€å¼•ç”¨æˆ–æŒ‡å‘å®ƒçš„æŒ‡é’ˆ)
<br> â— æ­¤æˆå‘˜å‡½æ•°åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹æŠ›å‡ºå¼‚å¸¸ï¼š
<table border="2">
<tr>
<th>å¼‚å¸¸ç±»å‹</th>
<th>é”™è¯¯æ¡ä»¶</th>
<th>æè¿°</th>
</tr>
<td>future_error</td>
<td>future_errc::no_state</td>
<td>å¯¹è±¡æ²¡æœ‰å…±äº«çŠ¶æ€(é»˜è®¤æ„é€ çš„packaged_task)</td>
<tr>
</tr>
<tr>
<td>future_error</td>
<td>future_errc::promise_already_satisfied</td>
<td>å­˜å‚¨çš„ä»»åŠ¡å·²è¢«è°ƒç”¨</td>
</tr>
</table>
<br><font color=purple size = 4>std::packaged_task::make_ready_at_thread_exit</font>
<br> ğŸ¨ å®šä¹‰ï¼švoid make_ready_at_thread_exit (args... args);
<br> â— è°ƒç”¨å­˜å‚¨ä»»åŠ¡å¹¶åœ¨çº¿ç¨‹é€€å‡ºæ—¶å‡†å¤‡å°±ç»ª
<br> â— è°ƒç”¨å­˜å‚¨ä»»åŠ¡ï¼Œå°†argsä½œä¸ºå…¶å‚æ•°è½¬å‘ï¼Œå°±åƒè°ƒç”¨å®ƒçš„operate()æˆå‘˜ä¸€æ ·ï¼Œä½†æ˜¯åœ¨çº¿ç¨‹é€€å‡ºæ—¶ä½¿å…±äº«çŠ¶æ€å°±ç»ªï¼Œè€Œä¸æ˜¯åœ¨è°ƒç”¨å®Œæˆæ—¶ç«‹å³æ‰§è¡Œ
<br> â— å¦‚æœä¸åŒä¸€å…±äº«çŠ¶æ€ç›¸å…³è”çš„futureå¯¹è±¡æ­£åœ¨ç­‰å¾…è°ƒç”¨future:getï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°çº¿ç¨‹ç»“æŸã€‚ä¸€æ—¦çº¿ç¨‹ç»“æŸï¼Œå¯¹æœªæ¥çš„è°ƒç”¨::è·å–unblockå’Œè¿”å›æˆ–æŠ›å‡ºå¼‚å¸¸
<br>æ³¨ï¼š
<br> â— è°ƒç”¨æ­¤å‡½æ•°å·²ç»è®¾ç½®äº†å…±äº«çŠ¶æ€çš„å€¼ï¼Œå¹¶ä¸”ä»»ä½•å°è¯•åœ¨æ­¤è°ƒç”¨å’Œçº¿ç¨‹æœ«å°¾ä¿®æ”¹æ­¤å€¼çš„è°ƒç”¨ï¼Œéƒ½ä¼šå°†future_errorä¸promise_already_satisfiedä½œä¸ºé”™è¯¯æ¡ä»¶
<br> â— å‡½æ•°å¼‚å¸¸æƒ…å†µåŒä¸Š
<br>
<br><font color=purple size = 4>std::packaged_task::reset</font>
<br> â— åœ¨ä¿ç•™ç›¸åŒçš„å­˜å‚¨ä»»åŠ¡æ—¶ï¼Œé‡æ–°è®¾ç½®å…·æœ‰æ–°å…±äº«çŠ¶æ€çš„å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥å†æ¬¡è°ƒç”¨å­˜å‚¨çš„ä»»åŠ¡
<br> â— åœ¨è°ƒç”¨(å¦‚æœæœ‰çš„è¯)å­˜å‚¨ä»»åŠ¡ä¹‹å‰ï¼Œä¸å¯¹è±¡å…³è”çš„å…±äº«çŠ¶æ€(å¦‚æœæœ‰çš„è¯)(å°±åƒpackaged_taskè¢«é”€æ¯ä¸€æ ·)
<br> â— åœ¨å†…éƒ¨ï¼Œè¯¥å‡½æ•°çš„è¡Œä¸ºå°±å¥½åƒæ˜¯å¯¹æ–°æ„é€ çš„packaged_task(ä»¥åŠå®ƒçš„å­˜å‚¨ä»»åŠ¡)è¿›è¡Œäº†åˆ†é…
<br>
<br><font color=purple size = 4>std::packaged_task::swap</font>
<br> ğŸ¨ å®šä¹‰ï¼švoid swap (packaged_task&amp; x) noexcept;
<br> â— ä¸xäº¤æ¢å…±äº«çŠ¶æ€å’Œå­˜å‚¨ä»»åŠ¡
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br>79<br>80<br>81<br>82<br>83<br>84<br>85<br>86<br>87<br>88<br>89<br>90<br>91<br>92<br>93<br>94<br>95<br>96<br>97<br>98<br>99<br>100<br>101<br>102<br>103<br>104<br>105<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;utility&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;chrono&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;mutex&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;future&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;countdown(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;from,&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;to)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;from;&nbsp;i&nbsp;!=&nbsp;to;&nbsp;--i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;i&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this_thread::sleep_for(chrono::milliseconds(</span><span style="color:#ff0000;">10</span><span style="color:#000000;">));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Lift&nbsp;off!\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;from&nbsp;-&nbsp;to;<BR>
}<BR>
<BR>
future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;launcher(packaged_task&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">)&gt;&amp;&nbsp;tsk,&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;arg)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(tsk.valid())<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;ret&nbsp;=&nbsp;tsk.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thread(move(tsk),&nbsp;arg).detach();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;ret;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">else</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;not&nbsp;valid.\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;worker(future&lt;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&gt;&amp;&nbsp;output)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;packaged_task&lt;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">(</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&amp;)&gt;&nbsp;my_task{&nbsp;[](</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&amp;&nbsp;done)&nbsp;{&nbsp;done&nbsp;=&nbsp;</span><span style="color:#0000ff;">true</span><span style="color:#000000;">;&nbsp;}&nbsp;};<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;result&nbsp;=&nbsp;my_task.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;done&nbsp;=&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;execute&nbsp;task&nbsp;right&nbsp;away<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;my_task.make_ready_at_thread_exit(done);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;worker:&nbsp;done&nbsp;=&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;boolalpha&nbsp;&lt;&lt;&nbsp;done&nbsp;&lt;&lt;&nbsp;endl;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;status&nbsp;=&nbsp;result.wait_for(chrono::seconds(</span><span style="color:#ff0000;">0</span><span style="color:#000000;">));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(status&nbsp;==&nbsp;future_status::timeout)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;worker:&nbsp;result&nbsp;is&nbsp;not&nbsp;ready&nbsp;yet&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;endl;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;=&nbsp;move(result);<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;triple(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x)&nbsp;{&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;x&nbsp;*&nbsp;</span><span style="color:#ff0000;">3</span><span style="color:#000000;">;&nbsp;}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;packaged_task&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">,&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">)&gt;&nbsp;tsk(countdown);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;ret&nbsp;=&nbsp;tsk.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;th0(move(tsk),&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">,&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;value&nbsp;=&nbsp;ret.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;The&nbsp;countdown&nbsp;lasted&nbsp;for&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;value&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;&nbsp;seconds.\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;th0.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼š10~1&nbsp;The&nbsp;countdown&nbsp;...&nbsp;10&nbsp;seconds.<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;æ„é€ å‡½æ•°&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;packaged_task&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">)&gt;&nbsp;foo;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;packaged_task&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">)&gt;&nbsp;bar([](</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x)&nbsp;{</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;x&nbsp;*&nbsp;</span><span style="color:#ff0000;">2</span><span style="color:#000000;">;&nbsp;});<BR>
&nbsp;&nbsp;&nbsp;&nbsp;foo&nbsp;=&nbsp;move(bar);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;rret&nbsp;=&nbsp;foo.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;future&lt;int&gt;&nbsp;rrret&nbsp;=&nbsp;bar.get_future();<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºbaræ— çŠ¶æ€å’Œå­˜å‚¨å¯¹è±¡ï¼Œå·²ç»è¢«fooæ¥ç®¡<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;thread(move(foo),&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">).detach();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;=&nbsp;rret.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;The&nbsp;double&nbsp;of&nbsp;10&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;value&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;.\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼šThe&nbsp;double&nbsp;of&nbsp;10&nbsp;is&nbsp;20.<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;packaged_task::valid&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;packaged_task&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">)&gt;&nbsp;tssk;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;fut&nbsp;=&nbsp;launcher(tssk,&nbsp;</span><span style="color:#ff0000;">25</span><span style="color:#000000;">);<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;packaged_task&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">)&gt;&nbsp;tskk([](</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x)&nbsp;{</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;x&nbsp;*&nbsp;</span><span style="color:#ff0000;">2</span><span style="color:#000000;">;&nbsp;});<BR>
&nbsp;&nbsp;&nbsp;&nbsp;fut&nbsp;=&nbsp;launcher(tskk,&nbsp;</span><span style="color:#ff0000;">25</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;The&nbsp;double&nbsp;of&nbsp;25&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;fut.get()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;.\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼šnot&nbsp;valid\n&nbsp;The...&nbsp;is&nbsp;50.<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;packaged_task::make_ready_at_thread_exit&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&gt;&nbsp;result;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread{&nbsp;worker,&nbsp;ref(result)&nbsp;}.join();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;status&nbsp;=&nbsp;result.wait_for(chrono::seconds(</span><span style="color:#ff0000;">0</span><span style="color:#000000;">));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(status&nbsp;==&nbsp;future_status::ready)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;main:&nbsp;result&nbsp;is&nbsp;ready&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;endl;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;packaged_task::reset&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;packaged_task&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">)&gt;&nbsp;ttsk(triple);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;fuut&nbsp;=&nbsp;ttsk.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;ttsk(</span><span style="color:#ff0000;">33</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;The&nbsp;triple&nbsp;of&nbsp;33&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;fuut.get()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;.\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;ttsk.reset();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;fuut&nbsp;=&nbsp;ttsk.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;thread(move(ttsk),&nbsp;</span><span style="color:#ff0000;">99</span><span style="color:#000000;">).detach();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;The&nbsp;triple&nbsp;of&nbsp;99&nbsp;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;fuut.get()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;.\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼šThe&nbsp;triple&nbsp;of&nbsp;33ã€99&nbsp;is&nbsp;99ã€297.<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br><font color=blue size = 5>Non-member function overloads</font>
<br>
<br><font color=purple size = 4>std::swap (packaged_task)</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template &lt;class Ret, class... Args&gt;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void swap (packaged_task&lt;Ret(Args...)&gt;&amp; x, packaged_task&lt;Ret(args...)&gt;&amp; y) noexcept;
<br> â— äº¤æ¢xå’Œyä¹‹é—´çš„å…±äº«çŠ¶æ€å’Œå­˜å‚¨ä»»åŠ¡ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è½½çš„äº¤æ¢ï¼Œå°±åƒx.swap(y)è¢«è°ƒç”¨
<br>
<br><font color=blue size = 5>Non-member class specializations</font>
<br>
<br><font color=purple size = 4>std::uses_allocator&lt;packaged_task&gt;</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template &lt;class Ret, class Alloc&gt;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct uses_allocator&lt;packaged_task&lt;Ret&gt;,Alloc&gt;;
<br> â— ä½¿ç”¨åˆ†é…å™¨packaged_task
<br> â— uses_allocatorçš„è¿™ç§ç‰¹æ€§ä¸“é—¨åŒ–é€šçŸ¥äº†packaged_taskå¯¹è±¡å¯ä»¥ä¸é…ç½®å™¨ä¸€èµ·æ„å»ºï¼Œå³ä½¿ç±»ä¸­æ²¡æœ‰ä»»ä½•allocator_typeæˆå‘˜
<br> â— å®ƒåœ¨&lt; future &gt;ä¸­å®šä¹‰ï¼Œä¸ç›¸åŒçš„è¡Œä¸ºå¦‚ä¸‹ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template &lt;class Ret, class Alloc&gt;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct uses_allocator&lt;packaged_task&lt;Ret&gt;,Alloc&gt; : true_type {};
<br> â— uses_allocator è¿™ä¸ªçš„è¯´æ˜åŒä¸Šé¢promiseçš„std::uses_allocator&lt;promise&gt;é‡Œé¢çš„è§£é‡Š
<br>
<br><font color=green size = 5>Futures</font>
<br>
<br><a name="bc3"><font color=green size = 5>future</font></a>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;&nbsp;future;<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;R&amp;&gt;&nbsp;future&lt;R&amp;&gt;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;specialization&nbsp;:&nbsp;T&nbsp;is&nbsp;a&nbsp;reference&nbsp;type&nbsp;(R&amp;)<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&gt;;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;specialization&nbsp;:&nbsp;T&nbsp;is&nbsp;void</span></div></td></tr></table></div>
<br> â— futureæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯ä»¥ä»æŸä¸ªæä¾›è€…å¯¹è±¡æˆ–å‡½æ•°ä¸­æ£€ç´¢å€¼ï¼Œå¦‚æœåœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œå¯ä»¥æ­£ç¡®åœ°åŒæ­¥æ­¤è®¿é—®
<br> â— â€œæœ‰æ•ˆâ€futuresæ˜¯ä¸å…±äº«çŠ¶æ€ç›¸å…³è”çš„futureå¯¹è±¡ï¼Œå¹¶é€šè¿‡è°ƒç”¨ä¸‹åˆ—å‡½æ•°ä¹‹ä¸€æ¥æ„å»ºï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;async
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise::get_future
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;packaged_task::get_future
<br> â— futureå¯¹è±¡åªåœ¨æœ‰æ•ˆçš„æ—¶å€™æœ‰ç”¨ï¼Œé»˜è®¤æ„é€ çš„futureå¯¹è±¡æ˜¯æ— æ•ˆçš„(é™¤éè¢«åˆ†é…åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„future)
<br> â— åœ¨ä¸€ä¸ªæœ‰æ•ˆçš„futureå¯¹è±¡ä¸Šè°ƒç”¨future::getçº¿ç¨‹å°±ä¼šé˜»å¡ä½ï¼Œç›´åˆ°æä¾›è€…ä½¿å…±äº«çŠ¶æ€å°±ç»ª(é€šè¿‡è®¾ç½®å€¼æˆ–å¼‚å¸¸)ã€‚è¿™æ ·ï¼Œä¸¤ä¸ªçº¿ç¨‹å°±å¯ä»¥åŒæ­¥ï¼Œç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ¥è®¾ç½®å€¼
<br> â— å…±äº«çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸè‡³å°‘æŒç»­åˆ°æœ€åä¸€ä¸ªå¯¹è±¡é‡Šæ”¾å®ƒæˆ–è¢«é”€æ¯ã€‚å› æ­¤ï¼Œå¦‚æœå…³è”äº†futureï¼Œå…±äº«çŠ¶æ€å¯ä»¥åœ¨ç¬¬ä¸€ä¸ªå£°æ˜(å¦‚æœæœ‰çš„è¯)ä¸­å­˜æ´»
<br> â— å®šä¹‰ä¸­æœ‰ä¸¤ä¸ªç‰¹åŒ–ï¼Œä¸€ä¸ªæ˜¯å¯¹å¼•ç”¨ç‰¹åŒ–ï¼Œä¸€ä¸ªæ˜¯å¯¹voidç‰¹åŒ–
<br>
<br><font color=blue size = 5>Member functions</font>
<br>
<br><font color=purple size = 4>(constructor)æ„é€ å‡½æ•°</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default (1) future() noexcept;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy [deleted] (2) future (const future&amp;) = delete;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;move (3) future (future&amp;&amp; x) noexcept;
<br>(1)é»˜è®¤æ„é€ å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ„é€ ä¸€ä¸ªç©ºçš„futureï¼Œå¯¹è±¡æ²¡æœ‰å…±äº«çŠ¶æ€ï¼Œå› æ­¤æ˜¯æ— æ•ˆçš„ï¼Œä½†å®ƒå¯ä»¥è¢«åˆ†é…ç»™å¦ä¸€ä¸ªfutureå€¼
<br>(2)æ‹·è´æ„é€ å‡½æ•°(åˆ é™¤)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;futureå¯¹è±¡ä¸èƒ½è¢«å¤åˆ¶
<br>(3)æ„é€ å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ„é€ çš„å¯¹è±¡è·å¾—xçš„å…±äº«çŠ¶æ€ï¼Œxå˜æˆäº†æ²¡æœ‰å…±äº«çŠ¶æ€çš„futureå¯¹è±¡
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…·æœ‰æœ‰æ•ˆå…±äº«çŠ¶æ€çš„futureåªèƒ½ç”±æŸäº›æä¾›è€…å‡½æ•°(å¦‚async)æ„å»ºï¼Œåƒ async, promise::get_future æˆ– packaged_task::get_future
<br>
<br><font color=purple size = 4>(destructor)ææ„å‡½æ•°</font>
<br> â— å¦‚æœå¯¹è±¡æ˜¯æœ‰æ•ˆçš„(å³å®ƒå¯ä»¥è®¿é—®å…±äº«çŠ¶æ€)ï¼Œä½¿å®ƒä¸å®ƒçš„å…±äº«çŠ¶æ€ä¸å†å…³è”
<br> â— å¦‚æœå®ƒæ˜¯ä¸å…±äº«çŠ¶æ€ç›¸å…³è”çš„å”¯ä¸€å¯¹è±¡ï¼Œé‚£ä¹ˆå…±äº«çŠ¶æ€æœ¬èº«ä¹Ÿä¼šè¢«ç ´å
<br>
<br><font color=purple size = 4>std::future::operator=</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;move (1) future&amp; operator= (future&amp;&amp; rhs) noexcept;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy [deleted] (2) future&amp; operator= (const future&amp;) = delete;
<br> â— è·å¾—rhsçš„å…±äº«çŠ¶æ€
<br> â— å¦‚æœå¯¹è±¡æ˜¯æœ‰æ•ˆçš„(å³å®ƒå¯ä»¥åœ¨è°ƒç”¨ä¹‹å‰è®¿é—®å…±äº«çŠ¶æ€)ï¼Œå®ƒä¸å…±äº«çŠ¶æ€æ˜¯åˆ†ç¦»
<br> â— å¦‚æœå®ƒæ˜¯ä¸è¿™ä¸ªå…±äº«çŠ¶æ€ç›¸å…³è”çš„å”¯ä¸€å¯¹è±¡ï¼Œé‚£ä¹ˆå‰å…±äº«çŠ¶æ€æœ¬èº«ä¹Ÿä¼šè¢«ç ´å
<br> â— åœ¨ç§»åŠ¨moveåï¼Œrhsæ²¡æœ‰å…±äº«çŠ¶æ€(å°±åƒé»˜è®¤æ„å»ºçš„é‚£æ ·)ï¼šå®ƒä¸å†æœ‰æ•ˆ
<br> â— futureå¯¹è±¡ä¸èƒ½è¢«å¤åˆ¶(2)
<br>
<br><font color=purple size = 4>std::future::share</font>
<br> ğŸ¨ å®šä¹‰ï¼šshared_future<T> share();
<br> â— è¿”å›ä¸€ä¸ªshared_futureå¯¹è±¡ï¼Œè¯¥å¯¹è±¡è·å–futureå¯¹è±¡çš„å…±äº«çŠ¶æ€ï¼Œfutureå¯¹è±¡(* this)æ²¡æœ‰å…±äº«çŠ¶æ€(å¦‚é»˜è®¤æ„å»ºçš„)ï¼Œä¸å†æœ‰æ•ˆ
<br>
<br><font color=purple size = 4>std::future::get</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;generic template (1) T get();
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reference specialization (2) R&amp; future&lt;R&amp;&gt;::get(); // when T is a reference type (R&amp;)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void specialization (3) void future&lt;void&gt;::get(); // when T is void
<br> â— å½“å…±äº«çŠ¶æ€å°±ç»ªæ—¶ï¼Œè¿”å›å­˜å‚¨åœ¨å…±äº«çŠ¶æ€çš„å€¼(æˆ–æŠ›å‡ºå¼‚å¸¸)
<br> â— å¦‚æœå…±äº«çŠ¶æ€è¿˜æœªå°±ç»ª(å³æä¾›è€…è¿˜æ²¡æœ‰è®¾ç½®å€¼æˆ–å¼‚å¸¸)ï¼Œè¯¥å‡½æ•°é˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œå¹¶ç­‰å¾…å®ƒå°±ç»ªï¼Œä¸€æ—¦å…±äº«çŠ¶æ€å°±ç»ªï¼Œå‡½æ•°å°†æ‰“å¼€å¹¶è¿”å›å…±äº«çŠ¶æ€(æˆ–æŠ›å‡ºå¼‚å¸¸)ï¼Œè¿™ä½¿å¾—ä»¥åçš„å¯¹è±¡ä¸å†æœ‰æ•ˆ
<br> â— è¿™ä¸ªæˆå‘˜å‡½æ•°å°†åœ¨æ¯ä¸ªfutureå…±äº«çŠ¶æ€çš„å¤§å¤šæ•°æƒ…å†µä¸‹è¢«è°ƒç”¨
<br> â— æ‰€æœ‰å¯è§çš„å‰¯ä½œç”¨åœ¨æä¾›è€…ä½¿å…±äº«çŠ¶æ€å°±ç»ªå’Œè¿”å›è¯¥å‡½æ•°ä¹‹é—´åŒæ­¥
<br> â— voidä¸“é—¨åŒ–çš„æˆå‘˜(3)ä¸è¿”å›ä»»ä½•å€¼ï¼Œä½†æ˜¯ä»ç„¶ç­‰å¾…å…±äº«çŠ¶æ€å‡†å¤‡å¥½å¹¶é‡Šæ”¾å®ƒ
<br>
<br><font color=purple size = 4>std::future::valid</font>
<br> â— è¿”å›å½“å‰futureå¯¹è±¡æ˜¯å¦ä¸å…±äº«çŠ¶æ€ç›¸å…³è”
<br> â— å¯¹äºé»˜è®¤æ„é€ çš„futureå¯¹è±¡ï¼Œè¿™ä¸ªå‡½æ•°å°†è¿”å›false(é™¤éæœ‰ä¸€ä¸ªæœ‰æ•ˆçš„future)
<br> â— åªèƒ½é€šè¿‡æŸäº›æä¾›è€…å‡½æ•°(å¦‚asyncã€promise::get_futureã€packaged_task::get_future)åˆå§‹æ„å»ºä¸æœ‰æ•ˆå…±äº«çŠ¶æ€çš„æœŸè´§
<br> â— ä¸€æ—¦å…±äº«çŠ¶æ€çš„å€¼è¢«future::getï¼Œè°ƒç”¨æ­¤å‡½æ•°è¿”å›false(é™¤éè¢«åˆ†é…åˆ°æ–°çš„æœ‰æ•ˆfuture)
<br>
<br><font color=purple size = 4>std::future::wait</font>
<br> â— ç­‰å¾…å…±äº«çŠ¶æ€å°±ç»ª
<br> â— å¦‚æœå…±äº«çŠ¶æ€æœªå°±ç»ª(å³æä¾›è€…è¿˜æ²¡æœ‰è®¾ç½®å€¼æˆ–å¼‚å¸¸)ï¼Œè¯¥å‡½æ•°é˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œå¹¶ç­‰å¾…å®ƒå°±ç»ªï¼Œä¸€æ—¦å…±äº«çŠ¶æ€å°±ç»ªï¼Œå‡½æ•°å°†æ‰“å¼€å¹¶è¿”å›å…±äº«çŠ¶æ€ï¼Œè€Œä¸è¯»å–å…¶å€¼ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå®ƒçš„è®¾ç½®å¼‚å¸¸(å¦‚æœå­˜åœ¨çš„è¯)
<br> â— æ‰€æœ‰å¯è§çš„å‰¯ä½œç”¨åœ¨æä¾›è€…ä½¿å…±äº«çŠ¶æ€å°±ç»ªå’Œè¿”å›è¯¥å‡½æ•°ä¹‹é—´åŒæ­¥
<br>
<br><font color=purple size = 4>std::future::wait_for</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template &lt;class Rep, class Period&gt;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status wait_for (const chrono::duration&lt;Rep,Period&gt;&amp; rel_time) const;
<br> â— åœ¨æŒ‡å®šçš„æ—¶é—´rel_timeå†…ç­‰å¾…å…±äº«çŠ¶æ€å°±ç»ª
<br> â— å¦‚æœå…±äº«çŠ¶æ€æœªå°±ç»ª(å³æä¾›è€…è¿˜æ²¡æœ‰è®¾ç½®å€¼æˆ–å¼‚å¸¸)ï¼Œè¯¥å‡½æ•°é˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œå¹¶ç­‰å¾…ç›´åˆ°å®ƒå‡†å¤‡å°±ç»ªï¼Œæˆ–è€…ç›´åˆ°rel_timeå·²ç»è¿è¡Œï¼Œæ— è®ºç¬¬ä¸€æ¬¡å‘ç”Ÿäº†ä»€ä¹ˆ
<br> â— å½“å‡½æ•°è¿”å›æ—¶ï¼Œå› ä¸ºå®ƒçš„å…±äº«çŠ¶æ€å·²ç»å‡†å¤‡å¥½äº†ï¼Œåœ¨å…±äº«çŠ¶æ€ä¸Šçš„å€¼æˆ–å¼‚å¸¸è®¾ç½®ä¸ºä¸è¢«è¯»å–ï¼Œä½†æ˜¯ï¼Œæ‰€æœ‰å¯è§çš„å‰¯ä½œç”¨åœ¨æä¾›è€…ä½¿å…±äº«çŠ¶æ€å°±ç»ªå’Œè¿”å›è¯¥å‡½æ•°ä¹‹é—´åŒæ­¥
<br> â— å¦‚æœå…±äº«çŠ¶æ€åŒ…å«ä¸€ä¸ªé€’å»¶å‡½æ•°(å¦‚asyncè¿”å›çš„futureå¯¹è±¡)ï¼Œåˆ™å‡½æ•°ä¸ä¼šé˜»å¡ï¼Œç«‹å³è¿”å›å€¼ä¸ºfuture_status::deferred
<br>ç±»å‹çš„å€¼future_statusæŒ‡ç¤ºä»€ä¹ˆå¯¼è‡´å‡½æ•°è¿”å›ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status::readyï¼šè¯¥å…±äº«çŠ¶æ€æ˜¯å‡†å¤‡å°±ç»ªï¼Œç”Ÿäº§è€…å·²è®¾å®šå€¼æˆ–å¼‚å¸¸
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status::timeoutï¼šè¯¥å‡½æ•°ç­‰å¾…rel_timeï¼Œè€Œæ²¡æœ‰å…±äº«çŠ¶æ€å°±ç»ª
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status::deferredï¼šè¯¥å…±äº«çŠ¶æ€åŒ…å«å»¶è¿ŸåŠŸèƒ½
<br>
<br><font color=purple size = 4>std::future::wait_until</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template &lt;class Clock, class Duration&gt;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status wait_until (const chrono::time_point&lt;Clock,Duration&gt;&amp; abs_time) const;
<br> â— ç­‰å¾…å…±äº«çŠ¶æ€å°±ç»ªï¼Œæœ€å¤šåˆ°abs_time
<br> â— å¦‚æœå…±äº«çŠ¶æ€è¿˜æœªå°±ç»ª(å³æä¾›è€…è¿˜æ²¡æœ‰è®¾ç½®å®ƒçš„å€¼æˆ–å¼‚å¸¸)ï¼Œè¯¥å‡½æ•°é˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œå¹¶ç­‰å¾…ç›´åˆ°å®ƒå‡†å¤‡å¥½ï¼Œæ— è®ºå“ªä¸ªç¬¬ä¸€æ¬¡å‡ºç°
<br> â— å½“å‡½æ•°è¿”å›æ—¶ï¼Œå› ä¸ºå®ƒçš„å…±äº«çŠ¶æ€å·²ç»å‡†å¤‡å¥½äº†ï¼Œåœ¨å…±äº«çŠ¶æ€ä¸Šçš„å€¼æˆ–å¼‚å¸¸è®¾ç½®ä¸ºä¸è¢«è¯»å–ï¼Œä½†æ˜¯ï¼Œæ‰€æœ‰å¯è§çš„å‰¯ä½œç”¨éƒ½æ˜¯åœ¨æä¾›è€…ä½¿å…±äº«çŠ¶æ€å°±ç»ªå¹¶è¿”å›è¯¥å‡½æ•°ä¹‹é—´åŒæ­¥
<br> â— å¦‚æœå…±äº«çŠ¶æ€åŒ…å«ä¸€ä¸ªé€’å»¶å‡½æ•°(å¦‚asyncè¿”å›çš„futureå¯¹è±¡)ï¼Œåˆ™å‡½æ•°ä¸ä¼šé˜»å¡ï¼Œç«‹å³è¿”å›å€¼ä¸ºfuture_status::deferred
<br>ç±»å‹çš„å€¼future_statusæŒ‡ç¤ºä»€ä¹ˆå¯¼è‡´å‡½æ•°è¿”å›ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status::readyï¼šè¯¥å…±äº«çŠ¶æ€æ˜¯å‡†å¤‡å°±ç»ªï¼Œç”Ÿäº§è€…å·²è®¾å®šå€¼æˆ–å¼‚å¸¸
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status::timeoutï¼šè¯¥å‡½æ•°ç­‰å¾…rel_timeï¼Œè€Œæ²¡æœ‰å…±äº«çŠ¶æ€å°±ç»ª
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status::deferredï¼šè¯¥å…±äº«çŠ¶æ€åŒ…å«å»¶è¿ŸåŠŸèƒ½
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br>79<br>80<br>81<br>82<br>83<br>84<br>85<br>86<br>87<br>88<br>89<br>90<br>91<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;utility&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;chrono&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;mutex&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;future&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;is_prime(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">2</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;x;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(x&nbsp;%&nbsp;i&nbsp;==&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">true</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;get_value()&nbsp;{&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">;&nbsp;}<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;get_int()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cin.exceptions(ios::failbit);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cin&nbsp;&gt;&gt;&nbsp;x;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;x;<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;future::share&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;sut&nbsp;=&nbsp;async(get_value);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;shared_future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;shfut&nbsp;=&nbsp;sut.share();<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;cout&nbsp;&lt;&lt;&nbsp;&quot;value:&nbsp;&quot;&nbsp;&lt;&lt;&nbsp;sut.get()&nbsp;&lt;&lt;&nbsp;&quot;\n&quot;;<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºsutå¯¹è±¡å·²ä¸å†æœ‰æ•ˆ<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;value:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;shfut.get()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;its&nbsp;double:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;shfut.get()&nbsp;*&nbsp;</span><span style="color:#ff0000;">2</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼švalue:&nbsp;10&nbsp;\n&nbsp;its&nbsp;double:&nbsp;20<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;future::get&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;futt&nbsp;=&nbsp;async(get_int);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;Please&nbsp;enter&nbsp;an&nbsp;integer&nbsp;value:&nbsp;&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">try</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x&nbsp;=&nbsp;futt.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;You&nbsp;entered:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;x&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">catch</span><span style="color:#000000;">&nbsp;(exception&nbsp;&amp;&nbsp;e)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;[exception&nbsp;caught]:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;e.what()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¾“å…¥æ•°å­—å°†æ‰“å°æ•°å­—ï¼Œè¾“å…¥å…¶å®ƒç±»å‹çš„å€¼å°†æŠ›å‡ºå¼‚å¸¸<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;future::vaild&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;fo,&nbsp;ba;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;fo&nbsp;=&nbsp;async(get_value);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;ba&nbsp;=&nbsp;move(fo);<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(fo.valid())<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;fo's&nbsp;value:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;fo.get()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">else</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;fo&nbsp;is&nbsp;not&nbsp;valid\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(ba.valid())<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;ba's&nbsp;value:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;ba.get()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">else</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;ba&nbsp;is&nbsp;not&nbsp;valid\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼šfo&nbsp;is&nbsp;not&nbsp;valid&nbsp;&nbsp;ba's&nbsp;value:&nbsp;10<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸ºè´¨æ•°<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;future::wait&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&gt;&nbsp;fuut&nbsp;=&nbsp;async(is_prime,&nbsp;</span><span style="color:#ff0000;">194232491</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;checking&nbsp;...\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;fuut.wait();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n19232491&nbsp;&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(fuut.get())<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;is&nbsp;prime.\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">else</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;is&nbsp;not&nbsp;prime.\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;åœ¨å¾—åˆ°ç»“æœä¹‹å‰ä¼šé˜»å¡<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;future::wait_for&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&gt;&nbsp;fut&nbsp;=&nbsp;async(is_prime,&nbsp;</span><span style="color:#ff0000;">444444443</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;checking,&nbsp;please&nbsp;wait&nbsp;&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;chrono::milliseconds&nbsp;span(</span><span style="color:#ff0000;">100</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(fut.wait_for(span)&nbsp;==&nbsp;future_status::timeout)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;.&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;flush;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;x&nbsp;=&nbsp;fut.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n444444443&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;(x&nbsp;?&nbsp;</span><span style="color:#800000;">&quot;is&quot;</span><span style="color:#000000;">&nbsp;:&nbsp;</span><span style="color:#800000;">&quot;is&nbsp;not&quot;</span><span style="color:#000000;">)&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;&nbsp;prime.\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;é¦–å…ˆä¸€ç›´æ‰“å°&nbsp;.&nbsp;ç›´åˆ°å¾—åˆ°ç»“æœ<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
<br><a name="bc4"><font color=green size = 5>shared_future</font></a>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;T&gt;&nbsp;&nbsp;shared_future;<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;R&amp;&gt;&nbsp;shared_future&lt;R&amp;&gt;;&nbsp;</span><span style="color:#008000;">//&nbsp;specialization&nbsp;:&nbsp;T&nbsp;is&nbsp;a&nbsp;reference&nbsp;type&nbsp;(R&amp;)<BR>
</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shared_future&lt;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&gt;;&nbsp;</span><span style="color:#008000;">//&nbsp;specialization&nbsp;:&nbsp;T&nbsp;is&nbsp;void</span></div></td></tr></table></div>
shared_futureå¯¹è±¡çš„è¡Œä¸ºå°±åƒfutureå¯¹è±¡ï¼Œé™¤éå®ƒå¯ä»¥è¢«å¤åˆ¶ï¼Œè€Œä¸”ä¸æ­¢ä¸€ä¸ªshared_futureå¯ä»¥å…±äº«å…±äº«çŠ¶æ€ï¼Œå®ƒè¿˜å…è®¸å°†å…±äº«çŠ¶æ€ä¸­çš„å€¼ä¸€æ¬¡æ€§æ£€ç´¢å¤šæ¬¡
<br> â— shared_futureå¯¹è±¡å¯ä»¥éšå¼åœ°ä»futureçš„å¯¹è±¡(æŸ¥çœ‹å…¶æ„é€ å‡½æ•°)è½¬æ¢ï¼Œæˆ–è€…é€šè¿‡è°ƒç”¨future::shareæ¥æ˜¾å¼åœ°è·å¾—ï¼Œåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå®ƒæ‰€è·å¾—çš„futureå¯¹è±¡å°†å…¶ä¸å…±äº«çŠ¶æ€çš„å…³è”è½¬ç§»åˆ°shared_futureå¹¶ä½¿å…¶è‡ªèº«æ— æ•ˆ
<br> â— å…±äº«çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸè‡³å°‘æŒç»­åˆ°ä¸å®ƒå…³è”çš„æœ€åä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯ï¼Œä»shared_futureæ£€ç´¢å€¼(ä¸æˆå‘˜è·å–)ä¸é‡Šæ”¾å…¶å¯¹å…±äº«çŠ¶æ€çš„æ‰€æœ‰æƒã€‚å› æ­¤ï¼Œå¦‚æœå…³è”åˆ°shared_futureå¯¹è±¡ï¼Œå…±äº«çŠ¶æ€å¯ä»¥åœ¨ç¬¬ä¸€ä¸ªä½ç½®(å¦‚æœæœ‰çš„è¯)ä¸­å­˜æ´»
<br>
<br><font color=blue size = 5>Member functions</font>
<br>
<br><font color=purple size = 4>(constructor)æ„é€ å‡½æ•°</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default (1) shared_future() noexcept;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy (2) shared_future (const shared_future&amp; x);
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;move (3) shared_future (shared_future&amp;&amp; x) noexcept;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;move from future (4) shared_future (future<T>&amp;&amp; x) noexcept;
<br>(1)é»˜è®¤æ„é€ å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ„é€ ä¸€ä¸ªç©ºçš„shared_futureå¯¹è±¡ï¼Œæ²¡æœ‰å…±äº«çŠ¶æ€ï¼Œå› æ­¤å®ƒæ˜¯æ— æ•ˆçš„ï¼Œä½†æ˜¯å®ƒå¯ä»¥è¢«èµ‹å€¼ä¸€ä¸ªæœ‰æ•ˆå€¼
<br>(2)æ‹·è´æ„é€ å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ„å»ºçš„shared_futureå…·æœ‰ä¸xç›¸åŒçš„å…±äº«çŠ¶æ€ï¼Œå¹¶äº«æœ‰æ‰€æœ‰æƒ
<br>(3)æ„é€ å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ„é€ çš„å¯¹è±¡è·å¾—xçš„å…±äº«çŠ¶æ€(å¦‚æœæœ‰çš„è¯)ï¼Œxä¸å†æœ‰æ•ˆ
<br>(4)é€šè¿‡moveæ„é€ å‡½æ•°æˆ–è°ƒç”¨æˆå‘˜future::shareå¯ä»¥ä»futureçš„å¯¹è±¡ä¸­è·å¾—å…·æœ‰æœ‰æ•ˆå…±äº«çŠ¶æ€çš„future
<br>
<br><font color=purple size = 4>(destructor)ææ„å‡½æ•°</font>
<br> â— ç ´åshared_futureå¯¹è±¡
<br> â— å¦‚æœå¯¹è±¡æ˜¯æœ‰æ•ˆçš„(å³å¯ä»¥è®¿é—®å…±äº«çŠ¶æ€)ï¼Œå®ƒä¸å…±äº«çŠ¶æ€åˆ†ç¦»
<br> â— å¦‚æœå®ƒæ˜¯ä¸å…±äº«çŠ¶æ€ç›¸å…³è”çš„å”¯ä¸€å¯¹è±¡ï¼Œé‚£ä¹ˆå…±äº«çŠ¶æ€æœ¬èº«ä¹Ÿä¼šè¢«ç ´å
<br>
<br><font color=purple size = 4>std::shared_future::operator=</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;move (1) shared_future&amp; operator= (shared_future&amp;&amp; rhs) noexcept;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy (2) shared_future&amp; operator= (const shared_future&amp; rhs);
<br>(1)move assignment
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯¹è±¡è·å¾—rhsçš„å…±äº«çŠ¶æ€(å¦‚æœæœ‰çš„è¯)ï¼Œrhså°†ä¸å†æœ‰æ•ˆ
<br>(2)æ‹·è´æ„é€ 
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯¹è±¡ä¸rhs(å¦‚æœæœ‰çš„è¯)ç›¸åŒçš„å…±äº«çŠ¶æ€ç›¸å…³è”ï¼Œå…±äº«æ‰€æœ‰æƒï¼Œrhså¹¶æ²¡æœ‰è¢«ä¿®æ”¹
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¦‚æœåœ¨è°ƒç”¨ä¹‹å‰å¯¹è±¡æ˜¯æœ‰æ•ˆçš„(å³å®ƒå¯ä»¥åœ¨è°ƒç”¨ä¹‹å‰è®¿é—®å…±äº«çŠ¶æ€)ï¼Œå®ƒä¸å…±äº«çŠ¶æ€åˆ†ç¦»ã€‚å¦‚æœå®ƒæ˜¯ä¸è¿™ä¸ªå…±äº«çŠ¶æ€ç›¸å…³è”çš„å”¯ä¸€å¯¹è±¡ï¼Œé‚£ä¹ˆä¹‹å‰çš„å…±äº«çŠ¶æ€ä¹Ÿä¼šè¢«ç ´å
<br>
<br><font color=purple size = 4>std::shared_future::get</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;generic template (1) const T&amp; get() const;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reference specialization (2) R&amp; shared_future&lt;R&amp;&gt;::get() const; // when T is a
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reference type (R&amp;) void specialization (3) void shared_future&lt;void&gt;::get() const; // when T is void
<br> â— å½“å…±äº«çŠ¶æ€å°±ç»ªæ—¶ï¼Œè¿”å›å­˜å‚¨åœ¨å…±äº«çŠ¶æ€(æˆ–æŠ›å‡ºå¼‚å¸¸)çš„å€¼çš„å¼•ç”¨
<br> â— å¦‚æœå…±äº«çŠ¶æ€è¿˜æœªå°±ç»ª(å³æä¾›è€…è¿˜æ²¡æœ‰è®¾ç½®å€¼æˆ–å¼‚å¸¸)ï¼Œè¯¥å‡½æ•°é˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œå¹¶ç­‰å¾…å®ƒå°±ç»ªï¼Œä¸€æ—¦å…±äº«çŠ¶æ€å°±ç»ªï¼Œå‡½æ•°å°†å¯åŠ¨å¹¶è¿”å›å…±äº«çŠ¶æ€(æˆ–æŠ›å‡ºå¼‚å¸¸)ï¼Œä½†ä¸ä¼šé‡Šæ”¾å®ƒçš„å…±äº«çŠ¶æ€(ä¸åƒfuture::get)ï¼Œå…è®¸å…¶å®ƒshared_futureå¯¹è±¡ä¹Ÿè®¿é—®å­˜å‚¨çš„å€¼(æˆ–åŒä¸€å¯¹è±¡çš„æ–°è®¿é—®)
<br> â— æ‰€æœ‰å¯è§çš„å‰¯ä½œç”¨åœ¨æä¾›è€…ä½¿å…±äº«çŠ¶æ€å°±ç»ªå’Œè¿”å›è¯¥å‡½æ•°ä¹‹é—´åŒæ­¥ï¼Œä½†æ˜¯æ³¨æ„ï¼Œåœ¨è¿™ä¸ªäº‹ä»¶ä¸­è¿”å›çš„æ½œåœ¨çš„å¤šä¸ªå‡½æ•°ä¹‹é—´ä¸å­˜åœ¨åŒæ­¥(åœ¨å¤šä¸ªshared_futureå¯¹è±¡ç­‰å¾…ç›¸åŒçš„å…±äº«çŠ¶æ€çš„æƒ…å†µä¸‹)
<br> â— voidä¸“é—¨åŒ–çš„æˆå‘˜(3)ä¸è¿”å›ä»»ä½•å€¼ï¼Œä½†æ˜¯ä»ç„¶ç­‰å¾…å…±äº«çŠ¶æ€åœ¨è¿”å›/æŠ›å‡ºä¹‹å‰å‡†å¤‡å°±ç»ª
<br>
<br><font color=purple size = 4>std::shared_future::valid</font>
<br> â— è¿”å›å½“å‰shared_futureå¯¹è±¡æ˜¯å¦ä¸å…±äº«çŠ¶æ€ç›¸å…³è”
<br> â— å¯¹äºé»˜è®¤æ„é€ çš„shared_futureå¯¹è±¡ï¼Œè¿™ä¸ªå‡½æ•°å°†è¿”å›false(é™¤éæŒ‡å®šæœ‰æ•ˆçš„shared_future)
<br> â— å…±äº«futuresä»futureçš„å¯¹è±¡(åœ¨æ„å»ºæˆ–åˆ†é…å®ƒä»¬)ä¸­è·å¾—æœ‰æ•ˆçš„å…±äº«çŠ¶æ€ã€‚ä¸futureå¯¹è±¡ä¸åŒï¼Œå®ƒä»¬ä¿ç•™ç›¸åŒçš„å…±äº«çŠ¶æ€å…³è”å’Œæœ‰æ•ˆæ€§ï¼Œç›´åˆ°é”€æ¯(æˆ–åˆ†é…)
<br>
<br><font color=purple size = 4>std::shared_future::wait</font>
<br> â— ç­‰å¾…å…±äº«çŠ¶æ€å°±ç»ª
<br> â— å¦‚æœå…±äº«çŠ¶æ€è¿˜æœªå°±ç»ª(å³æä¾›è€…è¿˜æ²¡æœ‰è®¾ç½®å…¶å€¼æˆ–å¼‚å¸¸ï¼‰ï¼Œè¯¥å‡½æ•°é˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œå¹¶ç­‰å¾…å®ƒå°±ç»ª
<br> â— ä¸€æ—¦å…±äº«çŠ¶æ€å°±ç»ªï¼Œå‡½æ•°å°±ä¼šæ‰“å¼€å¹¶è¿”å›ï¼Œè€Œä¸è¯»å–å…¶å€¼ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå®ƒçš„è®¾ç½®å¼‚å¸¸(å¦‚æœæœ‰çš„è¯)
<br> â— æ‰€æœ‰å¯è§çš„å‰¯ä½œç”¨åœ¨æä¾›è€…ä½¿å…±äº«çŠ¶æ€å°±ç»ªå’Œè¿”å›è¯¥å‡½æ•°çš„æ—¶å€™åŒæ­¥ï¼Œä½†æ˜¯æ³¨æ„ï¼Œåœ¨è¿™ä¸ªäº‹ä»¶ä¸­è¿”å›çš„æ½œåœ¨çš„å¤šä¸ªå‡½æ•°ä¹‹é—´ä¸å­˜åœ¨åŒæ­¥(åœ¨å¤šä¸ªshared_futureå¯¹è±¡ç­‰å¾…ç›¸åŒçš„å…±äº«çŠ¶æ€çš„æƒ…å†µä¸‹)
<br>
<br><font color=purple size = 4>std::shared_future::wait_for</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template &lt;class Rep, class Period&gt;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status wait_for (const chrono::duration&lt;Rep,Period&gt;&amp; rel_time) const;
<br> â— ç­‰å¾…æŒ‡å®šçš„rel_timeæ—¶é—´å…±äº«çŠ¶æ€å°±ç»ª
<br> â— å¦‚æœå…±äº«çŠ¶æ€è¿˜æœªå°±ç»ª(å³æä¾›è€…è¿˜æ²¡æœ‰è®¾ç½®å…¶å€¼æˆ–å¼‚å¸¸ï¼‰ï¼Œè¯¥å‡½æ•°é˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œå¹¶ç­‰å¾…ç›´åˆ°å®ƒå‡†å¤‡å°±ç»ªï¼Œæˆ–è€…ç›´åˆ°rel_timeæ—¶é—´åˆ°ï¼Œæ— è®ºç¬¬ä¸€æ¬¡å‘ç”Ÿä»€ä¹ˆ
<br> â— å½“å‡½æ•°è¿”å›æ—¶ï¼Œå› ä¸ºå®ƒçš„å…±äº«çŠ¶æ€å·²ç»å‡†å¤‡å¥½äº†ï¼Œåœ¨å…±äº«çŠ¶æ€ä¸Šçš„å€¼æˆ–å¼‚å¸¸è®¾ç½®ä¸ºä¸è¢«è¯»å–ï¼Œä½†æ˜¯ï¼Œæ‰€æœ‰å¯è§çš„å‰¯ä½œç”¨éƒ½æ˜¯åœ¨æä¾›è€…ä½¿å…±äº«çŠ¶æ€å°±ç»ªå¹¶è¿”å›è¯¥å‡½æ•°ä¹‹é—´åŒæ­¥
<br> â— å¦‚æœå…±äº«çŠ¶æ€åŒ…å«ä¸€ä¸ªé€’å»¶å‡½æ•°ï¼Œåˆ™å‡½æ•°ä¸ä¼šé˜»å¡ï¼Œç«‹å³è¿”å›å€¼ä¸ºfuture_status::deferred
<br> â— åŒ future::wait_forçš„å¼‚å¸¸æƒ…å†µ
<br>
<br><font color=purple size = 4>std::shared_future::wait_until</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template &lt;class Clock, class Duration&gt;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status wait_until (const chrono::time_point&lt;Clock,Duration&gt;&amp; abs_time) const;
<br> â— ç­‰å¾…å…±äº«çŠ¶æ€å°±ç»ªï¼Œæœ€å¤šåªèƒ½ç­‰å¾…abs_time
<br> â— å¦‚æœå…±äº«çŠ¶æ€è¿˜æœªå°±ç»ª(å³æä¾›è€…è¿˜æ²¡æœ‰è®¾ç½®å®ƒçš„å€¼æˆ–å¼‚å¸¸)ï¼Œè¯¥å‡½æ•°é˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œå¹¶ç­‰å¾…ç›´åˆ°å®ƒå‡†å¤‡å¥½ï¼Œæ— è®ºå“ªä¸ªç¬¬ä¸€æ¬¡å‡ºç°
<br> â— å½“å‡½æ•°è¿”å›æ—¶ï¼Œå› ä¸ºå®ƒçš„å…±äº«çŠ¶æ€å·²ç»å‡†å¤‡å¥½äº†ï¼Œåœ¨å…±äº«çŠ¶æ€ä¸Šçš„å€¼æˆ–å¼‚å¸¸è®¾ç½®ä¸ºä¸è¢«è¯»å–ï¼Œä½†æ˜¯ï¼Œæ‰€æœ‰å¯è§çš„å‰¯ä½œç”¨éƒ½æ˜¯åœ¨æä¾›è€…ä½¿å…±äº«çŠ¶æ€å°±ç»ªå¹¶è¿”å›è¯¥å‡½æ•°ä¹‹é—´åŒæ­¥
<br> â— å¦‚æœå…±äº«çŠ¶æ€åŒ…å«ä¸€ä¸ªé€’å»¶å‡½æ•°ï¼Œåˆ™å‡½æ•°ä¸ä¼šé˜»å¡ï¼Œç«‹å³è¿”å›å€¼ä¸ºfuture_status::deferred
<br> â— åŒ future::wait_forçš„å¼‚å¸¸æƒ…å†µ
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;utility&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;chrono&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;mutex&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;thread&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;future&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;is_prime(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;x)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">2</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;x;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(x&nbsp;%&nbsp;i&nbsp;==&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">true</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&gt;&nbsp;ffut;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;boolalpha&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;ffut&nbsp;is&nbsp;valid?&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;ffut.valid()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;shared_future&lt;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&gt;&nbsp;sfuut&nbsp;=&nbsp;move(ffut);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;boolalpha&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;and&nbsp;now&nbsp;ffut&nbsp;is&nbsp;valid?&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;ffut.valid()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;boolalpha&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;and&nbsp;the&nbsp;sfuut&nbsp;is&nbsp;valid?&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;sfuut.valid()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&gt;&nbsp;fut&nbsp;=&nbsp;async(is_prime,&nbsp;</span><span style="color:#ff0000;">444444443</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;checking&nbsp;444444443&nbsp;&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(fut.wait_for(chrono::milliseconds(</span><span style="color:#ff0000;">100</span><span style="color:#000000;">))&nbsp;==&nbsp;future_status::timeout)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;.&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&nbsp;x&nbsp;=&nbsp;fut.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n444444443&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;(x&nbsp;?&nbsp;</span><span style="color:#800000;">&quot;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;:&nbsp;</span><span style="color:#800000;">&quot;is&nbsp;not&nbsp;&quot;</span><span style="color:#000000;">)&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;prime\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;boolalpha&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;and&nbsp;now&nbsp;fut&nbsp;is&nbsp;valid?&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;fut.valid()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&gt;&nbsp;futt&nbsp;=&nbsp;async(is_prime,&nbsp;</span><span style="color:#ff0000;">194232491</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;shared_future&lt;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&gt;&nbsp;ssfut&nbsp;=&nbsp;move(futt);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;checking&nbsp;194232491&nbsp;&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(ssfut.wait_for(chrono::milliseconds(</span><span style="color:#ff0000;">100</span><span style="color:#000000;">))&nbsp;==&nbsp;future_status::timeout)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;.&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;ssfut.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n194232491&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;(x&nbsp;?&nbsp;</span><span style="color:#800000;">&quot;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;:&nbsp;</span><span style="color:#800000;">&quot;is&nbsp;not&nbsp;&quot;</span><span style="color:#000000;">)&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;prime\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;boolalpha&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;and&nbsp;now&nbsp;futt&nbsp;is&nbsp;valid?&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;futt.valid()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;shared_future&lt;</span><span style="color:#8000ff;">bool</span><span style="color:#000000;">&gt;&nbsp;sffut&nbsp;=&nbsp;ssfut;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;checking&nbsp;194232491&nbsp;again&nbsp;&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">while</span><span style="color:#000000;">&nbsp;(sffut.wait_for(chrono::milliseconds(</span><span style="color:#ff0000;">100</span><span style="color:#000000;">))&nbsp;==&nbsp;future_status::timeout)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;.&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;sffut.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n194232491&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;(x&nbsp;?&nbsp;</span><span style="color:#800000;">&quot;is&nbsp;&quot;</span><span style="color:#000000;">&nbsp;:&nbsp;</span><span style="color:#800000;">&quot;is&nbsp;not&nbsp;&quot;</span><span style="color:#000000;">)&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;prime\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;boolalpha&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;and&nbsp;now&nbsp;ssfut&nbsp;is&nbsp;valid?&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;ssfut.valid()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#008000;">//&nbsp;è¾“å‡ºå¦‚ä¸‹ï¼š<BR>
</span><span style="color:#000000;">ffut&nbsp;is&nbsp;valid?&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;"><BR>
</span><span style="color:#0000ff;">and</span><span style="color:#000000;">&nbsp;now&nbsp;ffut&nbsp;is&nbsp;valid?&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;"><BR>
</span><span style="color:#0000ff;">and</span><span style="color:#000000;">&nbsp;the&nbsp;sfuut&nbsp;is&nbsp;valid?&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;"><BR>
checking&nbsp;</span><span style="color:#ff0000;">444444443</span><span style="color:#000000;">&nbsp;..................<BR>
</span><span style="color:#ff0000;">444444443</span><span style="color:#000000;">&nbsp;is&nbsp;prime<BR>
</span><span style="color:#0000ff;">and</span><span style="color:#000000;">&nbsp;now&nbsp;fut&nbsp;is&nbsp;valid?&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;"><BR>
checking&nbsp;</span><span style="color:#ff0000;">194232491</span><span style="color:#000000;">&nbsp;.......<BR>
</span><span style="color:#ff0000;">194232491</span><span style="color:#000000;">&nbsp;is&nbsp;prime<BR>
</span><span style="color:#0000ff;">and</span><span style="color:#000000;">&nbsp;now&nbsp;futt&nbsp;is&nbsp;valid?&nbsp;</span><span style="color:#0000ff;">false</span><span style="color:#000000;"><BR>
checking&nbsp;</span><span style="color:#ff0000;">194232491</span><span style="color:#000000;">&nbsp;again<BR>
</span><span style="color:#ff0000;">194232491</span><span style="color:#000000;">&nbsp;is&nbsp;prime<BR>
</span><span style="color:#0000ff;">and</span><span style="color:#000000;">&nbsp;now&nbsp;ssfut&nbsp;is&nbsp;valid?&nbsp;</span><span style="color:#0000ff;">true</span></div></td></tr></table></div>
<br><a name="bc5"><font color=green size = 5>Other types</font></a>
<br>
<br><font color=purple size = 4>std::future_error</font>
<br> ğŸ¨ å®šä¹‰ï¼šclass future_error : public logic_error;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exception â† logic_error â† future_error
<br> â— è¿™ä¸ªç±»å®šä¹‰æŠ›å‡ºçš„å¯¹è±¡çš„ç±»å‹ï¼Œä»¥ä¾¿äºå¯¹æœªæ¥å¯èƒ½è®¿é—®futureå…±äº«çŠ¶æ€åº“ä¸­çš„å…¶å®ƒå¯¹è±¡æˆ–è€…å…ƒç´ æŠ¥å‘Šæ— æ•ˆçš„æ“ä½œ
<br> â— è¿™ä¸ªç±»ç»§æ‰¿äº†logic_errorï¼Œå®ƒæ·»åŠ äº†ä¸€ä¸ªerror_codeä½œä¸ºæˆå‘˜ä»£ç (å¹¶å®šä¹‰äº†ä¸€ä¸ªä¸“é—¨çš„æˆå‘˜)
<br>1.std::future_error::future_error æ„é€ ä¸€ä¸ªfuture_errorå¼‚å¸¸å¯¹è±¡ä»¥ecä½œä¸ºé”™è¯¯ä»£ç 
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_error (error_code ec); //å®šä¹‰
<br>2.std::future_error::code è¿”å›ä¸å¼‚å¸¸å…³è”çš„error_codeå¯¹è±¡
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const error_code&amp; code() const noexcept;
<br>3.std::future_error::what è¿”å›æè¿°å¼‚å¸¸çš„æ¶ˆæ¯ã€‚åŒ…æ‹¬ç”±code(). message()è¿”å›çš„å­—ç¬¦ä¸²
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const char* what() const noexcept;
<br>
<br><font color=purple size = 4>std::future_errc</font>
<br> ğŸ¨ å®šä¹‰ï¼šenum class future_errc;
<br> â— è¿™ä¸ªenumç±»å®šä¹‰äº†futureç±»åˆ«çš„é”™è¯¯æ¡ä»¶ã€‚æšä¸¾ç±»å‹future_errcçš„å€¼å¯ç”¨äºåˆ›å»ºerror_conditionå¯¹è±¡ï¼Œä»¥ä¸future_errorçš„ä»£ç æˆå‘˜è¿”å›çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;broken_promise(å€¼0)ï¼špromise å¯¹è±¡ç”¨futureå¯¹è±¡åˆ†äº«å…¶å…±äº«çŠ¶æ€åœ¨è®¾å®šå€¼æˆ–å¼‚å¸¸ä¹‹å‰è¢«é”€æ¯
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_already_retrieved(å€¼1)ï¼š ä¸€ä¸ªfutureå¯¹è±¡å·²ä»æ­¤æä¾›ç¨‹åºæ£€ç´¢
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;promise_already_satisfied(å€¼2)ï¼šè¯¥promiseå¯¹è±¡å·²ç»è®¾ç½®äº†ä¸€ä¸ªå€¼æˆ–å¼‚å¸¸
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_state(å€¼3)ï¼š æ“ä½œå°è¯•è®¿é—®æ²¡æœ‰ä¸€ä¸ªå¯¹è±¡çš„å…±äº«çŠ¶æ€
<br>
<br><font color=purple size = 4>std::future_status</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enum class future_status;
<br> â— è¿™ä¸ªenumç±»å®šä¹‰äº†furureå’Œshared_futureçš„æˆå‘˜å‡½æ•°wait_forå’Œwait_untilçš„å¯èƒ½è¿”å›å€¼
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status::ready : ç”±äºå…±äº«çŠ¶æ€å·²å‡†å¤‡å°±ç»ªï¼Œå› æ­¤è¿”å›è¯¥å‡½æ•°
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status::timeout : è¯¥å‡½æ•°è¿”å›ï¼Œå› ä¸ºæŒ‡å®šçš„æ—¶é—´å·²ç”¨å°½
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future_status::deferred : è¯¥å‡½æ•°è¿”å›ï¼Œå› ä¸ºå…±äº«çŠ¶æ€åŒ…å«å»¶è¿Ÿå‡½æ•°ï¼ˆå‚è§çš„std::syncï¼‰
<br>
<br><font color=purple size = 4>std::launch</font>
<br> ğŸ¨ å®šä¹‰ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enum class launch;
<br> â— è¿™ä¸ªenumç±»ç±»å‹æ˜¯ä¸€ä¸ªä½æ©æ¨¡ç±»å‹ï¼Œå®ƒå®šä¹‰äº†å¯¹å¼‚æ­¥çš„è°ƒç”¨çš„å¯åŠ¨ç­–ç•¥
<br> â— æŒ‡å®šçš„ç­‰ä»·intå€¼åº”è¯¥è¡¨ç¤ºå•ä¸ªä½ï¼Œå…è®¸å¤šä¸ªæ ‡ç­¾ç»„åˆåœ¨ä¸€ä¸ªä½æ©ç ä¸­ã€‚å½“å°†æ­¤ç±»å‹çš„å¤šä¸ªå€¼ç»„åˆåœ¨ä¸€èµ·æ—¶ï¼Œè¯¥å‡½æ•°å°†è‡ªåŠ¨é€‰æ‹©ä¸€ä¸ª(æ ¹æ®å®ƒä»¬ç‰¹å®šçš„åº“å®ç°)
<br> â— åº“å®ç°å¯ä»¥ä¸ºä¸åŒçš„å¯åŠ¨ç­–ç•¥å®šä¹‰è¿™ç§ç±»å‹çš„é™„åŠ æ ‡ç­¾ï¼Œè¿™äº›ç­–ç•¥å¯ä»¥é€šè¿‡ä¸åŒçš„è°ƒç”¨æè¿°å¯¹ä»»åŠ¡äº¤äº’çš„é™åˆ¶
<br> â— å®ƒå¯ä»¥æ˜¯ä¸‹åˆ—å€¼çš„ä»»æ„ç»„åˆï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;launch::async(å¼‚æ­¥)ï¼šè¯¥å‡½æ•°è¢«ä¸€ä¸ªæ–°çº¿ç¨‹å¼‚æ­¥è°ƒç”¨ï¼Œå¹¶ä¸å…±äº«çŠ¶æ€çš„è®¿é—®ç‚¹åŒæ­¥å®ƒçš„è¿”å›
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;launch::deferred(é€’å»¶)ï¼šå‡½æ•°åœ¨è®¿é—®å…±äº«çŠ¶æ€æ—¶è°ƒç”¨
<br>
<br> ğŸ“ ç¨‹åºç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;chrono&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;future&gt;<BR>
</span><span style="color:#0000ff;">using</span><span style="color:#000000;">&nbsp;</span><span style="color:#0000ff;">namespace</span><span style="color:#000000;">&nbsp;std;<BR>
<BR>
</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&nbsp;print_ten(</span><span style="color:#8000ff;">char</span><span style="color:#000000;">&nbsp;c,&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;ms)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">for</span><span style="color:#000000;">&nbsp;(</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;i&nbsp;=&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span style="color:#ff0000;">10</span><span style="color:#000000;">;&nbsp;++i)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this_thread::sleep_for(chrono::milliseconds(ms));<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;c;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
}<BR>
<BR>
</span><span style="color:#0000ff;">auto</span><span style="color:#000000;">&nbsp;main()&nbsp;-&gt;&nbsp;</span><span style="color:#8000ff;">int</span><span style="color:#000000;"><BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;future_error&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;promise&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;prom;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">try</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prom.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prom.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">catch</span><span style="color:#000000;">&nbsp;(future_error&nbsp;&amp;&nbsp;e)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;cout&nbsp;&lt;&lt;&nbsp;&quot;future_error&nbsp;caught:&nbsp;&quot;&nbsp;&lt;&lt;&nbsp;e.what()&nbsp;&lt;&lt;&nbsp;&quot;\n&quot;;<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;future_error&nbsp;caught:&nbsp;&quot;</span><span style="color:#000000;">&nbsp;&lt;&lt;&nbsp;e.code().message()&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">'\n'</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼šfuture_error&nbsp;caught:&nbsp;future&nbsp;already&nbsp;retrieved<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;future_errc&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">try</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prom.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;throws&nbsp;std::future_error&nbsp;with&nbsp;future_already_retrieved<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">catch</span><span style="color:#000000;">&nbsp;(std::future_error&nbsp;&amp;&nbsp;e)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(e.code()&nbsp;==&nbsp;make_error_condition(future_errc::future_already_retrieved))<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;[future&nbsp;already&nbsp;retrieved]\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">else</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;[unknown&nbsp;exception]\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;è¾“å‡ºï¼š[future&nbsp;already&nbsp;retrieved]<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;launch&nbsp;ç¤ºä¾‹<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;with&nbsp;launch::async:&nbsp;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&gt;&nbsp;foo&nbsp;=&nbsp;async(launch::async,&nbsp;print_ten,&nbsp;</span><span style="color:#800000;">'*'</span><span style="color:#000000;">,&nbsp;</span><span style="color:#ff0000;">100</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#8000ff;">void</span><span style="color:#000000;">&gt;&nbsp;bar&nbsp;=&nbsp;async(launch::async,&nbsp;print_ten,&nbsp;</span><span style="color:#800000;">'@'</span><span style="color:#000000;">,&nbsp;</span><span style="color:#ff0000;">200</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;å®šä¹‰åå³è¢«æ–°çº¿ç¨‹å¼‚æ­¥è°ƒç”¨<BR>
</span><span style="color:#000000;"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;foo.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;bar.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n\n&quot;</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;with&nbsp;launch::deferred:&nbsp;\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;foo&nbsp;=&nbsp;async(launch::deferred,&nbsp;print_ten,&nbsp;</span><span style="color:#800000;">'*'</span><span style="color:#000000;">,&nbsp;</span><span style="color:#ff0000;">100</span><span style="color:#000000;">);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;bar&nbsp;=&nbsp;async(launch::deferred,&nbsp;print_ten,&nbsp;</span><span style="color:#800000;">'@'</span><span style="color:#000000;">,&nbsp;</span><span style="color:#ff0000;">200</span><span style="color:#000000;">);<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;foo.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;bar.get();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;å¦‚æœä¸æ‰§è¡Œ.get()ï¼Œåˆ™é€’å»¶deferredä¸ä¼šæ‰§è¡Œå‡½æ•°print_ten<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;cout&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;\n&quot;</span><span style="color:#000000;">;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}<BR>
<BR>
</span><span style="color:#008000;">//&nbsp;launch&nbsp;ç¤ºä¾‹éƒ¨åˆ†è¾“å‡ºï¼š<BR>
</span><span style="color:#000000;">with&nbsp;launch::async:<BR>
*@**@**@**@**@*@@@@@<BR>
<BR>
with&nbsp;launch::deferred:<BR>
**********@@@@@@@@@@</span></div></td></tr></table></div>
<br><a name="bc6"><font color=green size = 5>&lt;future&gt;å¤´æ–‡ä»¶ Functions</font></a>
<br>
<br><font color=blue size = 5>Providers</font>
<br>
<br><font color=purple size = 4>std::async</font>
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;">unspecified&nbsp;policy&nbsp;(<span style="color:#ff0000;">1</span><span style="color:#000000;">)&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Fn,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">...&nbsp;Args&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#0000ff;">typename</span><span style="color:#000000;">&nbsp;result_of&lt;Fn(Args...)&gt;::type&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;async&nbsp;(Fn&amp;&amp;&nbsp;fn,&nbsp;Args&amp;&amp;...&nbsp;args);<BR>
specific&nbsp;policy&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color:#ff0000;">2</span><span style="color:#000000;">)&nbsp;&nbsp;</span><span style="color:#0000ff;">template</span><span style="color:#000000;">&nbsp;&lt;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">&nbsp;Fn,&nbsp;</span><span style="color:#0000ff;">class</span><span style="color:#000000;">...&nbsp;Args&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future&lt;</span><span style="color:#0000ff;">typename</span><span style="color:#000000;">&nbsp;result_of&lt;Fn(Args...)&gt;::type&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;async&nbsp;(launch&nbsp;policy,&nbsp;Fn&amp;&amp;&nbsp;fn,&nbsp;Args&amp;&amp;...&nbsp;args);</span></div></td></tr></table></div>
å¼‚æ­¥è°ƒç”¨å‡½æ•°
<br> â— åœ¨æŸä¸ªç‚¹è°ƒç”¨fn(ä»¥argsä¸ºå‚æ•°)ï¼Œæ— éœ€ç­‰å¾…fnçš„æ‰§è¡Œå®Œæˆ
<br> â— fnè¿”å›çš„å€¼å¯ä»¥é€šè¿‡è°ƒç”¨futureå¯¹è±¡çš„æˆå‘˜future::getè®¿é—®
<br> â— ç¬¬äºŒä¸ªç‰ˆæœ¬(2)è®©è°ƒç”¨è€…é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„å¯åŠ¨ç­–ç•¥ï¼Œè€Œç¬¬ä¸€ä¸ªç‰ˆæœ¬(1)ä½¿ç”¨è‡ªåŠ¨é€‰æ‹©ï¼Œå°±ç»ªè°ƒç”¨(2)launch::async | launch::deferred ä½œä¸ºç­–ç•¥
<br> â— å‡½æ•°åœ¨å…±äº«çŠ¶æ€ä¸­ä¸´å­˜å‚¨ï¼Œçº¿ç¨‹å¤„ç†ç¨‹åºä½¿ç”¨æˆ–å¤åˆ¶fnå’Œargsä½œä¸ºé€’å»¶å‡½æ•°ï¼Œè€Œä¸å‡†å¤‡å°±ç»ªï¼Œä¸€æ—¦fnçš„æ‰§è¡Œå®Œæˆï¼Œå…±äº«çŠ¶æ€åŒ…å«fnçš„è¿”å›çš„å€¼ï¼Œå¹¶å‡†å¤‡å°±ç»ª
<br> ğŸš© å‚æ•° policyï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;launch::asyncï¼šå¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹æ¥è°ƒç”¨fnï¼Œå¥½åƒä¸€ä¸ªçº¿ç¨‹å¯¹è±¡æ—¶fnå’Œargsä½œä¸ºå‚æ•°æ„å»ºçš„ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®è¿”å›çš„futureå…±äº«çŠ¶æ€
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;launch::defrredï¼šå¯¹fnçš„è°ƒç”¨è¢«æ¨è¿Ÿï¼Œç›´åˆ°è¢«è®¿é—®çš„futureçš„å…±äº«çŠ¶æ€è¢«è®¿é—®(ç­‰å¾…æˆ–è·å–)ï¼Œæ­¤æ—¶ï¼Œè°ƒç”¨fnå¹¶ä¸å†è€ƒè™‘å‡½æ•°çš„é€’å»¶ã€‚å½“è¿™ä¸ªå‡½æ•°è¿”å›æ—¶ï¼Œè¿”å›çš„futureå…±äº«çŠ¶æ€å·²ç»å‡†å¤‡å¥½äº†
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;launch::async|launch::deferredï¼šå‡½æ•°è‡ªåŠ¨åœ°é€‰æ‹©ç­–ç•¥ï¼Œè¿™å–å†³äºç³»ç»Ÿå’Œåº“çš„å®ç°ï¼Œé€šå¸¸ä¼šä¼˜åŒ–ç³»ç»Ÿå½“å‰çš„å¹¶å‘å¯ç”¨æ€§
<br> ğŸš© å‚æ•° fnï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆã€æŒ‡å‘æˆå‘˜çš„æŒ‡é’ˆã€æˆ–ä»»ä½•å½¢å¼çš„å¯æ„é€ å‡½æ•°å¯¹è±¡(ä¾‹å¦‚ï¼šä¸€ä¸ªç±»å®šä¹‰æ“ä½œç¬¦()çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬é—­åŒ…å’Œå‡½æ•°å¯¹è±¡)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fnçš„è¿”å›å€¼å­˜å‚¨ä¸ºå¼‚æ­¥è¿”å›çš„futureå¯¹è±¡æ£€ç´¢çš„å…±äº«çŠ¶æ€ï¼Œå¦‚æœfnæŠ›å‡ºï¼Œåˆ™åœ¨å…±äº«çŠ¶æ€ä¸­è®¾ç½®å¼‚å¸¸ï¼Œä»¥è¢«futureå¯¹è±¡æ£€ç´¢
<br> ğŸš© å‚æ•° argsï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å‚æ•°ä¼ é€’ç»™fn(å¦‚æœæœ‰çš„è¯)ï¼Œå®ƒä»¬çš„ç±»å‹æ˜¯å¯æ„é€ çš„ï¼Œå¦‚æœfnæ˜¯ä¸€ä¸ªæˆå‘˜æŒ‡é’ˆï¼Œåˆ™ç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥æ˜¯å®šä¹‰è¯¥æˆå‘˜çš„å¯¹è±¡ã€å¼•ç”¨æˆ–æŒ‡å‘å®ƒçš„æŒ‡é’ˆ
<br> ğŸ“ ç¼–ç¨‹ç¤ºä¾‹å¦‚ä¸Š ğŸ‘†
<br>
<br><font color=blue size = 5>Other functions</font>
<br>
<br><font color=purple size = 4>std::future_category</font>
<br> ğŸ¨ å®šä¹‰ï¼šconst error_category&amp; future_category() noexcept;
<br> â— è¿”å›å¯¹å…·æœ‰ä»¥ä¸‹ç‰¹å¾çš„error_categoryç±»å‹çš„é™æ€å¯¹è±¡çš„å¼•ç”¨ï¼š
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.å®ƒçš„æˆå‘˜å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘å­—ç¬¦åºåˆ—â€œfutureâ€çš„æŒ‡é’ˆ
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.default_error_conditionæˆå‘˜å‡½æ•°æŒ‰ç…§åŸºæœ¬error_categoryç±»æŒ‡å®š
<br> â— æè¿°ä¸enumç±»å‹future_errcå¯¹åº”çš„é”™è¯¯å’Œerror_conditionå¯¹è±¡ä¸æ­¤ç±»åˆ«ç›¸å…³è”ï¼Œè¿™äº›å¯¹åº”å…³ç³»ä¸­çš„é”™è¯¯ç±»å‹å–å†³äºæ“ä½œç³»ç»Ÿå’Œç‰¹å®šçš„åº“å®ç°ã€‚
<br>
<br> ğŸ“ ç¼–ç¨‹ç¤ºä¾‹ï¼š
<br><div style="width:100%;border:1px #e3e3e3 solid;"><div style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;border-bottom:1px solid #e3e3e3;margin-top:5px;color:#000000;">&nbsp;C++ Code&nbsp;</div><table style="width:100%;font-family:'Consolas', 'Courier New';font-size:12px;vertical-align:text-top;line-height:15px;" border="0" cellspacing="0" cellpadding="0"><tr><td style="color:#008284;background-color:#e3e3e3;vertical-align:text-top;"><div style="margin:7px;text-align:right;white-space:nowrap;"><nobr>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br></nobr></div></td><td style="background-color:#008284;padding:1px;"><div style="border:1px #008284 solid;"></div></td><td style="background-color:#efefef;width:100%;vertical-align:text-top;color:#000000;"><div style="margin:7px;"><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;iostream&gt;<BR>
</span><span style="color:#0000ff;">#include</span><span style="color:#000000;">&nbsp;&lt;future&gt;<BR>
<BR>
</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&nbsp;main()<BR>
{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;promise&lt;</span><span style="color:#8000ff;">int</span><span style="color:#000000;">&gt;&nbsp;prom;<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">try</span><span style="color:#000000;">&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prom.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#008000;">//&nbsp;throws&nbsp;a&nbsp;std::future_error&nbsp;of&nbsp;the&nbsp;future&nbsp;category<BR>
</span><span style="color:#000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prom.get_future();<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">catch</span><span style="color:#000000;">&nbsp;(future_error&nbsp;&amp;&nbsp;e)&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">if</span><span style="color:#000000;">&nbsp;(e.code().category()&nbsp;==&nbsp;future_category())<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cerr&nbsp;&lt;&lt;&nbsp;</span><span style="color:#800000;">&quot;future_error&nbsp;of&nbsp;the&nbsp;future&nbsp;category&nbsp;thrown\n&quot;</span><span style="color:#000000;">;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;}<BR>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#0000ff;">return</span><span style="color:#000000;">&nbsp;</span><span style="color:#ff0000;">0</span><span style="color:#000000;">;<BR>
}</span></div></td></tr></table></div>
è¾“å‡ºï¼šfuture_error of the future category thrown</p>

<p><br><br><br>
<font color = gray size = 3>å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼</font></p></div>
        <div class="post_footer">
          
          <div class="meta">
            <div class="info">
              <span class="field tags">
                <i class="remixicon-stack-line"></i>
                
                <a href="https://oubc.github.io/tags/c/c&#43;&#43;/">C/C&#43;&#43;</a>
                
              </span>
            </div>
          </div>
          
        </div>
      </div>
      
      
    </div>
  </div>
  <a id="back_to_top" href="#" class="back_to_top"><span>â–³</span></a>
</div>
<footer class="footer">
  <div class="powered_by">
    <a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4l9lmg4aog3074074gnf.gif?tags=%5B%5D">I </a>
	<a href="">love</a>
    <a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4l9lmfm2eg306o06o74u.gif?tags=%5B%5D"> you </a>
    <a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4njrx4tpcj30fn0bq3zg.jpg?tags=%5B%5D">three </a>
	<a href="https://wxt.sinaimg.cn/thumb300/007Diza3ly1g4njrx64ctg307s07swfy.gif?tags=%5B%5D">thousand</a>
    <a href="https://www.kugou.com/song/#hash=96426C78381DE98DC31A5846FC274CBF&album_id=646623"> times.</a>
  </div>

  <div class="footer_slogan">
    <span>å®¶åº­ã€æ¢¦æƒ³ã€å†…å¿ƒçš„å¹³é™</span>
  </div>
</footer>



<script src="https://oubc.github.io/js/jquery-3.3.1.min.js"></script>
<script src="https://oubc.github.io/js/zozo.js"></script>
<script src="https://oubc.github.io/js/highlight.pack.js"></script>
<link  href="https://oubc.github.io/css/fancybox.min.css" rel="stylesheet">
<script src="https://oubc.github.io/js/fancybox.min.js"></script>

<script>hljs.initHighlightingOnLoad()</script>


  <script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>






</body>
</html>
